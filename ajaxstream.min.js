(function(e,t,n,r){function b(e){var t=e.data("ajaxstreamid");return t||t===0?ZZ.streams[t+"_"+e[0].id]:e}function w(e,t,n,r){if(e>t){if(e>n){t=Math.round(t*=n/e);e=n}}else{if(t>r){e=Math.round(e*=r/t);t=r}}return{width:e,height:t}}function E(t){var n=t.x2-t.x;e("#AJSCropT").css({width:n,height:t.y,left:t.x,top:0});e("#AJSCropR").css({width:t.trackWidth-t.x2,height:t.trackHeight,right:0,top:0});e("#AJSCropB").css({width:n,height:t.trackHeight-t.y2,left:t.x,bottom:0});e("#AJSCropL").css({width:t.x,height:t.trackHeight,left:0,top:0})}function S(){if(!q(e("#AJSLegacy"))){var t={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(W.getHtml("form",W.getInput("AJSLegacy",null,null,"hidden")+W.getInput(null,"submit",null,"submit"),"AJSLegacyForm",a,t)+W.getHtml("iframe",null,"AJSIFrame",a,{name:"AJSIFrame"}))}}function x(e){var t=1e-15,n,r,i,s,o,u,a,f=e;a=Math.floor(f);r=1;o=0;n=a;s=1;while(f-a>t*s*s){f=1/(f-a);a=Math.floor(f);i=r;r=n;u=o;o=s;n=i+a*r;s=u+a*o}return(n>21?(n/Math.pow(10,(""+n+"").length-1)).toPrecision(2):n)+":"+(s>21?(s/Math.pow(10,(""+s+"").length-1)).toPrecision(2):s)}function T(e){var t=N()+_();return W.getDiv(null,"AJSMainOverlay")+W.getDiv(t+W.getHtml("img",null,"AJSLoading",a,{src:e+"/files/loader.gif",title:P("Files are loading")}),"AJSMain")}function N(){var e=C()+W.getDiv(W.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+W.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return W.getDiv(e,"AJSImagePreview",a)}function C(){return W.getDiv(W.getDiv(null,"AJSActionsOverlay")+W.getDiv((d?W.getSpan(null,"AJSAdd","asicons-plus",{title:P("Add another file")}):"")+(d?W.getSpan(null,"AJSChange","asicons-docs",{title:P("Change file")}):"")+(m?W.getSpan(null,"AJSEdit","asicons-pencil",{title:P("Edit")}):"")+W.getSpan(null,"AJSRemove","asicons-trash",{title:P("Remove file")})+W.getSpan(null,"AJSClose","asicons-cross",{title:P("Close window")})),"AJSPreviewActions")}function k(){var e="";e+=W.getDiv(W.getDiv(W.getDiv(W.getHtml("img",null,"AJSResImg")+W.getDiv(W.getDiv(null,"AJSCropT")+W.getDiv(null,"AJSCropR")+W.getDiv(null,"AJSCropB")+W.getDiv(null,"AJSCropL"),"AJSRBG")+W.getDiv(W.getDiv(),"AJSRITrack"),"AJSRInner")+W.getDiv(L()+A(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo");return W.getDiv(e+W.getDiv(W.getSpan(null,"AJSISave","AJSBtnD asicons-checkmark")+W.getSpan(null,"AJSICancel","AJSBtnD asicons-cross"),"AJSIBtns"),"AJSMore",a)}function L(){return""}function A(){return M()}function O(){return W.getDiv(W.getDiv(W.getSpan(P("CANVAS WIDTH"))+W.getInput("AJSCW"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("CANVAS HEIGHT"))+W.getInput("AJSCH"),null,"AJSSInfo"),"AJSRCan","AJSEdivs AJSHidden")}function M(){return W.getDiv(W.getDiv(W.getSpan(P("WIDTH"))+W.getInput("AJSSW"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("HEIGHT"))+W.getInput("AJSSH"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("ASPECT RATIO"))+W.getInput("AJSSAR"),null,"AJSSInfo"),"AJSWHAR","AJSEdivs")}function _(){var e=W.getSpan(P("Choose file")+(d?"":" "+W.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+(h?W.getSpan(D(),"AJSPasteText","AJSBtnD AJSBtnDU"):"")+(p?W.getSpan(P("Drop"),"AJSDropText","AJSBtnD AJSBtnDU"):"")+W.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross");var t=W.getDiv(W.getInput("AJSFile",null,a,"file")+W.getDiv(e,"AJSChooseFile"),"AJSChooseSection");return W.getDiv(t,"AJSUploadSection")+(p?W.getDiv(W.getHtml("a",P("DROP")),"AJSDropZone",a):"")}function D(){var e=P("Paste (ctrl + v)");if(navigator.platform.match(/Mac/i)){e=P("Paste (cmd + v)")}return e}function H(e){return e.slice(-1)[0]}function B(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function j(e){return r.getElementById(e)}function F(e){return I("Object",e)}function I(e,t){if(t===undefined){return false}var n=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(t)==="[object "+n+"]"}function q(e){return e[i]>0}function R(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function U(e,t){var n;if(!e){return!1}try{n=JSON.parse(e)}catch(r){n=JSON.parse("'"+e+"'")}return n?t?R(n):n:!1}function z(e){var t=e;if(I("Array",t)){t={};for(var n=0,r=e[i];n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function W(){function t(e,t){if(F(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}}var e=this;this.getLink=function(t,n,r,i,s,o){if(!F(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}t(u,o);return u.outerHTML};this.getInput=function(t,n,r,i,s){if(!F(s)){s={}}if(n||n===0){s.value=n}if(t&&!s[l]){s[l]=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var i="length",s="prop",o="AJS",u="#AJS",a="AJSHidden",f="replace",l="name",c=function(){},h="onpaste"in r,p="draggable"in r.createElement("span"),d=!!(t.Blob||t.File||t.FileList||t.FileReader),v=r.createElement("canvas"),m=!!(v.getContext&&v.getContext("2d")),g={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onbeforeopen:c,onclose:c,onfilechanging:c,onfilechanged:c,onfileselected:c,onfilesloaded:c,onfilesloading:c,oninit:c,onlegacyuploadfail:c,onlegacyuploadfinish:c,onlegacyuploadstart:c,onopen:c,onsingleuploadfail:c,onsingleuploadfinish:c,onsingleuploadstart:c,onuploadfail:c,onuploadfinish:c,onuploadprogress:c,onuploadstart:c,pathPrefix:"",quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[i];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e[f](n,arguments[t])}return e},uploadScript:"/upload.php?newupload=true",uploadTo:"uploads",uploadWithForm:!1,verbose:!1},y={init:function(f){function _(t,n,i,s){var o;if(t[0].tagName==="CANVAS"&&!i){o='<span id="'+n+'"><span></span></span>'}else if(t[0].tagName==="SPAN"&&i){o=r.createElement(s?"canvas":"img");o.id=n}else{return t}t.after(o);t.remove();return e("#"+n)}function D(e,t,n){if(t.base64){n=new Image;n.src=t.base64}var r=n.width,i=n.height,s=w(r,i,v.s.maxWidth,v.s.maxHeight);r=s.width;i=s.height;t.croppedWidth=t.resizedWidth=e.width=r;t.croppedHeight=t.resizedHeight=e.height=i;var o=e.getContext("2d");o.drawImage(n,0,0,r,i);if(t.newupload||v.existingedited){t.base64=e.toDataURL("image/jpeg",v.s.quality)}}function P(e,t){switch(t){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function F(){var t=e(this)[0].id.replace("AJSUploadBtn_","");v.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:v.uploads});v=ZZ.streams[t];var n=e("#AJS");n.show();n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)});v[C][i]?v.displayUpload():v.resetToUpload();v.event("open",v,{original:v[0],uploads:v.uploads,length:v.uploads.length})}function R(){var t=e(this)[0].id,n=t.replace(/.*\_(\d+)$/,"$1");t=t.replace(/\_\d+$/,"");var r=t.replace("AJSFP_","");v.event("beforeopen",this,{elemid:r.replace(/^\d+_(.*)$/,"$1"),index:r.replace(/^(\d+)_.*/,"$1"),uploads:v.uploads});v=ZZ.streams[r];v[L]=n;var i=e("#AJS");i.show();i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)});v.displayUpload(v.uploads[n]);e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a)}function X(){var t="AJSIMG_"+v.id+v[L],n=e("#"+t);if(n.is(":visible")){n.css({top:(500-n.height())/2})}var r=e("#AJS");r.css({marginLeft:-(r.width()/2),marginTop:-(r.height()/2)})}function V(){var e="",t=v.uploads,n=parseFloat(v.s.iconPreviewHeight),r=parseFloat(v.s.iconPreviewWidth),i=0;for(var s in t){var o=t[s],u=o.mimetype.replace(/\/.*$/,""),a=u==="image",f;if(a){var l;if(o.croppedWidth<o.croppedHeight){l="height: 100%;width: auto;"}else{var c=o.croppedWidth/o.croppedHeight,h=r/c;l="width: 100%;height: auto;margin-top:"+(n-h)/2+"px;"}f=W.getHtml("img",null,null,null,{src:o.base64,style:l})}else{f=W.getSpan(null,null,P(u,o.mimetype),{style:"line-height:"+n+"px;font-size:"+(r-20)+"px;"})}f+=W.getDiv(o.name,null,"AJSFPName");e+=W.getDiv(f,"AJSFP_"+v.id+"_"+o.index,"AJSFP",{style:"width:"+r+"px;height:"+n+"px;"});i++}if(v.s.maxFiles&&t.length+1<=v.s.maxFiles&&v.uploads.length&&d){e+=W.getSpan(null,"AJSUploadBtn_"+v.id,"asicons-plus AJSBtn AJSFPBtn",{style:"height:"+n+"px;line-height:"+n+"px;","data-ajaxstreamid":v.c})}if(!i){e+=W.getSpan(M("Upload"),"AJSUploadBtn_"+v.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":v.c})}return e}var v=this;if(v[i]>1){v.each(function(){e(this).ajaxStream(f)});return v}else if(!v[i]){return v}var y=e("body"),b="change",N="attr",C="uploads",L="currentupload",A="changing",O="currentlength";v.c=n;v.currentupload=null;v.currentlength=0;v.changing=!1;v.toload=0;v.loaded=0;v.uploads=[];v.addingmore=!1;v.existingedited=!1;v.s=e.extend(e.extend({},g),f);if(typeof M!==undefined){function M(e){e===e;return v.s.translateFunction.apply(null,arguments)}}v.id=[v.c,"_",v[s]("id")].join("");v.filedata={};v.event=function(e,t){return v.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};v.legacyUpload=function(n){var r=v[A]===!1?v[C][i]:v[A];v.filedata={base64:null,croppedWidth:null,croppedHeight:null,index:r,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null};t["AJSLegacy"]=ZZ.streams[v.id];e("#AJSLegacy").val(JSON.stringify({maxsize:v.s.maxFileSize,maxheight:v.s.maxHeight,maxwidth:v.s.maxWidth,uploaddir:v.s.uploadTo,islegacy:!0,id:v.id}));var s=e("#AJSFileLegacy"),o=s.clone();o.insertAfter(s);s[0].id=null;e("#AJSLegacyForm").prop({action:v.s.uploadScript}).append(s);o.unbind("change",v.filechanged).change(v.filechanged);v.event("legacyuploadstart",n,{original:v[0]});j("AJSLegacyForm").submit();e("#AJSLoading").removeClass(a)};v.afterLegacyUpload=function(n){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove();e("#AJSLoading").addClass(a);if(n.moved){if(n.mimetype.match("image/*")){v.filedata.croppedWidth=v.filedata.resizedWidth=n.width;v.filedata.croppedHeight=v.filedata.resizedHeight=n.height}v.currentlength++;v.filedata.base64=n.location;v.filedata.src=n.location;v.filedata.name=n.name;v.filedata.size=n.size;v.filedata.mimetype=n.mimetype;v.filedata.src=n.location;v.event("legacyuploadfinish",v,{original:v[0],results:n,uploads:v.uploads});v.afterFileRead(v.filedata,v[A]!==!1);t["AJSLegacy"]=null}else{v.event("legacyuploadfail",null,{original:v,error:n.error,results:n,uploads:v.uploads});streamConfirm(M("Error"),{Close:c},n.error,{nocancel:!0})}};v.filechanged=function(e){var t=e.target.files;if(!t&&e.target.value.match(/^.\:\\/)){v.legacyUpload(this);v.toload=1;return}else if(!t.length){v.changing=!1;return}v.toload=t[i];v.event("fileselected",this,{originalEvent:e,files:t,toload:v.toload,original:v,uploads:v.uploads});if(d){if(v[A]===!1){var n=t[i],r=n+v[C][i];if(r>v.s.maxFiles){streamConfirm(M("Maximum files exceeded"),{Close:c},M("You have selected {0} files but are only permitted to upload {1}",r,v.s.maxFiles),{nocancel:!0});n=v.toload=v.s.maxFiles-v[C][i]}for(var s=0;s<n;s++){v.process(t[s],s)}}else{v.event("filechanging",this,{originalEvent:e,file:t[0],current:v[C][v[A]],original:v,uploads:v.uploads});v.process(t[0],v[A],!0,this)}}else{v.legacyUpload(this)}};v.process=function(n,r,i,s){e("#AJSLoading").removeClass(a);if(I("blob",n)||I("file",n)){var u=new FileReader,f=n.type.match("image/*");u.onload=function(e){var u=new Blob([e.target.result],{type:n.type}),a=(t.URL||t.webkitURL).createObjectURL(u),c=i?r:v[O],h={customFields:[],index:c,islegacy:!1,mimetype:n.type,name:n[l],newupload:!0,size:n.size,src:a};if(!i){v[O]++}if(f){var p=new Image;p.onload=function(){var e=this;h.width=h.resizedWidth=h.croppedWidth=e.width;h.height=h.resizedHeight=h.croppedHeight=e.height;h.base64=null;h.cropdata={};ZZ.images[o+"IMG_"+v.id+c]=this;v.afterFileRead(h,i,s)};p.src=a}else{h.base64=e.target.result;v.afterFileRead(h,i,s)}};u.onerror=function(t){var n=t.currentTarget.error;e("#AJSLoading").addClass(a);streamConfirm(M("Error"),{Close:c},M("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+n.message,{nocancel:!0});console.error(n.name+": "+n.message)};f?u.readAsArrayBuffer(n):u.readAsDataURL(n)}else{streamConfirm(M("Error"),{Close:c},M("The selection is not a file"),{nocancel:!0})}};v.afterFileRead=function(e,t,n){var r=null;if(t){r=v[C][e.index];v[C][e.index]=e}else{v[C][e.index]?v[C][e.index]=e:v[C].push(e)}v.attemptProgression(n,e.index,r)};v.attemptProgression=function(t,n,r){v.loaded++;v.event("filesloading",t,{original:v,toload:v.toload,loaded:v.loaded,uploads:v.uploads});if(v.loaded===v.toload){e("#AJSLoading").addClass(a);e("#AJSUploadSection").addClass(a);e("#AJSImagePreview").removeClass(a);v.toggleLR();var i=v[A]===!1;if(v[A]===!1){v.event("filechanged",t,{original:v,newfile:v[C][n],oldfile:r,uploads:v.uploads})}v.event("filesloaded",t,{loaded:v.loaded,original:v,uploads:v[C]});v[A]=!1;v.toload=v.loaded=0;v.displayUpload(null,i)}};v.toggleLR=function(){if(v[C][i]>1){e("#AJSLRContainer").removeClass(a)}else{e("#AJSLRContainer").addClass(a)}};v.displayUpload=function(t,n){if(v[C][i]){if(!t){t=v.getCurr(n)}e("#AJSAdd")[v.currentlength+1>v.s.maxFiles?"addClass":"removeClass"](a);var r=t.mimetype.match("image/*")?t.src:null;v.toggleLR();v.drawImage(t,r);v.currentupload=t.index}else{v.resetToUpload()}};v.drawImage=function(t,n){var r="AJSIMG_"+v.id+t.index,s=t.mimetype.replace(/\/.*$/,""),o=s==="image",u=d&&m&&o,f=e("#"+r),l=e("#AJSEdit");if(f[i]){f=_(f,r,o,u)}else{var c="";if(u){c='<canvas id="'+r+'"></canvas>'}else{if(t.mimetype.match("image/*")){c='<img id="'+r+'"/>'}else{c='<span id="'+r+'"><span></span></span>'}}e("#AJSLRContainer").before(c);f=e("#"+r)}if(u){l.removeClass(a);D(f[0],t,ZZ.images[r])}else{if(s==="image"){l.removeClass(a);f[0].src=n}else{l.addClass(a);f.attr({"class":"AJSMIMEIcons "+P(s,t.mimetype)});f.find("span").html(t.name)}}e('[id^="AJSIMG_"]').addClass(a);var h=f[0].tagName==="CANVAS"?f[0].height:f.height();if(!h){h=t.croppedHeight}f.removeClass(a).css({top:(500-h)/2})};v.getCropped64=function(t,n,r,i){if(m){var s=t.getContext("2d"),o=e("#AJSResImg"),u=i.x2-i.x,a=i.y2-i.y,f=n.width,l=n.height;u*=f/o.width();a*=l/o.height();var c=w(u,a,v.s.maxWidth,v.s.maxHeight),h=c.width,p=c.height;var d=h/u,g=p/a;n.croppedWidth=t.width=h;n.croppedHeight=t.height=p;var y=-i.x*(f/o.width())*d;var b=-i.y*(l/o.height())*g;s.drawImage(r,y,b,f*d,l*g);n.base64=t.toDataURL("image/jpeg",v.s.quality)}};v.resetToUpload=function(){var t=e("#AJSRContainer");e("#AJSUploadSection").removeClass(a);e("#AJSImagePreview").addClass(a);e("#AJSChooseText").removeClass(a);e("#AJSLoading").addClass(a);v[C][i]?t.removeClass(a):t.addClass(a)};v.getCurr=function(e){if(e){v[L]=v[C][i]-1;return H(v[C])}else{if(v.addingmore){var t=H(v[C]);v[L]=t.index;return t}else{if(v[L]||v[L]===0){return v[C][v[L]]}v[L]=0;return B(v[C])}}};v.changePrev=function(e){var t=e?-1:1;var n;if(v[L]+t<0){n=H(v.uploads);v[L]=v[C][i]-1}else if(v[L]+t>v[C][i]-1){n=B(v[C]);v[L]=0}else{n=v[C][v[L]+t];v[L]+=t}v.displayUpload(n)};v.iconClick=function(){return};v.resizeIconClick=function(){j("AJSResImg").src=v[C][v[L]].src;e("#AJSRITrack,[id^=AJSCrop]").removeClass(a)};v.fillEditValues=function(e,t,n){if(t){var r=t.rect,i=r.width,s=r.height,o=Math.round((t.x2-t.x)*(e.width/i).toFixed(20)),u=Math.round((t.y2-t.y)*(e.height/s).toFixed(20));var a=w(o,u,v.s.maxWidth,v.s.maxHeight);o=a.width;u=a.height;j("AJSSAR").value=x(o/u);j("AJSSW").value=o;j("AJSSH").value=u}};v.showInfo=function(){var n=v[C][v[L]],r=n.cropdata,i=j("AJSResImg"),s=e("#AJSRInner"),o=e("#AJSRITrack");e("#AJSMain > div").addClass(a);e("#AJSMore").removeClass(a);i.src=n.src;var u=e(i);u.css({maxWidth:parseFloat(e(t).width())-20});s.css({width:"auto"});var f=i.getBoundingClientRect(),l=f.width,c=f.height;var h=r.x!==undefined?r.x2-r.x:l*.8,p=r.y!==undefined?r.y2-r.y:c*.8;o.streamBoundaries("updateOpts",{width:l,height:c,thumbWidth:h,thumbHeight:p,onFinish:function(e){e.rect=f;v.fillEditValues(n,e)}});var d=o.streamBoundaries("reposition",{x:r.x||r.x===0?r.x:"10%",y:r.y||r.y===0?r.y:"10%"}).positionData;E(d);d.rect=f;v.fillEditValues(n,d,{width:n.width,height:n.height});s.width(l);if(!e(".EIconActive").length){e(".AJSEIcon:first").addClass("EIconActive")}e(".EIconActive").click();var m=e("#AJS"),g=(parseFloat(s.height())-c)/2;e("#AJSRBG").css({top:-c,height:c});m.css({minWidth:l>340?l:340,marginLeft:-(m.width()/2)});u.css({marginTop:g}).attr({"data-top":g,"data-bottom":g+c});o.css({marginTop:g});X()};v.saveInfo=function(){var t=v[C][v[L]],n=e("#AJSRITrack").streamBoundaries("getPositionData"),r="AJSIMG_"+v.id+v[L],i=e("#"+r);if(!ZZ.images[r]){var s=new Image;s.src=t.src+"?cachekill="+(new Data).getTime();ZZ.images[r]=s}v.getCropped64(j(r),t,ZZ.images[r],n);var o={x:n.x,x2:n.x2,y:n.y,y2:n.y2};if(t.cropdata!==o){v.existingedited=!0}t.cropdata=o;e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a);e("#AJS").css({minWidth:"initial"});i.css({top:(500-i.height())/2});X()};v.initBinding=function(){var n=d?e("#AJSFile"):e("#AJSFileLegacy"),s=j(o);n.unbind("click").click(function(){var t={accept:v.s.accept};if(v.s.maxFiles>1){t["multiple"]=!0}e(this)[N](t)});if(d){e("#AJSChooseText").unbind("click").click(function(){v.addingmore=!0;v.changing=!1;n.click()})}if(h){s.onpaste=function(e){var t=e.clipboardData.items,n=t[i];v.toload=n;v.loaded=0;var r=n+v[C][i];if(r>v.s.maxFiles){streamConfirm(M("Maximum files exceeded"),{Close:c},M("You have selected {0} files but are only permitted to upload {1}",r,v.s.maxFiles),{nocancel:!0});n=v.toload=v.s.maxFiles-v[C][i]}for(var s=0;s<n;s++){var o=t[s].getAsFile();if(o&&o.size){v.addingmore=!0;v.process(o,s)}else{streamConfirm(M("Error"),{Close:c},M("There was an error processing the file you pasted"),{nocancel:!0})}}}}if(p){r.body.ondragover=function(t){if(t.target.id==="AJSMainOverlay"){e("#AJSDropZone").addClass(a)}else{t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy";e("#AJSDropZone").removeClass(a)}};r.body.ondrop=function(t){t.stopPropagation();t.preventDefault();if(e(t.target).closest("#AJS")[i]){e("#AJSDropZone").addClass(a);v.addingmore=!0;v.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:t.dataTransfer.files}})}}}n.unbind(b)[b](v.filechanged);e("#AJS").unbind("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e("#AJSAdd").unbind("click").click(function(){if(v[C][i]+1>v.s.maxFiles){}else{n.click();v.addingmore=!0}});e("#AJSChange").unbind("click").click(function(){v[A]=v[L];v.addingmore=!1;n.click()});e("#AJSL").unbind("click").click(function(){v.changePrev(!0)});e("#AJSR").unbind("click").click(function(){v.changePrev()});var f=j("AJSICancel"),l=j("AJSISave"),m=j("AJSSW"),g=j("AJSSH"),y=j("AJSSAR"),w=j("AJSEdit");if(w){w.onclick=v.showInfo}if(f){f.onclick=function(){e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a);var t=e("#"+"AJSIMG_"+v.id+v[L]);e("#AJS").css({minWidth:"initial"});t.css({top:(500-t.height())/2});X()}}if(l){l.onclick=v.saveInfo}e("#AJSRemove").unbind("click").click(function(){streamConfirm(M("Are you sure you want to remove this file?"),function(){var t=[],n=!1,r=!1;for(var s=0,o=v[C][i];s<o;s++){if(v[C][s]&&s!==v[L]){var u=v.uploads[s];u.index=t.length;t.push(u);if(r!==!1&&n!==!1){r=s}}else{n=s}}e("#AJSIMG_"+v.id+v[L]).remove();v.uploads=t;v.currentlength=v.uploads.length;v.currentupload=r!==false?r:0;e("#AJS_"+v[0].id).val(z(v.uploads));e("#AJSUploadSection").addClass(a);e("#AJSImagePreview").removeClass(a);v.toggleLR();v.displayUpload()},M("This simply removes the file from the list of files to be uploaded, and nowhere else"))});e("#AJSClose,#AJSCloseText").unbind("click").click(function(){e("#AJS_"+v[0].id).val(z(v[C]));e(u).hide();if(v.s.showPreviewOnForm){e("#AJSFormPrev_"+v.id).html(V());e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R)}v.event("close",v,{original:v[0],uploads:v.uploads,length:v.uploads.length})});e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R);if(y){y.onchange=function(){var t,n=this.value,r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=v[C][v[L]];if(n&&n.match(/^\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var s=n.split(/[\/|\:]/);t=s[0]/s[1]}else if(n&&n.match(/^(:?\d+|\d+\.\d+)$/)){t=Number(n)}else{return}var o=j("AJSResImg").getBoundingClientRect(),u=i.width/o.width,a=i.height/o.height,f=r.x2-r.x,l=Math.round(f/t),c=false,h=false;if(l+r.y>o.height){h=o.height-l;if(l>o.height){l=o.height;f=Math.round(l*t);h=0;if(f+r.x>o.width){c=o.width-f}}}var p=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:f,thumbHeight:l,x:c,y:h}).positionData;j("AJSSW").value=Math.round(f*u);j("AJSSH").value=Math.round(l*a);E(p)}}if(m){m.onchange=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=v[C][v[L]],s=false;if(t&&t.match(/\%/)){t=n.width*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.width/n.width,u=Math.round(t/o),a=r.y2-r.y;if(u+r.x>n.width){s=n.width-u}if(u>n.width){u=n.width;s=0;this.value=i.width}var f=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:u,thumbHeight:a,x:s}).positionData;E(f);j("AJSSAR").value=x(u/a)}}if(g){g.onchange=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=v[C][v[L]],s=false;if(t&&t.match(/\%/)){t=n.height*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.resizedHeight/n.height,u=Math.round(t/o),a=r.x2-r.x;if(u+r.y>n.height){u=n.height-u}if(u>n.height){u=n.height;s=0;this.value=i.resizedHeight}var f=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:a,thumbHeight:u,y:s}).positionData;E(f);j("AJSSAR").value=x(a/u)}}e(".AJSEIcon").unbind("click",v.iconClick).click(v.iconClick);e(".AJSEIcon[data-for=AJSWHAR]").unbind("click",v.resizeIconClick).click(v.resizeIconClick);e(window).unbind("resize",X).resize(X)};v.redraw=function(){e("#AJSFormPrev_"+v.id).html(V());e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R)};v.draw=function(){var t=v.parent();v.addClass(a);v.attr({"data-ajaxstreamid":v.c});if(q(e("#AJS_"+v[0].id))){var n=e("#AJS_"+v[0].id).val();v.uploads=n.length?U(n,!0):[];v.currentlength=v.uploads.length;for(var r=0;r<v.currentlength;r++){var i=v.uploads[r];if(!i.cropdata){i.cropdata={}}if(i.mimetype.match("image/*")){var s=new Image;s.src=i.src+"?cachekill="+(new Data).getTime();ZZ.images[o+"IMG_"+v.id+r]=s}}}else{t.append(W.getInput("AJS_"+v[0].id,null,null,"hidden"))}if(v.s.showPreviewOnForm){t.append(W.getDiv(V(),"AJSFormPrev_"+v.id,"AJSFormPrev",{style:"height:"+v.s.iconPreviewHeight}))}else{t.append(W.getSpan(M("Upload"),"AJSUploadBtn_"+v.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":v.c}))}if(!q(e(u))){y.append(W.getDiv(T(v.s.pathPrefix),o));if(d){e("#AJSImagePreview").after(k())}else{S()}e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,onUpdate:function(e){E(e)}})}v.initBinding();v.event("init",v,{original:v[0],uploads:v.uploads})}();ZZ.streams[v.id]=v;n++;return v},setUploadData:function(e,t){var n=this;if(I("string",e)){e=U(e)}n.uploads=e?e:[];n.currentlength=n.uploads.length;n.toload=n.loaded=n.currentupload=0;if(t){n.redraw()}}};e.fn.ajaxStream=function(t){var n=b(this);if(y[t]){return y[t].apply(n,Array.prototype.slice.call(arguments,1))}else if(Object.prototype.toString.call(t)==="[object Object]"||!t){return y.init.apply(n,arguments)}else{e.error(["The method ",t," does not exist"].join(""))}};if(typeof P!=="function"){function P(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga",images:{},license:"MIT",streams:{},setDefaults:function(t){g=e.extend(g,t)},submit:function(){},version:.02};W=new W})(jQuery,this,0,document)