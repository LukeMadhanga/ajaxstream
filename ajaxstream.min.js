(function(e,t,n,r,i){function v(e){var t=e.data("ajaxstreamid");return t||t===0?ZZ.streams[t+"_"+e[0].id]:e}function m(e,t,n,r,s){var o=e*1,u=t*1;if(s){n=n>s.width?s.width:n;r=r>s.height?s.height:r}if(o>u){if(o>n){u=g(u*=n/o);o=n}}else{if(u>r){o=g(o*=r/u);u=r}}return{width:i.round(o),height:i.round(u)}}function g(e){return i.round(e)}function y(t){var n=t.x2-t.x;e("#AJSCropT").css({width:n,height:t.y,left:t.x,top:0});e("#AJSCropR").css({width:t.trackWidth-t.x2,height:t.trackHeight,right:0,top:0});e("#AJSCropB").css({width:n,height:t.trackHeight-t.y2,left:t.x,bottom:0});e("#AJSCropL").css({width:t.x,height:t.trackHeight,left:0,top:0})}function b(){if(!I(e("#AJSLegacy"))){var t={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(z.getHtml("form",z.getInput("AJSLegacy",null,null,"hidden")+z.getInput(null,"submit",null,"submit"),"AJSLegacyForm",s,t)+z.getHtml("iframe",null,"AJSIFrame",s,{name:"AJSIFrame"}))}}function w(e){var t=1e-15,n,r,s,o,u,a,f,l=e;f=i.floor(l);r=1;u=0;n=f;o=1;while(l-f>t*o*o){l=1/(l-f);f=i.floor(l);s=r;r=n;a=u;u=o;n=s+f*r;o=a+f*u}return n+":"+o}function E(e){var t=S()+A();return z.getDiv(null,"AJSMainOverlay")+z.getDiv(t+z.getHtml("img",null,"AJSLoading",s,{src:e+"/files/loader.gif",title:M("Files are loading")}),"AJSMain")}function S(){var e=x()+z.getDiv(z.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+z.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return z.getDiv(e,"AJSImagePreview",s)}function x(){return z.getDiv(z.getDiv(null,"AJSActionsOverlay")+z.getDiv((f?z.getSpan(null,"AJSAdd","asicons-plus",{title:M("Add another file")}):"")+(f?z.getSpan(null,"AJSChange","asicons-docs",{title:M("Change file")}):"")+(c?z.getSpan(null,"AJSEdit","asicons-pencil",{title:M("Edit")}):"")+z.getSpan(null,"AJSRemove","asicons-trash",{title:M("Remove file")})+z.getSpan(null,"AJSClose","asicons-checkmark",{title:M("Close window")})),"AJSPreviewActions")}function T(){var e="";e+=z.getDiv(z.getDiv(z.getDiv(z.getHtml("img",null,"AJSResImg")+z.getDiv(z.getDiv(null,"AJSCropT")+z.getDiv(null,"AJSCropR")+z.getDiv(null,"AJSCropB")+z.getDiv(null,"AJSCropL"),"AJSRBG")+z.getDiv(z.getDiv(),"AJSRITrack"),"AJSRInner")+z.getDiv(z.getDiv(z.getDiv(z.getHtml("img",null,"AJSRCImg")),"AJSRCVp"),"AJSRC",s)+z.getDiv(N()+C(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo");return z.getDiv(e+z.getDiv(z.getSpan(null,"AJSISave","asicons-checkmark")+z.getSpan(null,"AJSICancel","asicons-cross"),"AJSIBtns"),"AJSMore",s)}function N(){return z.getDiv(z.getSpan(null,null,"AJSEIcon icon-transform",{"data-for":"AJSWHAR",title:M("Crop Image")})+z.getSpan(null,null,"AJSEIcon icon-flip-to-front",{"data-for":"AJSRCan",title:M("Resize canvas")}),"AJSEditIcons")}function C(){return L()+k()}function k(){return z.getDiv(z.getDiv(z.getSpan(M("CANVAS WIDTH"))+z.getInput("AJSCW"),null,"AJSSInfo")+z.getDiv(z.getSpan(M("CANVAS HEIGHT"))+z.getInput("AJSCH"),null,"AJSSInfo")+z.getDiv(z.getSpan(M("ZOOM"))+z.getDiv(z.getDiv(),"AJSCZ"),null,"AJSSInfo"),"AJSRCan","AJSEDivs AJSHidden")}function L(){return z.getDiv(z.getDiv(z.getSpan(M("WIDTH"))+z.getInput("AJSSW",null,null,"text",{readonly:""}),null,"AJSSInfo")+z.getDiv(z.getSpan(M("HEIGHT"))+z.getInput("AJSSH",null,null,"text",{readonly:""}),null,"AJSSInfo")+z.getDiv(z.getSpan(M("ASPECT RATIO"))+z.getInput("AJSSAR")+z.getSpan(null,"AJSLockAR","AJSLock icon-lock-open2"),null,"AJSSInfo"),"AJSWHAR","AJSEDivs")}function A(){var e=u?"<strong>"+O()+"</strong>":"",t=a?(e?" "+M("or")+" ":"")+"<strong>"+M("drop")+"</strong>":"",n=z.getSpan(M("Choose file")+(f?"":" "+z.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+z.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross")+(e||t?z.getDiv(M("You can also")+" "+e+t+" "+M("the file"),"AJSUMore"):"");var r=z.getDiv(z.getInput("AJSFile",null,s,"file")+z.getDiv(n,"AJSChooseFile"),"AJSChooseSection");return z.getDiv(r,"AJSUploadSection")+(a?z.getDiv(z.getHtml("a",M("DROP")),"AJSDropZone",s):"")}function O(){var e="(ctrl + v)";if(navigator.platform.match(/Mac/i)){e="(cmd + v)"}return M("paste")+" "+e}function _(e){return e.slice(-1)[0]}function D(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function P(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return!0}}return!1}function H(e){return r.getElementById(e)}function B(e){return F("Object",e)}function j(e){return F("Array",e)}function F(e,t){if(t===undefined){return!1}var n=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(t)==="[object "+n+"]"}function I(e){return e.length>0}function q(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function R(e,t){var n;if(!e){return!1}try{n=JSON.parse(e)}catch(r){n=JSON.parse("'"+e+"'")}return n?t?q(n):n:!1}function U(e){var t=e;if(F("Array",t)){t={};for(var n=0,r=e.length;n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function z(){function t(e,t){if(B(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}}var e=this;this.getLink=function(t,n,r,i,s,o){if(!B(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}t(u,o);return u.outerHTML};this.getInput=function(t,n,r,i,s){if(!B(s)){s={}}if(n||n===0){s.value=n}if(t&&!s.name){s.name=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var s="AJSHidden",o=function(){},u="onpaste"in r,a="draggable"in r.createElement("span"),f=!!(t.Blob||t.File||t.FileList||t.FileReader),l=r.createElement("canvas"),c=!!(l.getContext&&l.getContext("2d")),h={VP_MAX_HEIGHT:420},p={accept:[".*"],allowFilters:!0,defaultCropHeightPer:.8,defaultCropWidthPer:.8,maxFileSize:2097152,maxFiles:1,iconPreviewHeight:200,iconPreviewWidth:200,maxHeight:1024,maxWidth:1024,onbeforeopen:o,onclose:o,onfilechanged:o,onfilechanging:o,onfileselected:o,onfilesloaded:o,onfilesloading:o,oninit:o,onlegacyuploadfail:o,onlegacyuploadfinish:o,onlegacyuploadstart:o,onopen:o,onsingleuploadfail:o,onsingleuploadfinish:o,onsingleuploadstart:o,onuploadfail:o,onuploadfinish:o,onuploadprogress:o,onuploadstart:o,pathPrefix:"",quality:1,readonly:!1,showPreviewOnForm:!1,scale9Grid:!0,translateFunction:function(e){for(var t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e.replace(n,arguments[t])}return e},uploadScript:"/upload.php",uploadTo:"uploads"},d={init:function(l){function x(t,n,i,s){var o;if(P(["CANVAS","IMG"],t[0].tagName)&&!i){o='<span id="'+n+'"><span></span></span>'}else if(t[0].tagName==="SPAN"&&i){o=r.createElement(s?"canvas":"img");o.id=n}else if(t[0].tagName==="IMG"&&s){o=r.createElement("canvas");o.id=n}else if(t[0].tagName==="CANVAS"&&!s){o=r.createElement("img");o.id=n}else{return t}t.after(o);t.remove();return e("#"+n)}function N(e,t,n){if(t.newsrc){n=new Image;n.src=t.newsrc}var r=m(n.width,n.height,d.s.maxWidth,d.s.maxHeight),i=e.getContext("2d");t.croppedWidth=t.resizedWidth=e.width=r.width;t.croppedHeight=t.resizedHeight=e.height=r.height;d.multipass(e,i,n);if(t.newupload||d.existingedited){t.newsrc=e.toDataURL(t.mimetype,d.s.quality)}}function C(t,n,i,o,u,a){e("#AJSLoading").removeClass(s);if(a&&o.canvasZoom){var f=o.canvasZoom,l=r.createElement("canvas"),c=l.getContext("2d");l.width=o.croppedWidth;l.height=o.croppedHeight;c.drawImage(i,u.x,u.y,u.outwidth,u.outheight);t.width=o.canvasWidth;t.height=o.canvasHeight;n.drawImage(l,f.x,f.y,f.width,f.height)}else{n.drawImage(i,u.x,u.y,u.outwidth,u.outheight)}o.newsrc=t.toDataURL(o.mimetype,d.s.quality);e("#AJSLoading").addClass(s)}function k(e,t){switch(t){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function L(e,t){var n=e.canvasWidth,r=e.canvasHeight,i=r?r:t.height,s=n?n:t.width,o=t.height,u=t.width,a=1;if(i>h.VP_MAX_HEIGHT){a=i/h.VP_MAX_HEIGHT;i=h.VP_MAX_HEIGHT;s/=a;o/=a;u/=a}return{height:i,thumbHeight:o,thumbWidth:u,width:s,scale:a}}function A(){var t=e(this)[0].id.replace("AJSUploadBtn_","");d.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:d.uploads});d=ZZ.streams[t];var n=e("#AJS");n.show();n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)});d.uploads.length?d.displayUpload():d.resetToUpload();d.event("open",d,{original:d[0],uploads:d.uploads,length:d.uploads.length});M(d.s.readonly)}function O(){var t=e(this)[0].id,n=t.replace(/.*\_(\d+)$/,"$1");t=t.replace(/\_\d+$/,"");var r=t.replace("AJSFP_","");d.event("beforeopen",this,{elemid:r.replace(/^\d+_(.*)$/,"$1"),index:r.replace(/^(\d+)_.*/,"$1"),uploads:d.uploads});d=ZZ.streams[r];d.currentupload=n;var i=e("#AJS");i.show();i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)});d.displayUpload(d.uploads.index);e("#AJSMain > div").addClass(s);e("#AJSImagePreview").removeClass(s);d.event("open",d,{original:d[0],uploads:d.uploads,length:d.uploads.length});M(d.s.readonly)}function M(t){var n=t?"addClass":"removeClass",r=d.uploads[d.currentupload];e("#AJSChange,#AJSRemove,#AJSEdit")[n](s);if(!t&&r){if(r.mimetype.match("image/*")&&r.mimetype!=="image/gif"&&c){e("#AJSEdit").removeClass(s)}else{e("#AJSEdit").addClass(s)}}}function B(t){var n=h.VP_MAX_HEIGHT,r=t>n?n:t;e("#AJSRCVp").css({top:(n-r)/2})}function q(t){if(!t.lastMove){e("#AJSCZ").streamBoundaries("reposition")}var n=X(),r=d.uploads[d.currentupload],i=t.px||t.px===0?t.px*1:1,s=n.minWidth+n.width*i,o=n.minHeight+n.height*i,u=e("#AJSRCVp").streamBoundaries("updateOpts",{thumbHeight:o,thumbWidth:s}).streamBoundaries("reposition").positionData;r.canvasZoom={height:o*n.scale,width:s*n.scale,scalePercent:i,x:u.x*n.scale,y:u.y*n.scale}}function W(){var t=e("#AJSRCVp").streamBoundaries("getPositionData"),n=d.uploads[d.currentupload],r=X();if(!n.canvasZoom){n.canvasZoom={width:n.canvasWidth?n.canvasWidth:n.croppedWidth,height:n.canvasHeight?n.canvasHeight:n.croppedHeight,scalePercent:1}}n.canvasZoom.x=t.x*r.scale;n.canvasZoom.y=t.y*r.scale}function X(){var t=d.uploads[d.currentupload],n=t.croppedWidth,r=t.croppedHeight,i=t.canvasWidth?t.canvasWidth:n,s=t.canvasHeight?t.canvasHeight:r,o=n/r,u,a,f=1;if(n>r){a=s;u=s*o;if(u<i){u=i;a=i/o}}else{u=i;a=i/o;if(a<s){a=s;u=s*o}}if(r>h.VP_MAX_HEIGHT){var l=e("#AJSRITrack").streamBoundaries("getPositionData"),c=e("#AJSResImg"),p=c.is(":visible"),v=p?c.width():c.data("width"),g=p?c.height():c.data("height"),y=l.x2-l.x,b=l.y2-l.y,w=t.width,E=t.height;y*=w/v;b*=E/g;var S=m(y,b,d.s.maxWidth,d.s.maxHeight),x=L(t,S);f=a/h.VP_MAX_HEIGHT;a=h.VP_MAX_HEIGHT;u/=f;r=x.thumbHeight;n=x.thumbWidth;if(r<a){r=S.height;n=S.width}if(u<i){u=i;a=u/o}}return{width:n-u,height:r-a,minWidth:u,minHeight:a,scale:x.scale}}function V(e){if(d.s.readonly){e=!1}if(a){if(e){r.body.ondragover=J;r.body.ondrop=K}else{r.body.ondragover=null;r.body.ondrop=null}}if(u){var t=H("AJS");if(e){t.onpaste=Q}else{t.onpaste=null}}}function J(t){var n=t.dataTransfer;if(!P(n.types,"Files")&&!P(n.types,"text/uri-list")){return}if(e(t.target).closest(".AJSBtn,.AJSInlineDrop").parent().length){e(".AJSInlineDrop").removeClass(s);e(".AJSBtn").addClass(s)}else{e(".AJSInlineDrop").addClass(s);e(".AJSBtn").removeClass(s)}if(t.target.id==="AJSMainOverlay"){e("#AJSDropZone").addClass(s)}else{t.stopPropagation();t.preventDefault();n.dropEffect="copy";e("#AJSDropZone").removeClass(s)}}function K(t){t.stopPropagation();t.preventDefault();e(".AJSInlineDrop").css({display:"none"});var n=e(t.target);if(n.closest("#AJS,.AJSInlineDrop").length){e("#AJSLoading").removeClass(s);if(n.closest(".AJSInlineDrop").length){var r=n.parent().find(".AJSBtn");r.click().removeClass(s)}var i=t.dataTransfer,u=i.files;for(var a=0;a<u.length;a++){if(!u[a].type.match(d.s.accept)){u[a]=null}}if(!u.length&&c){var f=d.uploads.length+1;if(f>d.s.maxFiles){streamConfirm(S("Maximum files exceeded"),{Close:o},S("You have selected {0} files but are only permitted to upload {1}",f,d.s.maxFiles),{nocancel:!0});e("#AJSDropZone").addClass(s);e("#AJSLoading").addClass(s);return}V();var l=function(){V(!0)},h=i.getData("url");if(!h){h=i.getData("text/plain");if(!h){h=i.getData("text/uri-list");if(!h){e("#AJSLoading").addClass(s);return}}}d.event("filesloading",null,{original:d[0],toload:d.toload,loaded:d.loaded,uploads:d.uploads,stream:d});e.ajax({url:d.s.uploadScript+"?external=true",type:"post",dataType:"json",data:{filesrc:h,uploaddir:d.s.uploadTo}}).done(function(t){if(t.result==="OK"){l();var n=d.uploads.length;t.data.index=n;d.uploads[n]=t.data;d.currentlength++;e("#AJSFile,#AJSFileLegacy").val(null);e("#AJSUploadSection").addClass(s);e("#AJSImagePreview").removeClass(s);d.toggleLR();d.event("filesloaded",null,{loaded:d.loaded,original:d[0],uploads:d.uploads,stream:d});d.changing=!1;d.toload=d.loaded=0;if(t.data.mimetype.match("image/*")){var r=new Image;r.onload=function(){this.imageloaded=!0;ZZ.images["AJSIMG_"+d.id+n]=r;d.displayUpload(null,!0)};r.onerror=function(){d.uploads.splice(n,1);streamConfirm(S("Error"),{Close:l},S("There was an error processing the external file you dropped"),{nocancel:!0})};r.src=t.data.src+"?cachekill="+(new Date).getTime()}else{d.displayUpload(null,!0)}}else{streamConfirm(S("Error"),{Close:l},S("There was an error processing the external file you dropped"),{nocancel:!0})}}).fail(function(){e("#AJSLoading").addClass(s);streamConfirm(S("Error"),{Close:l},S("There was an error processing the external file you dropped"),{nocancel:!0})});e("#AJSDropZone").addClass(s);return}e("#AJSDropZone").addClass(s);d.addingmore=!0;d.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:u}})}}function Q(e){var t=e.clipboardData.items,n=t.length;for(var r=0;r<t.length;r++){if(!t[r].type.match(d.s.accept)){t[r]=null;n--}}if(!n){return}d.toload=n;d.loaded=0;var i=n+d.uploads.length;if(i>d.s.maxFiles){streamConfirm(S("Maximum files exceeded"),{Close:o},S("You have selected {0} files but are only permitted to upload {1}",i,d.s.maxFiles),{nocancel:!0});n=d.toload=d.s.maxFiles-d.uploads.length}for(var r=0;r<n;r++){var s=t[r];if(!s){continue}var u=s.getAsFile();if(u&&u.size){d.addingmore=!0;d.process(u,r)}else{streamConfirm(S("Error"),{Close:o},S("There was an error processing the file you pasted"),{nocancel:!0})}}}function G(){var t="AJSIMG_"+d.id+d.currentupload,n=e("#"+t);if(n.is(":visible")){n.css({top:(500-n.height())/2})}var r=e("#AJS");r.css({marginLeft:-(r.width()/2),marginTop:-(r.height()/2)})}function Y(){var e="",t=d.uploads,n=parseFloat(d.s.iconPreviewHeight),r=parseFloat(d.s.iconPreviewWidth),i=0;for(var o in t){var u=t[o],a=u.mimetype.replace(/\/.*$/,""),l=a==="image",c;if(l){var h,p=u.canvasWidth?u.canvasWidth:u.croppedWidth,v=u.canvasHeight?u.canvasHeight:u.croppedHeight;if(p<v){h="height: 100%;width: auto;"}else{var m=p/v,v=r/m;h="width: 100%;height: auto;margin-top:"+(n-v)/2+"px;"}c=z.getHtml("img",null,null,null,{src:u.newsrc,style:h})}else{c=z.getSpan(null,null,k(a,u.mimetype),{style:"line-height:"+n+"px;font-size:"+(r-20)+"px;"})}c+=z.getDiv(u.name,null,"AJSFPName");e+=z.getDiv(c,"AJSFP_"+d.id+"_"+u.index,"AJSFP",{style:"width:"+r+"px;height:"+n+"px;"});i++}if(d.s.maxFiles&&t.length+1<=d.s.maxFiles&&d.uploads.length&&f){e+=z.getSpan(null,"AJSUploadBtn_"+d.id,"asicons-plus AJSBtn AJSFPBtn",{style:"height:"+n+"px;line-height:"+n+"px;","data-ajaxstreamid":d.c})}if(!i){e+=z.getSpan(S("Upload"),"AJSUploadBtn_"+d.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":d.c})+z.getSpan(S("Drop"),"AJSDropZone_"+d.id,"AJSInlineDrop "+s)}return e}var d=this;if(d.length>1){d.each(function(){e(this).ajaxStream(l)});return d}else if(!d.length){return d}var v=e("body");d.c=n;d.currentupload=null;d.currentlength=0;d.changing=!1;d.toload=0;d.loaded=0;d.uploads=[];d.addingmore=!1;d.existingedited=!1;d.s=e.extend(e.extend({},p),l);if(typeof S!=="function"){function S(e){e===e;return d.s.translateFunction.apply(null,arguments)}}d.id=[d.c,"_",d.prop("id")].join("");d.filedata={};d.event=function(e,t){return d.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};d.legacyUpload=function(n){var r=d.changing===!1?d.uploads.length:d.changing;d.filedata={aspectRatioLocked:!1,base64:null,canvasWidth:null,canvasHeight:null,canvasZoom:null,croppedWidth:null,croppedHeight:null,index:r,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null};t["AJSLegacy"]=ZZ.streams[d.id];e("#AJSLegacy").val(JSON.stringify({maxsize:d.s.maxFileSize,maxheight:d.s.maxHeight,maxwidth:d.s.maxWidth,uploaddir:d.s.uploadTo,islegacy:!0,id:d.id}));var i=e("#AJSFileLegacy"),o=i.clone();o.insertAfter(i);i[0].id=null;e("#AJSLegacyForm").prop({action:d.s.uploadScript+"?newupload=true"}).append(i);o.unbind("change",d.filechanged).change(d.filechanged);d.event("legacyuploadstart",n,{original:d[0],stream:d,uploads:d.uploads});H("AJSLegacyForm").submit();e("#AJSLoading").removeClass(s)};d.afterLegacyUpload=function(n){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove();e("#AJSLoading").addClass(s);if(n.moved){if(n.mimetype.match("image/*")){d.filedata.croppedWidth=d.filedata.resizedWidth=n.width;d.filedata.croppedHeight=d.filedata.resizedHeight=n.height}d.currentlength++;d.filedata.newsrc=n.location;d.filedata.src=n.location;d.filedata.name=n.name;d.filedata.size=n.size;d.filedata.mimetype=n.mimetype;d.filedata.src=n.location;d.event("legacyuploadfinish",d,{original:d[0],results:n,uploads:d.uploads});d.afterFileRead(d.filedata,d.changing!==!1);t["AJSLegacy"]=null}else{d.event("legacyuploadfail",null,{original:d[0],error:n.error,results:n,uploads:d.uploads,stream:d});streamConfirm(S("Error"),{Close:o},n.error,{nocancel:!0})}};d.filechanged=function(e){var t=e.target.files;if(!t&&e.target.value.match(/^.\:\\/)){d.legacyUpload(this);d.toload=1;return}else if(!t.length){d.changing=!1;return}d.toload=t.length;d.event("fileselected",this,{originalEvent:e.originalEvent,files:t,toload:d.toload,original:d[0],stream:d,jQueryEvent:e,uploads:d.uploads});if(f){for(var n=0;n<r;n++){if(!t[n]){d.toload--}}if(d.toload<=0){streamConfirm(S("Error"),{Close:o},S("There was an error during the upload: the file list is empty",i,d.s.maxFiles),{nocancel:!0})}if(d.changing===!1){var r=d.toload,i=r+d.uploads.length;if(i>d.s.maxFiles){streamConfirm(S("Maximum files exceeded"),{Close:o},S("You have selected {0} files but are only permitted to upload {1}",i,d.s.maxFiles),{nocancel:!0});r=d.toload=d.s.maxFiles-d.uploads.length}for(var n=0;n<r;n++){if(!t[n]){continue}d.process(t[n],n)}}else{d.event("filechanging",this,{originalEvent:e.originalEvent,file:t[0],current:d.uploads[d.changing],original:d[0],jQueryEvent:e,stream:d,uploads:d.uploads});d.process(t[0],d.changing,!0,this)}}else{d.legacyUpload(this)}};d.process=function(n,r,i,u){e("#AJSLoading").removeClass(s);if(F("blob",n)||F("file",n)){var a=new FileReader,f=n.type.match("image/*")&&n.type!=="image/gif";a.onload=function(e){var s=new Blob([e.target.result],{type:n.type}),o=(t.URL||t.webkitURL).createObjectURL(s),a=i?r:d.currentlength,l={aspectRatioLocked:!1,index:a,islegacy:!1,mimetype:n.type,name:n.name,newupload:!0,size:n.size,src:o};if(!i){d.currentlength++}if(f){var c=new Image;c.onload=function(){var e=this;e.imageloaded=!0;l.width=l.resizedWidth=l.croppedWidth=e.width;l.height=l.resizedHeight=l.croppedHeight=e.height;l.canvasWidth=l.canvasHeight=l.canvasZoom=null;l.newsrc=null;l.cropdata={};ZZ.images["AJSIMG_"+d.id+a]=e;d.afterFileRead(l,i,u)};c.onerror=function(){l.src=null;d.afterFileRead(l,i,u)};c.src=o}else{l.newsrc=e.target.result;d.afterFileRead(l,i,u)}};a.onerror=function(t){var n=t.currentTarget.error;e("#AJSLoading").addClass(s);streamConfirm(S("Error"),{Close:o},S("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+n.message,{nocancel:!0});console.error(n.name+": "+n.message)};f?a.readAsArrayBuffer(n):a.readAsDataURL(n)}else{streamConfirm(S("Error"),{Close:o},S("The selection is not a file"),{nocancel:!0})}};d.afterFileRead=function(e,t,n){var r=null;if(t){r=d.uploads[e.index];d.uploads[e.index]=e}else{d.uploads[e.index]?d.uploads[e.index]=e:d.uploads.push(e)}d.attemptProgression(n,e.index,r)};d.attemptProgression=function(t,n,r){d.loaded++;d.event("filesloading",t,{original:d[0],toload:d.toload,loaded:d.loaded,uploads:d.uploads,stream:d});if(d.loaded===d.toload){e("#AJSFile,#AJSFileLegacy").val(null);e("#AJSLoading").addClass(s);e("#AJSUploadSection").addClass(s);e("#AJSImagePreview").removeClass(s);d.toggleLR();var i=d.changing===!1;if(d.changing===!1){d.event("filechanged",t,{original:d[0],newfile:d.uploads.index,oldfile:r,uploads:d.uploads,stream:d})}d.event("filesloaded",t,{loaded:d.loaded,original:d[0],uploads:d.uploads,stream:d});d.changing=!1;d.toload=d.loaded=0;d.displayUpload(null,i)}};d.toggleLR=function(){if(d.uploads.length>1){e("#AJSLRContainer").removeClass(s)}else{e("#AJSLRContainer").addClass(s)}};d.displayUpload=function(t,n){if(d.uploads.length){if(!t){t=d.getCurr(n)}e("#AJSAdd")[d.currentlength+1>d.s.maxFiles?"addClass":"removeClass"](s);var r=t.mimetype.match("image/*"),i=r?t.mimetype==="image/gif"?t.newsrc:t.src:null;d.toggleLR();if(i||!r&&!i){d.drawImage(t,i);d.currentupload=t.index}else{streamConfirm(S("Corrupt upload"),{ok:d.deleteUpload},S("There is no source for this upload meaning that you cannot continue. Click 'ok' to delete"),{nocancel:!0})}}else{d.resetToUpload()}};d.drawImage=function(t,n){var r="AJSIMG_"+d.id+t.index,i=t.mimetype.replace(/\/.*$/,""),o=i==="image",u=f&&c&&o&&t.mimetype!=="image/gif",a=e("#"+r),l=e("#AJSEdit");l.addClass(s);if(a.length){a=x(a,r,o,u)}else{var h="";if(u){h='<canvas id="'+r+'"></canvas>'}else{if(t.mimetype.match("image/*")){h='<img id="'+r+'"/>'}else{h='<span id="'+r+'"><span></span></span>'}}e("#AJSLRContainer").before(h);a=e("#"+r)}if(u){l.removeClass(s);N(a[0],t,ZZ.images[r])}else{if(i==="image"){a[0].src=n}else{a.attr({"class":"AJSMIMEIcons "+k(i,t.mimetype)});a.find("span").html(t.name)}}e('[id^="AJSIMG_"]').addClass(s);var p=a[0].tagName==="CANVAS"?a[0].height:a.height();if(!p){p=t.croppedHeight}a.removeClass(s).css({top:p>500?0:(500-p)/2});e("#AJSLoading").addClass(s);G()};d.setCropped64=function(t,n,r,i,o){if(c){var u=t.getContext("2d"),a=e("#AJSResImg"),f=a.is(":visible"),l=f?a.width():a.data("width"),h=f?a.height():a.data("height"),p=i.x2-i.x,v=i.y2-i.y,g=n.width,y=n.height;p*=g/l;v*=y/h;var b=m(p,v,d.s.maxWidth,d.s.maxHeight),w=b.width,E=b.height,S=w/p,x=E/v,T=-i.x*(g/l)*S,N=-i.y*(y/h)*x,k=g*S,L=y*x;n.croppedWidth=t.width=w;n.croppedHeight=t.height=E;if(r.imageloaded){C(t,u,r,n,{x:T,y:N,outwidth:k,outheight:L},o)}else{e("#AJSLoading").removeClass(s);r.onload=function(){r.imageloaded=!0;C(t,u,r,n,{x:T,y:N,outwidth:k,outheight:L},o);e("#AJSLoading").addClass(s)}}}};d.multipass=function(e,t,n,s,o,u,a){var f=u?u:e.width,l=a?a:e.height,c=s===undefined?0:i.floor(s),h=o===undefined?0:i.floor(o);if(n.width/f>2||n.height/f>2){var p=r.createElement("canvas"),d=p.getContext("2d");p.width=n.width*.5;p.height=n.height*.5;d.drawImage(n,c,h,p.width,p.height);d.drawImage(p,0,0,p.width*.5,p.height*.5);t.drawImage(p,0,0,p.width*.5,p.height*.5,c*.75,h*.75,f,l)}else{t.drawImage(n,c,h,f,l)}};d.resetToUpload=function(){var t=e("#AJSRContainer");e("#AJSUploadSection").removeClass(s);e("#AJSImagePreview").addClass(s);e("#AJSChooseText").removeClass(s);e("#AJSLoading").addClass(s);d.uploads.length?t.removeClass(s):t.addClass(s)};d.getCurr=function(e){if(e){d.currentupload=d.uploads.length-1;return _(d.uploads)}else{if(d.addingmore){var t=_(d.uploads);d.currentupload=t.index;return t}else{if(d.currentupload||d.currentupload===0){return d.uploads[d.currentupload]}d.currentupload=0;return D(d.uploads)}}};d.changePrev=function(e){var t=e?-1:1;var n;if(d.currentupload+t<0){n=_(d.uploads);d.currentupload=d.uploads.length-1}else if(d.currentupload+t>d.uploads.length-1){n=D(d.uploads);d.currentupload=0}else{n=d.uploads[d.currentupload+t];d.currentupload+=t}d.displayUpload(n)};d.iconClick=function(){var t=e(this),n=e(".EIconActive");if(n.data("for")===t.data("for")){return!1}e("#AJSLoading").removeClass(s);var i=e("#AJSRInner"),o=e("#AJSRC");e(".AJSEDivs").addClass(s);e("#"+t.data("for")).removeClass(s);switch(t.data("for")){case"AJSRCan":var u=e("#AJSRITrack").streamBoundaries("getPositionData"),a=d.uploads[d.currentupload],f=a.canvasZoom,l=f?f.scalePercent:!1,c=a.canvasWidth,h=a.canvasHeight,p=e("#AJSResImg"),v=p.width(),g=p.height(),y=c&&h&&f===null,b=u.x2-u.x,w=u.y2-u.y,E=a.width,S=a.height,x=f?f.height:a.croppedHeight;b*=E/v;w*=S/g;var T=m(b,w,d.s.maxWidth,d.s.maxHeight),N=L(a,T);p.attr({"data-width":v,"data-height":g});d.setCropped64(r.createElement("canvas"),a,ZZ.images["AJSIMG_"+d.id+d.currentupload],u);i.addClass(s);o.removeClass(s);H("AJSRCImg").src=a.newsrc;H("AJSCW").value=c?c:a.croppedWidth;H("AJSCH").value=h?h:a.croppedHeight;e("#AJSRCVp").streamBoundaries("updateOpts",{height:N.height,thumbHeight:N.thumbHeight,thumbWidth:N.thumbWidth,width:N.width});if(l||l===0||y){l=y?1:l;var C=e("#AJSCZ").streamBoundaries("reposition",{x:l*100+"%"});q.call(C,C.positionData)}B(h?h:T.height);break;case"AJSWHAR":o.addClass(s);i.removeClass(s)}n.removeClass("EIconActive");t.addClass("EIconActive");e("#AJSLoading").addClass(s)};d.fillEditValues=function(e,t){if(t){var n=d.getScaledDimensions(t,e);H("AJSSAR").value=w(n.aspectRatio);H("AJSSW").value=n.width;H("AJSSH").value=n.height}};d.getScaledDimensions=function(e,t){var n=e.rect,r=n.width,i=n.height,s=g((e.x2-e.x)*(t.width/r)),o=g((e.y2-e.y)*(t.height/i)),u=d.s.maxWidth,a=d.s.maxHeight;var f=m(s,o,u,a);s=f.width;o=f.height;return{width:s,height:o,aspectRatio:s/o}};d.showInfo=function(){e(".AJSEIcon:first").click();e("#AJSLoading").removeClass(s);var n=d.uploads[d.currentupload],i=n.cropdata,o=e("#AJSResImg"),u=e("#AJSRInner"),f=e("#AJSRITrack"),l=ZZ.images["AJSIMG_"+d.id+d.currentupload],c=z.getHtml("img",null,"AJSResImg",null,{src:l.src,"data-top":o.attr("data-top"),"data-bottom":o.attr("data-bottom"),"data-width":o.attr("data-width"),"data-height":o.attr("data-height"),style:o.attr("style")}),h=e("#AJSLockAR");e("#AJSMain > div").addClass(s);e("#AJSMore").removeClass(s);o.remove();u.prepend(c);o=e("#AJSResImg");u.hide();o[0].onload=function(){e("#AJSLoading").addClass(s);u.show();o.css({maxWidth:parseFloat(e(t).width())-20});u.css({width:"auto"});var l=o[0].getBoundingClientRect(),c=l.width,p=l.height,v=d.s.defaultCropWidthPer,m=d.s.defaultCropHeightPer;var g=i.x!==undefined?i.x2-i.x:c*(v>1?1:v),b=i.y!==undefined?i.y2-i.y:p*(m>1?1:m);f.streamBoundaries("updateOpts",{width:c,height:p,thumbWidth:g,thumbHeight:b,onFinish:function(e){e.rect=l;d.fillEditValues(n,e);y(e);d.uploads[d.currentupload].canvasZoom=null}});u.width(c);var w=f.streamBoundaries("reposition",{x:i.x||i.x===0?i.x:(1-v)/2*100,y:i.y||i.y===0?i.y:(1-m)/2*100}).positionData;y(w);w.rect=l;d.fillEditValues(n,w);if(n.aspectRatioLocked){h.removeClass("asicons-lock-open2").addClass("asicons-lock2")}else{h.removeClass("asicons-lock2").addClass("asicons-lock-open2")}e(".AJSEIcon").removeClass("EIconActive").first().click();var E=e("#AJS"),S=(parseFloat(u.height())-p)/2;e("#AJSRBG").css({top:-p,height:p});E.css({minWidth:c>340?c:340,marginLeft:-(E.width()/2)});o.css({marginTop:S}).attr({"data-top":S,"data-bottom":S+p});f.css({marginTop:S});G();if(a){r.body.ondragover=null;r.body.ondrop=null}V()};o[0].src=l.src};d.saveInfo=function(){var t=d.uploads[d.currentupload],n=e("#AJSRITrack").streamBoundaries("getPositionData"),r="AJSIMG_"+d.id+d.currentupload,i=e("#"+r);if(!ZZ.images[r]){var o=new Image;o.onload=function(){this.imageloaded=!0};o.src=t.src+"?cachekill="+(new Date).getTime();ZZ.images[r]=o}d.setCropped64(H(r),t,ZZ.images[r],n,!0);var u={x:n.x,x2:n.x2,y:n.y,y2:n.y2};if(t.cropdata!==u){d.existingedited=!0}t.cropdata=u;e("#AJSMain > div").addClass(s);e("#AJSImagePreview").removeClass(s);e("#AJS").css({minWidth:"initial"});i.css({top:(500-i.height())/2});G();V(!0);e.streamBoundaries.unsetMouseMove()};d.deleteUpload=function(){var t=[],n=!1,r=!1;for(var i=0,o=d.uploads.length;i<o;i++){if(d.uploads[i]&&i!==d.currentupload){var u=d.uploads[i];u.index=t.length;t.push(u);if(r!==!1&&n!==!1){r=i}}else{n=i}}e("#AJSIMG_"+d.id+d.currentupload).remove();d.uploads=t;d.currentlength=d.uploads.length;d.currentupload=r!==!1?r:0;e("#AJS_"+d[0].id).val(U(d.uploads));e("#AJSUploadSection").addClass(s);e("#AJSImagePreview").removeClass(s);d.toggleLR();d.displayUpload()};d.initBinding=function(){var n=f?e("#AJSFile"):e("#AJSFileLegacy");n.unbind("click").click(function(){var t=d.s.accept;if(t===".*"||j(t)&&P(t,".*")){t="*"}var n={accept:t};if(d.s.maxFiles>1){n["multiple"]=!0}e(this).attr(n)});if(f){e("#AJSChooseText").unbind("click").click(function(){d.addingmore=!0;d.changing=!1;n.click()})}V(!0);n.unbind("change").change(d.filechanged);e("#AJSImagePreview").unbind("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e("#AJSAdd").unbind("click").click(function(){if(d.uploads.length+1>d.s.maxFiles){}else{n.click();d.addingmore=!0}});e("#AJSChange").unbind("click").click(function(){d.changing=d.currentupload;d.addingmore=!1;n.click()});e("#AJSL").unbind("click").click(function(){d.changePrev(!0)});e("#AJSR").unbind("click").click(function(){d.changePrev()});var i=H("AJSICancel"),o=H("AJSISave"),u=H("AJSCW"),a=H("AJSCH"),l=H("AJSSAR"),c=H("AJSEdit");if(c){c.onclick=d.showInfo}if(i){i.onclick=function(){e("#AJSMain > div").addClass(s);e("#AJSImagePreview").removeClass(s);var t=e("#"+"AJSIMG_"+d.id+d.currentupload);e("#AJS").css({minWidth:"initial"});t.css({top:(500-t.height())/2});G();V()}}if(o){o.onclick=d.saveInfo}e("#AJSRemove").unbind("click").click(function(){streamConfirm(S("Are you sure you want to remove this file?"),d.deleteUpload,S("This removes the file from the list of files to be uploaded, and not from your computer"))});e("#AJSClose,#AJSCloseText").unbind("click").click(function(){if(!d.s.readonly){e("#AJS_"+d[0].id).val(U(d.uploads))}e("#AJS").hide();if(d.s.showPreviewOnForm){e("#AJSFormPrev_"+d.id).html(Y());e("[id^=AJSUploadBtn_]").unbind("click",A).click(A);e(".AJSFP").unbind("click",O).click(O)}d.event("close",d,{original:d[0],uploads:d.uploads,length:d.uploads.length})});e("[id^=AJSUploadBtn_]").unbind("click",A).click(A);e(".AJSFP").unbind("click",O).click(O);if(l){l.onchange=function(){e("#AJSLockAR").removeClass("asicons-lock-open2").addClass("asicons-lock2");var t,n=this.value,r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=d.uploads[d.currentupload];i.aspectRatioLocked=!0;if(n&&n.match(/^(:?\s+)?\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var s=n.split(/[\/|\:]/);t=s[0]/s[1]}else if(n&&n.match(/^(:?\s+)?(:?\d+|\d+\.\d+)$/)){t=n*1}else{return}var o=H("AJSResImg").getBoundingClientRect(),u=i.width/o.width,a=i.height/o.height,f=r.x2-r.x,l=g(f/t),c=!1,h=!1;if(l+r.y>o.height){h=o.height-l;if(l>o.height){l=o.height;f=g(l*t);h=0;if(f+r.x>o.width){c=o.width-f}}}var p=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:f,thumbHeight:l,x:c,y:h}).positionData;H("AJSSW").value=g(f*u);H("AJSSH").value=g(l*a);y(p)}}if(u){u.onchange=function(){var t=this.value*1,n=t>d.maxWidth?d.maxWidth:t,r=H("AJSCH"),i=r.value*1,s=d.uploads[d.currentupload],o=m(n,i,d.s.maxWidth,d.s.maxHeight,s);this.value=s.canvasWidth=o.width;r.value=s.canvasHeight=o.height;var u=L(s,o),a=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:u.height,thumbHeight:u.thumbHeight,thumbWidth:u.thumbWidth,width:u.width});B(o.height);e("#AJSRCVp").streamBoundaries("reposition");q.call(a,a.positionData)}}if(a){a.onchange=function(){var t=this.value*1,n=t>d.s.maxHeight?d.s.maxHeight:t,r=H("AJSCW"),i=r.value*1,s=d.uploads[d.currentupload],o=m(i,n,d.s.maxWidth,d.s.maxHeight,s);this.value=s.canvasHeight=o.height;r.value=s.canvasWidth=o.width;var u=L(s,o),a=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:u.height,thumbHeight:u.thumbHeight,thumbWidth:u.thumbWidth,width:u.width});B(o.height);e("#AJSRCVp").streamBoundaries("reposition");q.call(a,a.positionData)}}e("#AJSLockAR").click(function(){var t=e(this),n=t.hasClass("asicons-lock-open2");if(n){t.removeClass("asicons-lock-open2").addClass("asicons-lock2")}else{t.removeClass("asicons-lock2").addClass("asicons-lock-open2")}d.uploads[d.currentupload].aspectRatioLocked=n});e(".AJSEIcon").unbind("click",d.iconClick).click(d.iconClick);e(window).unbind("resize",G).resize(G)};d.redraw=function(){e("#AJSFormPrev_"+d.id).html(Y());e("[id^=AJSUploadBtn_]").unbind("click",A).click(A);e(".AJSFP").unbind("click",O).click(O)};d.draw=function(){d.addClass(s);d.attr({"data-ajaxstreamid":d.c});if(I(e("#AJS_"+d[0].id))){var t=e("#AJS_"+d[0].id).val();d.uploads=t.length?R(t,!0):[];d.currentlength=d.uploads.length;for(var n=0;n<d.currentlength;n++){var r=d.uploads[n];if(!r.cropdata){r.cropdata={}}if(r.mimetype.match("image/*")){var i=new Image;i.onload=function(){this.imageloaded=!0};i.src=r.src+"?cachekill="+(new Date).getTime();ZZ.images["AJSIMG_"+d.id+n]=i}}}else{e(z.getInput("AJS_"+d[0].id,null,null,"hidden")).insertAfter(d[0])}if(d.s.showPreviewOnForm){e(z.getDiv(Y(),"AJSFormPrev_"+d.id,"AJSFormPrev",{style:"height:"+d.s.iconPreviewHeight})).insertAfter(d[0])}else{e(z.getSpan(S("Upload"),"AJSUploadBtn_"+d.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":d.c})).insertAfter(d[0])}if(!I(e("#AJS"))){v.append(z.getDiv(E(d.s.pathPrefix),"AJS"));if(f){e("#AJSImagePreview").after(T())}else{b()}e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,scale9Grid:d.s.scale9Grid,onBeforeUpdate:function(){this.s.lockAspectRatio=d.uploads[d.currentupload].aspectRatioLocked},onUpdate:function(e){y(e)}});e("#AJSRCVp").streamBoundaries({crosshair:!1,height:"100%",isViewport:!0,orientation:"2d",onFinish:W,thumbBorder:"none",width:"100%"});e("#AJSCZ").streamBoundaries({bg:"#999",crosshair:!1,height:8,onFinish:q,onUpdate:q,thumbBg:"#444",thumbBorder:"none",thumbHeight:8,thumbWidth:"25%",width:"100%",x:"75%"})}d.initBinding();d.event("init",d,{original:d[0],uploads:d.uploads})}();ZZ.streams[d.id]=d;n++;return d},setUploadData:function(e,t){var n=this;if(F("string",e)){e=R(e)}n.uploads=e?e:[];n.currentlength=n.uploads.length;n.toload=n.loaded=n.currentupload=0;if(t){n.redraw()}}};e.fn.ajaxStream=function(t){var n=v(this);if(d[t]){return d[t].apply(n,Array.prototype.slice.call(arguments,1))}else if(Object.prototype.toString.call(t)==="[object Object]"||!t){return d.init.apply(n,arguments)}else{e.error(["The method ",t," does not exist"].join(""))}};if(typeof M!=="function"){function M(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga",images:{},license:"MIT",streams:{},setDefaults:function(t){p=e.extend(p,t)},version:"2.0.0"};z=new z})(jQuery,this,0,document,Math)