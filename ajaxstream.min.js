(function(e,t,n,r){function b(){if(!M(e(u+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:o+"IFrame"};e("body").append(H[p]("form",H.getInput(o+"Legacy",null,null,"hidden")+H.getInput(o+"FileLegacy",null,null,"file"),o+"LegacyForm",f,t)+H[p]("iframe",null,o+"IFrame",f,{name:o+"IFrame"}))}}function w(){var e=E()+N();return H[c](e,o+"Main")}function E(){var e=S()+H[c](H[h](null,o+"L",o+"LR asicons-arrow-left")+H[h](null,o+"R",o+"LR asicons-arrow-right"),o+"LRContainer");return H[c](e,o+"ImagePreview",f)}function S(){return H[c](H[c](null,o+"ActionsOverlay")+H[c](H[h](null,o+"Add","asicons-plus",{title:C("Add another file")})+H[h](null,o+"Change","asicons-upload",{title:C("Change file")})+H[h](null,o+"Edit","asicons-pencil",{title:C("Edit")})+H[h](null,o+"Remove","asicons-trash",{title:C("Remove file")})+H[h](null,o+"Close","asicons-cross",{title:C("Close window")})),o+"PreviewActions")}function x(e){var t="",n={style:"width:100%;"};if(e){var r=H[c](H[p]("img",null,o+"VPImg"),o+"VPC")+H[c](H[c](null),o+"VPS");t+=H[c](r,o+"VP");n["style"]="width:30%;"}t+=H[c](H[h]()+H[c](T(),o+"CF"),o+"Info",null,n);return H[c](t+H[h](C("Save"),o+"ISave"),o+"More",f)}function T(){var e="",t=ZZ.customFields,n=ZZ.const;for(var r=0;r<t[i];r++){var s=t[r],u;switch(s.type){case n["CF_TEXT"]:default:u="text"}e+=H[c](H[c](H[h](s[v]),null,o+"CFName")+H[c](H.getInput(null,s.value,null,u,{placeholder:s[v],"data-ajsfor":s[v]}),null,o+"CFField"))}return e}function N(){var e=H[h](C("Choose file"),o+"ChooseText",o+"Btn")+H[p]("img",null,o+"Loading",f,{src:"files/loader.gif",title:C("Files are loading")});var t=H[c](H.getInput(o+"File",null,f,"file")+H[c](e,o+"ChooseFile"),o+"ChooseSection");return H[c](t,o+"UploadSection")+H[c](H[p]("a",C("DROP")),o+"DropZone",f)}function k(e){return e.slice(-1)[0]}function L(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function A(e){return r.getElementById(e)}function O(e){return Object.prototype.toString.call(e)==="[object Object]"}function M(e){return e[i]>0}function _(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function D(e,t){var n=JSON.parse(e);return n?t?_(n):n:!1}function P(e){var t=e;if(Object.prototype.toString.call(t)==="[object Array]"){t={};for(var n=0,r=e[i];n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function H(){function t(e,t){if(O(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!O(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e[p]("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}return t(u,o).outerHTML};this.getInput=function(t,n,r,i,s){if(!O(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s[v]){s[v]=t}s.type=i?i:"text";return e[p]("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e[p]("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e[p]("div",t,n,r,i)}}var i="length",s="prop",o="AJS",u="#AJS",a=".AJS",f="AJSHidden",l="replace",c="getDiv",h="getSpan",p="getHtml",d="streamBoundaries",v="name",m="viewportWidth",g=function(){},y={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:g,onfilechanged:g,onfileselected:g,onfilesloaded:g,onfilesloading:g,oninit:g,onlegacyuploadfail:g,onlegacyuploadfinish:g,onlegacyuploadstart:g,onsingleuploadfail:g,onsingleuploadfinish:g,onsingleuploadstart:g,onuploadfail:g,onuploadfinish:g,onuploadprogress:g,onuploadstart:g,quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[i];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e[l](n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,useViewport:!1,verbose:!1,viewportHeight:240,viewportWidth:240};e.fn.ajaxStream=function(p){function V(e,t,n){var r=n.width,i=n.height;if(r>i){if(r>g.s.maxWidth){i=Math.round(i*=g.s.maxWidth/r);r=g.s.maxWidth}}else{if(i>g.s.maxHeight){r=Math.round(r*=g.s.maxHeight/i);i=g.s.maxHeight}}t.resizedWidth=e.width=r;t.resizedHeight=e.height=i;var s=e.getContext("2d");s.drawImage(n,0,0,r,i);t.base64=e.toDataURL("image/jpeg",g.s.quality)}var g=this;if(g[i]>1){g.each(function(){e(this).ajaxStream(p)});return g}else if(!g[i]){return g}var E=e("body"),S=!!(t.Blob||t.File||t.FileList||t.FileReader),T=r.createElement("canvas"),N=!!(T.getContext&&T.getContext("2d")),C="parent",O="addClass",_="removeClass",B="append",j="click",F="unbind",I="change",q="attr",R="uploads",U="currentupload",z="changing",W="currentlength";g.c=n;g[U]=null;g[W]=0;g[z]=!1;g.toload=0;g.loaded=0;g[R]=[];g.addingmore=!1;g.s=e.extend(e.extend({},y),p);if(typeof X!=="undefined"){function X(e){e===e;return g.s.translateFunction.apply(null,arguments)}}g.id=[g.c,"_",g[s]("id")].join("");g.filedata={};g.event=function(e,t){return g.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};g.legacyUpload=function(n){var r=n.files[0],o=g[z]===!1?g[R][i]:g[z];g.filedata={customFields:[],name:r[v],mimetype:r.type,size:r.size,newupload:!0,index:o,islegacy:!0};t["AJSLegacy"]=ZZ.streams[g.id];e(u+"Legacy").val(JSON.stringify({maxsize:g.s.maxFileSize,maxheight:g.s.maxHeight,maxwidth:g.s.maxWidth,uploaddir:g.s.uploadTo,islegacy:!0,id:g.id}));e(u+"LegacyForm")[s]({action:g.s.uploadScript});g.event("legacyuploadstart",n,{original:g,file:r});e(u+"LegacyForm").submit()};g.afterLegacyUpload=function(e){if(e.moved){g.filedata.src=e.location;g.event("legacyuploadfinish",null,{original:g,results:e});g.afterFileRead(g.filedata,g[z]!==!1);t["AJSLegacy"]=null}else{g.event("legacyuploadfail",null,{original:g,error:e.error,results:e});alert(e.error)}};g.filechanged=function(t){var n=t.target.files;if(!n[i]){g[z]=!1;return}g.toload=n[i];g.event("fileselected",this,{originalEvent:t,files:n,toload:g.toload,original:g});if(S){e(u+"ChooseText")[O](f);e(u+"Loading")[_](f);if(g[z]===!1){var r=n[i];var s=r+g[R][i];if(s>g.s.maxFiles){console.warn(X("You have selected {0} files but are only permitted to upload {1}",s,g.s.maxFiles));r=g.toload=g.s.maxFiles-g[R][i]}for(var o=0;o<r;o++){g.process(n[o],o)}}else{g.event("filechanging",this,{originalEvent:t,file:n[0],current:g[R][g[z]],original:g});g.process(n[0],g[z],!0,this)}}else{g.legacyUpload(this)}};g.process=function(e,n,r,i,s){function a(s,u){var a=u||new Blob([s.target.result],{type:e.type}),f=(t.URL||t.webkitURL).createObjectURL(a),l=r?n:g[W],c={customFields:[],index:l,islegacy:!1,mimetype:e.type,name:e[v],newupload:!0,size:e.size,src:f};if(!r){g[W]++}if(e.type.match("image/*")){var h=new Image;h.onload=function(){var e=this;c.width=c.resizedWidth=e.width;c.height=c.resizedHeight=e.height;c.viewport={left:undefined,top:undefined,width:undefined,src:undefined};c.base64=null;ZZ.images[o+"IMG_"+g.id+l]=this;g.afterFileRead(c,r,i)};h.src=f}else{g.afterFileRead(c,r,i)}}if(s){a(null,s)}else{var u=new FileReader;u.onload=a;u.readAsArrayBuffer(e)}};g.afterFileRead=function(e,t,n){var r=null;if(t){r=g[R][e.index];g[R][e.index]=e}else{g[R][e.index]?g[R][e.index]=e:g[R].push(e)}g.attemptProgression(n,e.index,r)};g.attemptProgression=function(t,n,r){g.loaded++;g.event("filesloading",t,{original:g,toload:g.toload,loaded:g.loaded});if(g.loaded===g.toload){e(u+"UploadSection")[O](f);e(u+"ImagePreview")[_](f);g.toggleLR();var i=g[z]===!1;if(g[z]===!1){g.event("filechanged",t,{original:g,"new":g[R][n],old:r})}g.event("filesloaded",t,{loaded:g.loaded,original:g,uploads:g[R]});g[z]=!1;g.toload=g.loaded=0;g.displayUpload(null,i)}};g.toggleLR=function(){if(g[R][i]>1){e(u+"LRContainer")[_](f)}else{e(u+"LRContainer")[O](f)}};g.displayUpload=function(t,n){if(g[R][i]){if(!t){t=g.getCurr(n)}e(u+"Add")[g[W]+1>g.s.maxFiles?O:_](o+"Disabled");var r=t.mimetype.match("image/*")?t.src:g.getIconPath(t.mimetype);g.toggleLR();g.drawImage(t,r)}else{g.resetToUpload()}};g.drawImage=function(t,n){var r=o+"IMG_"+g.id+t.index,s=S&&N&&t.mimetype.match("image/*"),a=e("#"+r);if(!a[i]){e(u+"LRContainer").before((s?'<canvas id="?"></canvas>':'<img id="?" />')[l](/\?/,r));a=e("#"+r)}if(s){V(a[0],t,ZZ.images[r])}else{a[q]({src:n})}e((s?"canvas":"img")+'[id^="AJSIMG_"]')[O](f);a[_](f)};g.getIconPath=function(e){switch(e){default:return""}};g.resetToUpload=function(){var t=e(u+"RContainer");e(u+"UploadSection")[_](f);e(u+"ImagePreview")[O](f);e(u+"ChooseText")[_](f);e(u+"Loading")[O](f);g[R][i]?t[_](f):t[O](f)};g.getCurr=function(e){if(e){g[U]=g[R][i]-1;return k(g[R])}else{if(g.addingmore){var t=k(g[R]);g[U]=t.index;return t}else{if(g[U]||g[U]===0){return g[R][g[U]]}g[U]=0;return L(g[R])}}};g.changePrev=function(e){var t=e?-1:1;var n;if(g[U]+t<0){n=k(g.uploads);g[U]=g[R][i]-1}else if(g[U]+t>g[R][i]-1){n=L(g[R]);g[U]=0}else{n=g[R][g[U]+t];g[U]+=t}g.displayUpload(n)};g.getViewport64=function(e){if(N){var t=r.createElement("canvas"),n=A(o+"VPImg"),i=t.getContext("2d");t.width=g.s[m];t.height=g.s.viewportHeight;i.drawImage(n,e.left,e.top,e.width,n.height);return t.toDataURL("image/jpeg",g.s.quality)}return false};g.showInfo=function(){var t=g[R][g[U]],n=t.customFields;e(u+"Main > div")[O](f);e(u+"More")[_](f);e(u+"Info > span").html(t[v][l](/([\_|\.])/g,"&shy;$1&shy;"));e(u+"Info").css({width:g.s.useViewport?"30%":"100%"});if(n[i]){for(var r=0;r<n[i];r++){var s=n[r];e('[data-ajsfor="'+s.field+'"]').val(s.value)}}if(g.s.useViewport){var o=ZZ.images["AJSIMG_"+g.id+g[U]],c=t.viewport;e(u+"VPImg").attr({src:o.src});e(u+"VPC")[d]("updateOpts",{width:g.s[m],height:g.s.viewportHeight,thumbWidth:c.width?c.width:g.s[m]})[d]("reposition",{x:c.left,y:c.top});e(u+"VPS")[d]("updateOpts",{onUpdate:function(t){var n=o.width-g.s[m];e(u+"VPC")[d]("updateOpts",{thumbWidth:g.s[m]+n*t.px})}})[d]("reposition",{x:(!c.width?0:(c.width-g.s[m])/(o.width-g.s[m])*100)+"%"})}e(a+"CFField:first > input").focus()};g.saveInfo=function(){var t=g[R][g[U]],n=ZZ.customFields,r=[];if(n[i]){for(var s=0;s<n[i];s++){var o=n[s];r.push({field:o[v],value:e('[data-ajsfor="'+o[v]+'"]').val()});e('[data-ajsfor="'+o[v]+'"]').val("")}t.customFields=r}if(g.s.useViewport){var a=e(u+"VPImg"),l={left:parseFloat(a.css("left")),top:parseFloat(a.css("top")),width:parseFloat(a.css("width"))};l["src"]=g.getViewport64(l);t.viewport=l}e(u+"Main > div")[O](f);e(u+"ImagePreview")[_](f)};g.initBinding=function(){var n=S?e(u+"File"):e(u+"FileLegacy");var a=A(o);n[F](j)[j](function(){var t={accept:g.s.accept};if(g.s.maxFiles>1){t["multiple"]=!0}e(this)[q](t)});e(u+"ChooseText")[F](j)[j](function(){g.addingmore=!0;g[z]=!1;n[j]()});if("onpaste"in a){a.onpaste=function(e){var t=(e.clipboardData||e.originalEvent.clipboardData).items,n=t[0].getAsFile(),r=p.accept?".*":p.accept;if(n&&n.type.match(r)&&g[W]<g.s.maxFiles){g.toload=1;g.loaded=0;var i=(new Date).toString()[l](/\ /g,"_")[l](/(\+|\:|\(|\))/g,"");g.process({name:"AjaxStream-Paste-At-"+i+"."+n.type[l](/.+\/(.*)/,"$1"),type:n.type,size:n.size},g[U]+1,false,null,t[0].getAsFile())}}}if("draggable"in r.createElement("span")){r.body.ondragover=function(t){if(e(t.target).closest("#AJS")[i]){t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy";e(u+"DropZone")[_](f)}else{e(u+"DropZone")[O](f)}};r.body.ondrop=function(t){t.stopPropagation();t.preventDefault();if(e(t.target).closest("#AJS")[i]){e(u+"DropZone")[O](f);g.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:t.dataTransfer.files}})}}}n[F](I)[I](g.filechanged);e(u+"")[F]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e(u+"Add")[F](j)[j](function(){if(g[R][i]+1>g.s.maxFiles){}else{n[j]();g.addingmore=!0}});e(u+"Change")[F](j)[j](function(){g[z]=g[U];g.addingmore=!1;n[j]()});e(u+"L")[F](j)[j](function(){g.changePrev(!0)});e(u+"R")[F](j)[j](function(){g.changePrev()});e(u+"Edit")[F](j)[j](g.showInfo);e(u+"ISave")[F](j)[j](g.saveInfo);e(u+"Remove")[F](j)[j](function(){if(confirm(X("Are you sure you want to delete this file?"))){var t=[];for(var n=0,r=g[R][i];n<r;n++){if(g[R][n]&&n!==g[U]){t.push(g[R][n])}}e("#AJSIMG_"+g.id+g[U]).remove();g[R]=t;g[W]=g[R][i];e(u+"_"+g.id).val(P(g[R]));e(u+"UploadSection")[O](f);e(u+"ImagePreview")[_](f);g.toggleLR();g.displayUpload()}});e(u+"Close")[F](j)[j](function(){e(u+"_"+g.id).val(P(g[R]));e(u).hide()});e("[id^=AJSUploadBtn_]")[F](j)[j](function(){var t=e(this)[s]("id")[l](o+"UploadBtn_","");g=ZZ.streams[t];g[R][i]?g.displayUpload():g.resetToUpload();e(u+"").show();if(!g[R][i]){n[j]();g.addingmore=!0}})};g.draw=function(){var t=g[C]();g[O](f);if(M(e(u+"_"+g.id))){var n=e(u+"_"+g.id).val();g[R]=n[i]?D(n,!0):[]}else{t[B](H.getInput(o+"_"+g.id,null,null,"hidden"))}if(g.s.showPreviewOnForm){}else{t[B](H[h](X("Upload"),o+"UploadBtn_"+g.id,o+"Btn",{"data-mandatory":!0}))}if(!M(e(u+""))){E[B](H[c](w(g.s),o));if(!S){b()}e(u+"ImagePreview").after(x(g.s.useViewport,g.s[m],g.s.viewportHeight));if(g.s.useViewport){var r=e(u+"VPC");r[d]({thumbWidth:"auto",bg:"#000",thumbHeight:"auto",isViewport:!0,orientation:"2d"});e(u+"VPS")[d]({onFinish:function(){e(u+"VPC")[d]("reposition")}})}}g.initBinding();g.event("init",g,{original:g[0]})}();ZZ.streams[g.id]=g;n++;return g};if(typeof C!=="function"){function C(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga","const":{CF_TEXT:1},customFields:[],images:{},license:"MIT",streams:{},setDefaults:function(t){y=e.extend(y,t)},submit:function(){},version:.02};H=new H})(jQuery,this,0,document)