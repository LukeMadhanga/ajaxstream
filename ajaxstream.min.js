(function(e,t,n){function h(){if(!L(e(o+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:s+"IFrame"};e("body").append(B.getHtml("form",B.getInput(s+"Legacy",null,null,"hidden")+B.getInput(s+"FileLegacy",null,null,"file"),s+"LegacyForm",a,t)+B.getHtml("iframe",null,s+"IFrame",a,{name:s+"IFrame"}))}}function p(){var e=d()+y();return B.getDiv(e,s+"Main")}function d(){var e=v()+B.getDiv(B.getSpan(null,s+"L",s+"LR asicons-arrow-left")+B.getSpan(null,s+"R",s+"LR asicons-arrow-right"),s+"LRContainer");return B.getDiv(e,s+"ImagePreview",a)}function v(){return B.getDiv(B.getDiv(null,s+"ActionsOverlay")+B.getDiv(B.getSpan(null,s+"Add","asicons-plus",{title:b("Add another file")})+B.getSpan(null,s+"Change","asicons-upload",{title:b("Change file")})+B.getSpan(null,s+"Edit","asicons-pencil",{title:b("Edit")})+B.getSpan(null,s+"Remove","asicons-trash",{title:b("Remove file")})+B.getSpan(null,s+"Close","asicons-cross",{title:b("Close window")})),s+"PreviewActions")}function m(e){var t="",n={style:"width:100%;"};if(e){t=t+=B.getDiv(null,s+"VP");n["style"]="width:30%;"}t+=B.getDiv(B.getSpan()+B.getDiv(g(),s+"CF"),s+"Info",null,n);return B.getDiv(t+B.getSpan(b("Save"),s+"ISave"),s+"More",a)}function g(){var e="",t=ZZ.customFields,n=ZZ.const;for(var i=0;i<t[r];i++){var o=t[i],u;switch(o.type){case n["CF_TEXT"]:default:u="text"}e+=B.getDiv(B.getDiv(B.getSpan(o.name),null,s+"CFName")+B.getDiv(B.getInput(null,o.value,null,u,{placeholder:o.name,"data-ajsfor":o.name}),null,s+"CFField"))}return e}function y(){var e=B.getSpan(b("Choose file"),s+"ChooseText",s+"Btn")+B.getHtml("img",null,s+"Loading",a,{src:"files/loader.gif",title:b("Files are loading")});var t=B.getDiv(B.getInput(s+"File",null,a,"file")+B.getDiv(e,s+"ChooseFile"),s+"ChooseSection");t+=B.getDiv(b("DROP"),s+"DropZone",a);return B.getDiv(t,s+"UploadSection")}function w(e){return e.slice(-1)[0]}function E(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function S(e){return document.getElementById(e)}function x(e){return Object.prototype.toString.call(e)==="[object Object]"}function T(e){return typeof e==="boolean"}function N(e,t){return{name:"AjaxStream::"+e,level:"Cannot continue",message:t,htmlMessage:t,toString:function(){return["Error: AjaxStream::",e," - ",t].join("")}}}function C(e){if(typeof e===undefined||!e||_(e)&&e[r]===0||x(e)&&D(e)===0){return!0}return!1}function k(e){e=e.toLowerCase();switch(e){case"canvas":var n=document.createElement("canvas");return!!(n.getContext&&n.getContext("2d"));case"fileapi":return Boolean(t.Blob||t.File||t.FileList||t.FileReader);case"drag":return"draggable"in document.createElement("span");case"formdata":return typeof FormData==="function";case"xhrprogress":var r=new XMLHttpRequest;return!!(r&&"upload"in r&&"onprogress"in r.upload);case"multiupload":return"multiple"in document.createElement("input");default:throw N("AjaxStream Error",['This function cannot be used to test the feature "',e,'"'].join(""))}}function L(e){return e[r]>0}function A(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function O(e,t){var n=JSON.parse(e);return n?t?A(n):n:!1}function M(e){var t=e;if(_(t)){t={};for(var n=0,i=e[r];n<i;n++){if(!C(e[n])){t[n]=e[n]}}}return JSON.stringify(t)}function _(e){return Object.prototype.toString.call(e)==="[object Array]"}function D(e){var t=0;for(var n in e){if(e.hasOwnProperty(n))t++}return Number(t)}function P(e){return typeof e==="function"}function H(e){return e[i]("id")}function B(){function t(e,t){if(x(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(T(r)){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!x(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,r,i,s){var o=document.createElement(e);if(n){o.innerHTML=n}if(r){o.id=r}if(i){o.className=i}return t(o,s).outerHTML};this.getInput=function(t,n,r,i,s){if(!x(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s.name){s.name=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var r="length",i="prop",s="AJS",o="#AJS",u=".AJS",a="AJSHidden",f="replace",l=function(){},c={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:l,onfilechanged:l,onfileselected:l,onfilesloaded:l,onfilesloading:l,oninit:l,onlegacyuploadfail:l,onlegacyuploadfinish:l,onlegacyuploadstart:l,onsingleuploadfail:l,onsingleuploadfinish:l,onsingleuploadstart:l,onuploadfail:l,onuploadfinish:l,onuploadprogress:l,onuploadstart:l,quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[r];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e[f](n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,useViewport:!1,verbose:!1,viewportHeight:240,viewportWidth:240};e.fn.ajaxStream=function(i){function F(e,t,n){var r=n.width,i=n.height;if(r>i){if(r>l.s.maxWidth){i=Math.round(i*=l.s.maxWidth/r);r=l.s.maxWidth}}else{if(i>l.s.maxHeight){r=Math.round(r*=l.s.maxHeight/i);i=l.s.maxHeight}}t.resizedWidth=e.width=r;t.resizedHeight=e.height=i;var s=e.getContext("2d");s.drawImage(n,0,0,r,i);t.base64=e.toDataURL("image/jpeg",l.s.quality)}var l=this;if(l[r]>1){l.each(function(){e(this).ajaxStream(i)});return l}var d=e("body"),v=k("fileapi"),g=k("canvas"),y="parent",b="addClass",S="removeClass",x="append",T="click",N="unbind",C="change",A="attr",_="uploads",D="currentupload",P="changing";l.c=n;l[D]=null;l.currentlength=0;l[P]=!1;l.toload=0;l.loaded=0;l[_]=[];l.addingmore=!1;l.s=e.extend(e.extend({},c),i);if(typeof j!=="undefined"){function j(e){e===e;return l.s.translateFunction.apply(null,arguments)}}l.id=[l.c,"_",H(l)].join("");l.filedata={};l.event=function(e,t){return l.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};l.legacyUpload=function(n){var i=n.files[0],s=l[P]===!1?l[_][r]:l[P];l.filedata={customFields:[],name:i.name,mimetype:i.type,size:i.size,newupload:!0,index:s,islegacy:!0};t["AJSLegacy"]=ZZ.streams[l.id];e(o+"Legacy").val(JSON.stringify({maxsize:l.s.maxFileSize,maxheight:l.s.maxHeight,maxwidth:l.s.maxWidth,uploaddir:l.s.uploadTo,islegacy:!0,id:l.id}));e(o+"LegacyForm").prop({action:l.s.uploadScript});l.event("legacyuploadstart",n,{original:l,file:i});e(o+"LegacyForm").submit()};l.afterLegacyUpload=function(e){if(e.moved){l.filedata.src=e.location;l.event("legacyuploadfinish",null,{original:l,results:e});l.afterFileRead(l.filedata,l[P]!==!1);t["AJSLegacy"]=null}else{l.event("legacyuploadfail",null,{original:l,error:e.error,results:e});alert(e.error)}};l.filechanged=function(t){var n=t.target.files;if(!n[r]){l[P]=!1;return}l.toload=n[r];l.event("fileselected",this,{originalEvent:t,files:n,toload:l.toload,original:l});if(v){e(o+"ChooseText")[b](a);e(o+"Loading")[S](a);if(l[P]===!1){var i=n[r];var s=i+l[_][r];if(s>l.s.maxFiles){console.warn(j("You have selected {0} files but are only permitted to upload {1}",s,l.s.maxFiles));i=l.toload=l.s.maxFiles-l[_][r]}for(var u=0;u<i;u++){l.process(n[u],u)}}else{l.event("filechanging",this,{originalEvent:t,file:n[0],current:l[_][l[P]],original:l});l.process(n[0],l[P],!0,this)}}else{l.legacyUpload(this)}};l.process=function(e,n,r,i){var o=new FileReader;o.readAsArrayBuffer(e);o.onload=function(o){var u=new Blob([o.target.result],{type:e.type});var a=(t.URL||t.webkitURL).createObjectURL(u);var f=r?n:l.currentlength;var c={customFields:[],index:f,islegacy:!1,mimetype:e.type,name:e.name,newupload:!0,size:e.size,src:a};if(!r){l.currentlength++}if(e.type.match("image/*")){var h=new Image;h.onload=function(){var e=this;c.width=c.resizedWidth=e.width;c.height=c.resizedHeight=e.height;c.viewport={left:undefined,right:undefined,width:undefined,src:undefined};c.base64=null;ZZ.images[s+"IMG_"+l.id+f]=this;l.afterFileRead(c,r,i)};h.src=a}else{l.afterFileRead(c,r,i)}}};l.afterFileRead=function(e,t,n){var r=null;if(t){r=l[_][e.index];l[_][e.index]=e}else{l[_][e.index]?l[_][e.index]=e:l[_].push(e)}l.attemptProgression(n,e.index,r)};l.attemptProgression=function(t,n,r){l.loaded++;l.event("filesloading",t,{original:l,toload:l.toload,loaded:l.loaded});if(l.loaded===l.toload){e(o+"_"+l.id).val(M(l[_]));e(o+"UploadSection")[b](a);e(o+"ImagePreview")[S](a);l.toggleLR();var i=l[P]===!1;if(l[P]===!1){l.event("filechanged",t,{original:l,"new":l[_][n],old:r})}l.event("filesloaded",t,{loaded:l.loaded,original:l,uploads:l[_]});l[P]=!1;l.toload=l.loaded=0;l.displayUpload(null,i)}};l.toggleLR=function(){if(l[_][r]>1){e(o+"LRContainer")[S](a)}else{e(o+"LRContainer")[b](a)}};l.displayUpload=function(e,t){if(l[_][r]){if(!e){e=l.getCurr(t)}var n=e.mimetype.match("image/*")?e.src:l.getIconPath(e.mimetype);l.toggleLR();l.drawImage(e,n)}else{l.resetToUpload()}};l.drawImage=function(t,n){var i=s+"IMG_"+l.id+t.index,u=v&&g&&t.mimetype.match("image/*"),c=e("#"+i);if(!c[r]){e(o+"LRContainer").before((u?'<canvas id="?"></canvas>':'<img id="?" />')[f](/\?/,i));c=e("#"+i)}if(u){F(c[0],t,ZZ.images[i])}else{c[A]({src:n})}e((u?"canvas":"img")+'[id^="AJSIMG_"]')[b](a);c[S](a)};l.getIconPath=function(e){switch(e){default:return""}};l.resetToUpload=function(){var t=e(o+"RContainer");e(o+"UploadSection")[S](a);e(o+"ImagePreview")[b](a);e(o+"ChooseText")[S](a);e(o+"Loading")[b](a);l[_][r]?t[S](a):t[b](a)};l.getCurr=function(e){if(e){l[D]=l[_][r]-1;return w(l[_])}else{if(l.addingmore){var t=w(l[_]);l[D]=t.index-1;return t}else{if(l[D]||l[D]===0){return l[_][l[D]]}l[D]=0;return E(l[_])}}};l.changePrev=function(e){var t=e?-1:1;var n;if(l[D]+t<0){n=w(l.uploads);l[D]=l[_][r]-1}else if(l[D]+t>l[_][r]-1){n=E(l[_]);l[D]=0}else{n=l[_][l[D]+t];l[D]+=t}l.displayUpload(n)};l.showInfo=function(){var t=l[_][l[D]],n=t.customFields;e(o+"Main > div")[b](a);e(o+"More")[S](a);e(o+"Info > span").html(t.name[f](/([\_|\.])/g,"&shy;$1&shy;"));e(o+"Info").css({width:l.s.useViewport?"30%":"100%"});if(n[r]){for(var i=0;i<n[r];i++){var s=n[i];e('[data-ajsfor="'+s.field+'"]').val(s.value)}}if(l.s.useViewport){}e(u+"CFField:first > input").focus()};l.saveInfo=function(){var t=l[_][l[D]],n=ZZ.customFields,i=[];if(n[r]){for(var s=0;s<n[r];s++){var u=n[s];i.push({field:u.name,value:e('[data-ajsfor="'+u.name+'"]').val()});e('[data-ajsfor="'+u.name+'"]').val("")}t.customFields=i}if(l.s.useViewport){}e(o+"Main > div")[b](a);e(o+"ImagePreview")[S](a)};l.initBinding=function(){var n=v?e(o+"File"):e(o+"FileLegacy");n[N](T)[T](function(){var t={accept:l.s.accept};if(l.s.maxFiles>1){t["multiple"]=!0}e(this)[A](t)});e(o+"ChooseText")[N](T)[T](function(){l.addingmore=!0;l[P]=!1;n[T]()});n[N](C)[C](l.filechanged);e(o+"")[N]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(document.selection){document.selection.empty()}});e(o+"Add")[N](T)[T](function(){if(l[_][r]+1>l.s.maxFiles){}else{n[T]();l.addingmore=!0}});e(o+"Change")[N](T)[T](function(){l[P]=l[D];l.addingmore=!1;n[T]()});e(o+"L")[N](T)[T](function(){l.changePrev(!0)});e(o+"R")[N](T)[T](function(){l.changePrev()});e(o+"Edit")[N](T)[T](l.showInfo);e(o+"ISave")[N](T)[T](l.saveInfo);e(o+"Remove")[N](T)[T](function(){if(confirm(j("Are you sure you want to delete this file?"))){var t=[];for(var n=0,i=l[_][r];n<i;n++){if(l[_][n]&&n!==l[D]){t.push(l[_][n])}}e("#AJSIMG_"+l.id+l[D]).remove();l[_]=t;l.currentlength=l[_][r];e(o+"_"+l.id).val(M(l[_]));e(o+"UploadSection")[b](a);e(o+"ImagePreview")[S](a);l.toggleLR();l.displayUpload()}});e(o+"Close")[N](T)[T](function(){e(o).hide()});e("[id^=AJSUploadBtn_]")[N](T)[T](function(){var t=e(this).prop("id")[f](s+"UploadBtn_","");l=ZZ.streams[t];var i=e(o+"_"+l.id).val();l[_]=i[r]?O(i,!0):[];l[_][r]?l.displayUpload():l.resetToUpload();e(o+"").show();if(!l[_][r]){n[T]();l.addingmore=!0}})};l.draw=function(){var t=l[y]();l[b](a);if(L(e(o+"_"+l.id))){l.loadExisting()}else{t[x](B.getInput(s+"_"+l.id,null,null,"hidden"))}if(l.s.showPreviewOnForm){}else{t[x](B.getSpan(j("Upload"),s+"UploadBtn_"+l.id,s+"Btn",{"data-mandatory":!0}))}if(l.s.useViewport&&!e('script[src$="ajaxstreamviewport.js"]')[r]&&l.s.loadRequiredFiles){var n=document.createElement("script");n.type="text/javascript";n.src="ajaxstreamviewport.js";n.onload=function(){};e("head").append(n)}if(!L(e(o+""))){d[x](B.getDiv(p(l.s),s));if(!v){h()}e(o+"ImagePreview").after(m(l.s.useViewport))}l.initBinding();l.event("init",l,{original:l[0]})}();ZZ.streams[l.id]=l;n++;return l};if(typeof b!=="function"){function b(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga","const":{CF_TEXT:1},customFields:[],images:{},license:"MIT",streams:{},setDefaults:function(t){c=e.extend(c,t)},submit:function(){},version:.02};B=new B})(jQuery,this,0)