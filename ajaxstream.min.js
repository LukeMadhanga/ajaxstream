(function(e,t,n,r){function p(){if(!A(e(u+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:o+"IFrame"};e("body").append(B.getHtml("form",B.getInput(o+"Legacy",null,null,"hidden")+B.getInput(o+"FileLegacy",null,null,"file"),o+"LegacyForm",f,t)+B.getHtml("iframe",null,o+"IFrame",f,{name:o+"IFrame"}))}}function d(){var e=v()+b();return B.getDiv(e,o+"Main")}function v(){var e=m()+B.getDiv(B.getSpan(null,o+"L",o+"LR asicons-arrow-left")+B.getSpan(null,o+"R",o+"LR asicons-arrow-right"),o+"LRContainer");return B.getDiv(e,o+"ImagePreview",f)}function m(){return B.getDiv(B.getDiv(null,o+"ActionsOverlay")+B.getDiv(B.getSpan(null,o+"Add","asicons-plus",{title:w("Add another file")})+B.getSpan(null,o+"Change","asicons-upload",{title:w("Change file")})+B.getSpan(null,o+"Edit","asicons-pencil",{title:w("Edit")})+B.getSpan(null,o+"Remove","asicons-trash",{title:w("Remove file")})+B.getSpan(null,o+"Close","asicons-cross",{title:w("Close window")})),o+"PreviewActions")}function g(e){var t="",n={style:"width:100%;"};if(e){var r=B.getDiv(B.getHtml("img",null,o+"VPImg"),o+"VPC")+B.getDiv(B.getDiv(null),o+"VPS");t+=B.getDiv(r,o+"VP");n["style"]="width:30%;"}t+=B.getDiv(B.getSpan()+B.getDiv(y(),o+"CF"),o+"Info",null,n);return B.getDiv(t+B.getSpan(w("Save"),o+"ISave"),o+"More",f)}function y(){var e="",t=ZZ.customFields,n=ZZ.const;for(var r=0;r<t[i];r++){var s=t[r],u;switch(s.type){case n["CF_TEXT"]:default:u="text"}e+=B.getDiv(B.getDiv(B.getSpan(s.name),null,o+"CFName")+B.getDiv(B.getInput(null,s.value,null,u,{placeholder:s.name,"data-ajsfor":s.name}),null,o+"CFField"))}return e}function b(){var e=B.getSpan(w("Choose file"),o+"ChooseText",o+"Btn")+B.getHtml("img",null,o+"Loading",f,{src:"files/loader.gif",title:w("Files are loading")});var t=B.getDiv(B.getInput(o+"File",null,f,"file")+B.getDiv(e,o+"ChooseFile"),o+"ChooseSection");return B.getDiv(t,o+"UploadSection")+B.getDiv(B.getHtml("a",w("DROP")),o+"DropZone",f)}function E(e){return e.slice(-1)[0]}function S(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function x(e){return r.getElementById(e)}function T(e){return Object.prototype.toString.call(e)==="[object Object]"}function N(e){return typeof e==="boolean"}function C(e,t){return{name:"AjaxStream::"+e,level:"Cannot continue",message:t,htmlMessage:t,toString:function(){return["Error: AjaxStream::",e," - ",t].join("")}}}function k(e){if(typeof e===undefined||!e||D(e)&&e[i]===0||T(e)&&P(e)===0){return!0}return!1}function L(e){e=e.toLowerCase();switch(e){case"canvas":var n=r.createElement("canvas");return!!(n.getContext&&n.getContext("2d"));case"fileapi":return Boolean(t.Blob||t.File||t.FileList||t.FileReader);case"drag":return"draggable"in r.createElement("span");case"formdata":return typeof FormData==="function";case"xhrprogress":var i=new XMLHttpRequest;return!!(i&&"upload"in i&&"onprogress"in i.upload);case"multiupload":return"multiple"in r.createElement("input");default:throw C("AjaxStream Error",['This function cannot be used to test the feature "',e,'"'].join(""))}}function A(e){return e[i]>0}function O(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function M(e,t){var n=JSON.parse(e);return n?t?O(n):n:!1}function _(e){var t=e;if(D(t)){t={};for(var n=0,r=e[i];n<r;n++){if(!k(e[n])){t[n]=e[n]}}}return JSON.stringify(t)}function D(e){return Object.prototype.toString.call(e)==="[object Array]"}function P(e){var t=0;for(var n in e){if(e.hasOwnProperty(n))t++}return Number(t)}function H(e){return e[s]("id")}function B(){function t(e,t){if(T(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(N(r)){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!T(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}return t(u,o).outerHTML};this.getInput=function(t,n,r,i,s){if(!T(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s.name){s.name=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var i="length",s="prop",o="AJS",u="#AJS",a=".AJS",f="AJSHidden",l="replace",c=function(){},h={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:c,onfilechanged:c,onfileselected:c,onfilesloaded:c,onfilesloading:c,oninit:c,onlegacyuploadfail:c,onlegacyuploadfinish:c,onlegacyuploadstart:c,onsingleuploadfail:c,onsingleuploadfinish:c,onsingleuploadstart:c,onuploadfail:c,onuploadfinish:c,onuploadprogress:c,onuploadstart:c,quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[i];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e[l](n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,useViewport:!1,verbose:!1,viewportHeight:240,viewportWidth:240};e.fn.ajaxStream=function(s){function R(e,t,n){var r=n.width,i=n.height;if(r>i){if(r>c.s.maxWidth){i=Math.round(i*=c.s.maxWidth/r);r=c.s.maxWidth}}else{if(i>c.s.maxHeight){r=Math.round(r*=c.s.maxHeight/i);i=c.s.maxHeight}}t.resizedWidth=e.width=r;t.resizedHeight=e.height=i;var s=e.getContext("2d");s.drawImage(n,0,0,r,i);t.base64=e.toDataURL("image/jpeg",c.s.quality)}var c=this;if(c[i]>1){c.each(function(){e(this).ajaxStream(s)});return c}else if(!c[i]){return c}var v=e("body"),m=L("fileapi"),y=L("canvas"),b="parent",w="addClass",T="removeClass",N="append",C="click",k="unbind",O="change",D="attr",P="uploads",j="currentupload",F="changing",I="currentlength";c.c=n;c[j]=null;c[I]=0;c[F]=!1;c.toload=0;c.loaded=0;c[P]=[];c.addingmore=!1;c.s=e.extend(e.extend({},h),s);if(typeof q!=="undefined"){function q(e){e===e;return c.s.translateFunction.apply(null,arguments)}}c.id=[c.c,"_",H(c)].join("");c.filedata={};c.event=function(e,t){return c.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};c.legacyUpload=function(n){var r=n.files[0],s=c[F]===!1?c[P][i]:c[F];c.filedata={customFields:[],name:r.name,mimetype:r.type,size:r.size,newupload:!0,index:s,islegacy:!0};t["AJSLegacy"]=ZZ.streams[c.id];e(u+"Legacy").val(JSON.stringify({maxsize:c.s.maxFileSize,maxheight:c.s.maxHeight,maxwidth:c.s.maxWidth,uploaddir:c.s.uploadTo,islegacy:!0,id:c.id}));e(u+"LegacyForm").prop({action:c.s.uploadScript});c.event("legacyuploadstart",n,{original:c,file:r});e(u+"LegacyForm").submit()};c.afterLegacyUpload=function(e){if(e.moved){c.filedata.src=e.location;c.event("legacyuploadfinish",null,{original:c,results:e});c.afterFileRead(c.filedata,c[F]!==!1);t["AJSLegacy"]=null}else{c.event("legacyuploadfail",null,{original:c,error:e.error,results:e});alert(e.error)}};c.filechanged=function(t){var n=t.target.files;if(!n[i]){c[F]=!1;return}c.toload=n[i];c.event("fileselected",this,{originalEvent:t,files:n,toload:c.toload,original:c});if(m){e(u+"ChooseText")[w](f);e(u+"Loading")[T](f);if(c[F]===!1){var r=n[i];var s=r+c[P][i];if(s>c.s.maxFiles){console.warn(q("You have selected {0} files but are only permitted to upload {1}",s,c.s.maxFiles));r=c.toload=c.s.maxFiles-c[P][i]}for(var o=0;o<r;o++){c.process(n[o],o)}}else{c.event("filechanging",this,{originalEvent:t,file:n[0],current:c[P][c[F]],original:c});c.process(n[0],c[F],!0,this)}}else{c.legacyUpload(this)}};c.process=function(e,n,r,i,s){function a(s,u){var a=u||new Blob([s.target.result],{type:e.type}),f=(t.URL||t.webkitURL).createObjectURL(a),l=r?n:c[I],h={customFields:[],index:l,islegacy:!1,mimetype:e.type,name:e.name,newupload:!0,size:e.size,src:f};if(!r){c[I]++}if(e.type.match("image/*")){var p=new Image;p.onload=function(){var e=this;h.width=h.resizedWidth=e.width;h.height=h.resizedHeight=e.height;h.viewport={left:undefined,top:undefined,width:undefined,src:undefined};h.base64=null;ZZ.images[o+"IMG_"+c.id+l]=this;c.afterFileRead(h,r,i)};p.src=f}else{c.afterFileRead(h,r,i)}}if(s){a(null,s)}else{var u=new FileReader;u.onload=a;u.readAsArrayBuffer(e)}};c.afterFileRead=function(e,t,n){var r=null;if(t){r=c[P][e.index];c[P][e.index]=e}else{c[P][e.index]?c[P][e.index]=e:c[P].push(e)}c.attemptProgression(n,e.index,r)};c.attemptProgression=function(t,n,r){c.loaded++;c.event("filesloading",t,{original:c,toload:c.toload,loaded:c.loaded});if(c.loaded===c.toload){e(u+"_"+c.id).val(_(c[P]));e(u+"UploadSection")[w](f);e(u+"ImagePreview")[T](f);c.toggleLR();var i=c[F]===!1;if(c[F]===!1){c.event("filechanged",t,{original:c,"new":c[P][n],old:r})}c.event("filesloaded",t,{loaded:c.loaded,original:c,uploads:c[P]});c[F]=!1;c.toload=c.loaded=0;c.displayUpload(null,i)}};c.toggleLR=function(){if(c[P][i]>1){e(u+"LRContainer")[T](f)}else{e(u+"LRContainer")[w](f)}};c.displayUpload=function(t,n){if(c[P][i]){if(!t){t=c.getCurr(n)}e(u+"Add")[c[I]+1>c.s.maxFiles?w:T](o+"Disabled");var r=t.mimetype.match("image/*")?t.src:c.getIconPath(t.mimetype);c.toggleLR();c.drawImage(t,r)}else{c.resetToUpload()}};c.drawImage=function(t,n){var r=o+"IMG_"+c.id+t.index,s=m&&y&&t.mimetype.match("image/*"),a=e("#"+r);if(!a[i]){e(u+"LRContainer").before((s?'<canvas id="?"></canvas>':'<img id="?" />')[l](/\?/,r));a=e("#"+r)}if(s){R(a[0],t,ZZ.images[r])}else{a[D]({src:n})}e((s?"canvas":"img")+'[id^="AJSIMG_"]')[w](f);a[T](f)};c.getIconPath=function(e){switch(e){default:return""}};c.resetToUpload=function(){var t=e(u+"RContainer");e(u+"UploadSection")[T](f);e(u+"ImagePreview")[w](f);e(u+"ChooseText")[T](f);e(u+"Loading")[w](f);c[P][i]?t[T](f):t[w](f)};c.getCurr=function(e){if(e){c[j]=c[P][i]-1;return E(c[P])}else{if(c.addingmore){var t=E(c[P]);c[j]=t.index-1;return t}else{if(c[j]||c[j]===0){return c[P][c[j]]}c[j]=0;return S(c[P])}}};c.changePrev=function(e){var t=e?-1:1;var n;if(c[j]+t<0){n=E(c.uploads);c[j]=c[P][i]-1}else if(c[j]+t>c[P][i]-1){n=S(c[P]);c[j]=0}else{n=c[P][c[j]+t];c[j]+=t}c.displayUpload(n)};c.getViewport64=function(e){if(y){var t=r.createElement("canvas"),n=x(o+"VPImg"),i=t.getContext("2d");t.width=c.s.viewportWidth;t.height=c.s.viewportHeight;i.drawImage(n,e.left,e.top,e.width,n.height);return t.toDataURL("image/jpeg",c.s.quality)}return false};c.showInfo=function(){var t=c[P][c[j]],n=t.customFields;e(u+"Main > div")[w](f);e(u+"More")[T](f);e(u+"Info > span").html(t.name[l](/([\_|\.])/g,"&shy;$1&shy;"));e(u+"Info").css({width:c.s.useViewport?"30%":"100%"});if(n[i]){for(var r=0;r<n[i];r++){var s=n[r];e('[data-ajsfor="'+s.field+'"]').val(s.value)}}if(c.s.useViewport){var o=ZZ.images["AJSIMG_"+c.id+c[j]],h=t.viewport;e(u+"VPImg").attr({src:o.src});e(u+"VPC").streamBoundaries("updateOpts",{width:c.s.viewportWidth,height:c.s.viewportHeight,thumbWidth:h.width?h.width:c.s.viewportWidth}).streamBoundaries("reposition",{x:h.left,y:h.top});e(u+"VPS").streamBoundaries("updateOpts",{onUpdate:function(t){var n=o.width-c.s.viewportWidth;e(u+"VPC").streamBoundaries("updateOpts",{thumbWidth:c.s.viewportWidth+n*t.px})}}).streamBoundaries("reposition",{x:(!h.width?0:(h.width-c.s.viewportWidth)/(o.width-c.s.viewportWidth)*100)+"%"})}e(a+"CFField:first > input").focus()};c.saveInfo=function(){var t=c[P][c[j]],n=ZZ.customFields,r=[];if(n[i]){for(var s=0;s<n[i];s++){var o=n[s];r.push({field:o.name,value:e('[data-ajsfor="'+o.name+'"]').val()});e('[data-ajsfor="'+o.name+'"]').val("")}t.customFields=r}if(c.s.useViewport){var a=e(u+"VPImg"),l={left:parseFloat(a.css("left")),top:parseFloat(a.css("top")),width:parseFloat(a.css("width"))};l["src"]=c.getViewport64(l);t.viewport=l}e(u+"Main > div")[w](f);e(u+"ImagePreview")[T](f)};c.initBinding=function(){var n=m?e(u+"File"):e(u+"FileLegacy");var s=x(o);n[k](C)[C](function(){var t={accept:c.s.accept};if(c.s.maxFiles>1){t["multiple"]=!0}e(this)[D](t)});e(u+"ChooseText")[k](C)[C](function(){c.addingmore=!0;c[F]=!1;n[C]()});s.onpaste=function(e){var t=(e.clipboardData||e.originalEvent.clipboardData).items,n=t[0].getAsFile();if(n&&n.type.match(c.s.accept)&&c[I]<c.s.maxFiles){c.toload=1;c.loaded=0;var r=(new Date).toString()[l](/\ /g,"_")[l](/(\+|\:|\(|\))/g,"");c.process({name:"AjaxStream-Paste-At-"+r+"."+n.type[l](/.+\/(.*)/,"$1"),type:n.type,size:n.size},c[j]+1,false,null,t[0].getAsFile())}};if(L("drag")){r.body.ondragover=function(t){if(e(t.target).closest("#AJS")[i]){t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy";e(u+"DropZone")[T](f)}else{e(u+"DropZone")[w](f)}};r.body.ondrop=function(t){if(e(t.target).closest("#AJS")[i]){t.stopPropagation();t.preventDefault();e(u+"DropZone")[w](f);c.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:t.dataTransfer.files}})}}}n[k](O)[O](c.filechanged);e(u+"")[k]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e(u+"Add")[k](C)[C](function(){if(c[P][i]+1>c.s.maxFiles){}else{n[C]();c.addingmore=!0}});e(u+"Change")[k](C)[C](function(){c[F]=c[j];c.addingmore=!1;n[C]()});e(u+"L")[k](C)[C](function(){c.changePrev(!0)});e(u+"R")[k](C)[C](function(){c.changePrev()});e(u+"Edit")[k](C)[C](c.showInfo);e(u+"ISave")[k](C)[C](c.saveInfo);e(u+"Remove")[k](C)[C](function(){if(confirm(q("Are you sure you want to delete this file?"))){var t=[];for(var n=0,r=c[P][i];n<r;n++){if(c[P][n]&&n!==c[j]){t.push(c[P][n])}}e("#AJSIMG_"+c.id+c[j]).remove();c[P]=t;c[I]=c[P][i];e(u+"_"+c.id).val(_(c[P]));e(u+"UploadSection")[w](f);e(u+"ImagePreview")[T](f);c.toggleLR();c.displayUpload()}});e(u+"Close")[k](C)[C](function(){e(u).hide()});e("[id^=AJSUploadBtn_]")[k](C)[C](function(){var t=e(this).prop("id")[l](o+"UploadBtn_","");c=ZZ.streams[t];var r=e(u+"_"+c.id).val();c[P]=r[i]?M(r,!0):[];c[P][i]?c.displayUpload():c.resetToUpload();e(u+"").show();if(!c[P][i]){n[C]();c.addingmore=!0}})};c.draw=function(){var t=c[b]();c[w](f);if(A(e(u+"_"+c.id))){c.loadExisting()}else{t[N](B.getInput(o+"_"+c.id,null,null,"hidden"))}if(c.s.showPreviewOnForm){}else{t[N](B.getSpan(q("Upload"),o+"UploadBtn_"+c.id,o+"Btn",{"data-mandatory":!0}))}if(!A(e(u+""))){v[N](B.getDiv(d(c.s),o));if(!m){p()}e(u+"ImagePreview").after(g(c.s.useViewport,c.s.viewportWidth,c.s.viewportHeight));if(c.s.useViewport){var n=e(u+"VPC");n.streamBoundaries({thumbWidth:"auto",bg:"#000",thumbHeight:"auto",isViewport:!0,orientation:"2d"});e(u+"VPS").streamBoundaries({onFinish:function(){e(u+"VPC").streamBoundaries("reposition")}})}}c.initBinding();c.event("init",c,{original:c[0]})}();ZZ.streams[c.id]=c;n++;return c};if(typeof w!=="function"){function w(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga","const":{CF_TEXT:1},customFields:[],images:{},license:"MIT",streams:{},setDefaults:function(t){h=e.extend(h,t)},submit:function(){},version:.02};B=new B})(jQuery,this,0,document)