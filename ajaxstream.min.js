(function(e,t,n,r){function g(e){var t=e.data("ajaxstreamid");return t||t===0?ZZ.streams[t+"_"+e[0].id]:e}function y(e,t,n,r){if(e>t){if(e>n){t=b(t*=n/e);e=n}}else{if(t>r){e=b(e*=r/t);t=r}}return{width:Number(e),height:Number(t)}}function b(e){return Math.round(e)}function w(t){var n=t.x2-t.x;e("#AJSCropT").css({width:n,height:t.y,left:t.x,top:0});e("#AJSCropR").css({width:t.trackWidth-t.x2,height:t.trackHeight,right:0,top:0});e("#AJSCropB").css({width:n,height:t.trackHeight-t.y2,left:t.x,bottom:0});e("#AJSCropL").css({width:t.x,height:t.trackHeight,left:0,top:0})}function E(){if(!q(e("#AJSLegacy"))){var t={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(W.getHtml("form",W.getInput("AJSLegacy",null,null,"hidden")+W.getInput(null,"submit",null,"submit"),"AJSLegacyForm",u,t)+W.getHtml("iframe",null,"AJSIFrame",u,{name:"AJSIFrame"}))}}function S(e){var t=1e-15,n,r,i,s,o,u,a,f=e;a=Math.floor(f);r=1;o=0;n=a;s=1;while(f-a>t*s*s){f=1/(f-a);a=Math.floor(f);i=r;r=n;u=o;o=s;n=i+a*r;s=u+a*o}return n+":"+s}function x(e){var t=T()+M();return W.getDiv(null,"AJSMainOverlay")+W.getDiv(t+W.getHtml("img",null,"AJSLoading",u,{src:e+"/files/loader.gif",title:D("Files are loading")}),"AJSMain")}function T(){var e=N()+W.getDiv(W.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+W.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return W.getDiv(e,"AJSImagePreview",u)}function N(){return W.getDiv(W.getDiv(null,"AJSActionsOverlay")+W.getDiv((h?W.getSpan(null,"AJSAdd","asicons-plus",{title:D("Add another file")}):"")+(h?W.getSpan(null,"AJSChange","asicons-docs",{title:D("Change file")}):"")+(d?W.getSpan(null,"AJSEdit","asicons-pencil",{title:D("Edit")}):"")+W.getSpan(null,"AJSRemove","asicons-trash",{title:D("Remove file")})+W.getSpan(null,"AJSClose","asicons-checkmark",{title:D("Close window")})),"AJSPreviewActions")}function C(){var e="";e+=W.getDiv(W.getDiv(W.getDiv(W.getHtml("img",null,"AJSResImg")+W.getDiv(W.getDiv(null,"AJSCropT")+W.getDiv(null,"AJSCropR")+W.getDiv(null,"AJSCropB")+W.getDiv(null,"AJSCropL"),"AJSRBG")+W.getDiv(W.getDiv(),"AJSRITrack"),"AJSRInner")+W.getDiv(k()+L(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo");return W.getDiv(e+W.getDiv(W.getSpan(null,"AJSISave","AJSBtnD asicons-checkmark")+W.getSpan(null,"AJSICancel","AJSBtnD asicons-cross"),"AJSIBtns"),"AJSMore",u)}function k(){return""}function L(){return O()}function A(){return W.getDiv(W.getDiv(W.getSpan(D("CANVAS WIDTH"))+W.getInput("AJSCW"),null,"AJSSInfo")+W.getDiv(W.getSpan(D("CANVAS HEIGHT"))+W.getInput("AJSCH"),null,"AJSSInfo"),"AJSRCan","AJSEdivs AJSHidden")}function O(){return W.getDiv(W.getDiv(W.getSpan(D("WIDTH"))+W.getInput("AJSSW"),null,"AJSSInfo")+W.getDiv(W.getSpan(D("HEIGHT"))+W.getInput("AJSSH"),null,"AJSSInfo")+W.getDiv(W.getSpan(D("ASPECT RATIO"))+W.getInput("AJSSAR"),null,"AJSSInfo"),"AJSWHAR","AJSEdivs")}function M(){var e=l?"<strong>"+_()+"</strong>":"",t=c?(e?" "+D("or")+" ":"")+"<strong>"+D("drop")+"</strong>":"",n=W.getSpan(D("Choose file")+(h?"":" "+W.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+W.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross")+(e||t?W.getDiv(D("You can also")+" "+e+t+" "+D("the file"),"AJSUMore"):"");var r=W.getDiv(W.getInput("AJSFile",null,u,"file")+W.getDiv(n,"AJSChooseFile"),"AJSChooseSection");return W.getDiv(r,"AJSUploadSection")+(c?W.getDiv(W.getHtml("a",D("DROP")),"AJSDropZone",u):"")}function _(){var e="(ctrl + v)";if(navigator.platform.match(/Mac/i)){e="(cmd + v)"}return D("paste")+" "+e}function P(e){return e.slice(-1)[0]}function H(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function B(e,t){for(var n=0;n<e.length;n++){if(e[n]===t){return true}}return false}function j(e){return r.getElementById(e)}function F(e){return I("Object",e)}function I(e,t){if(t===undefined){return false}var n=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(t)==="[object "+n+"]"}function q(e){return e.length>0}function R(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function U(e,t){var n;if(!e){return!1}try{n=JSON.parse(e)}catch(r){n=JSON.parse("'"+e+"'")}return n?t?R(n):n:!1}function z(e){var t=e;if(I("Array",t)){t={};for(var n=0,r=e.length;n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function W(){function t(e,t){if(F(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}}var e=this;this.getLink=function(t,n,r,i,s,o){if(!F(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}t(u,o);return u.outerHTML};this.getInput=function(t,n,r,i,s){if(!F(s)){s={}}if(n||n===0){s.value=n}if(t&&!s[a]){s[a]=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var i="prop",s="AJS",o="#AJS",u="AJSHidden",a="name",f=function(){},l="onpaste"in r,c="draggable"in r.createElement("span"),h=!!(t.Blob||t.File||t.FileList||t.FileReader),p=r.createElement("canvas"),d=!!(p.getContext&&p.getContext("2d")),v={accept:[".*"],allowFilters:!0,defaultCropHeightPer:.8,defaultCropWidthPer:.8,maxFileSize:2097152,maxFiles:1,iconPreviewHeight:200,iconPreviewWidth:200,maxHeight:1024,maxWidth:1024,onbeforeopen:f,onclose:f,onfilechanged:f,onfilechanging:f,onfileselected:f,onfilesloaded:f,onfilesloading:f,oninit:f,onlegacyuploadfail:f,onlegacyuploadfinish:f,onlegacyuploadstart:f,onopen:f,onsingleuploadfail:f,onsingleuploadfinish:f,onsingleuploadstart:f,onuploadfail:f,onuploadfinish:f,onuploadprogress:f,onuploadstart:f,pathPrefix:"",quality:1,readonly:!1,scale9Grid:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e.replace(n,arguments[t])}return e},uploadScript:"/upload.php",uploadTo:"uploads"},m={init:function(p){function M(t,n,i,s){var o;if(t[0].tagName==="CANVAS"&&!i){o='<span id="'+n+'"><span></span></span>'}else if(t[0].tagName==="SPAN"&&i){o=r.createElement(s?"canvas":"img");o.id=n}else{return t}t.after(o);t.remove();return e("#"+n)}function _(e,t,n){if(t.base64){n=new Image;n.src=t.base64}var r=n.width,i=n.height,s=y(r,i,m.s.maxWidth,m.s.maxHeight);r=s.width;i=s.height;t.croppedWidth=t.resizedWidth=e.width=r;t.croppedHeight=t.resizedHeight=e.height=i;var o=e.getContext("2d");o.drawImage(n,0,0,r,i);if(t.newupload||m.existingedited){t.base64=e.toDataURL("image/jpeg",m.s.quality)}}function D(e,t){switch(t){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function F(){var t=e(this)[0].id.replace("AJSUploadBtn_","");m.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:m.uploads});m=ZZ.streams[t];var n=e("#AJS");n.show();n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)});m.uploads.length?m.displayUpload():m.resetToUpload();m.event("open",m,{original:m[0],uploads:m.uploads,length:m.uploads.length});X(m.s.readonly)}function R(){var t=e(this)[0].id,n=t.replace(/.*\_(\d+)$/,"$1");t=t.replace(/\_\d+$/,"");var r=t.replace("AJSFP_","");m.event("beforeopen",this,{elemid:r.replace(/^\d+_(.*)$/,"$1"),index:r.replace(/^(\d+)_.*/,"$1"),uploads:m.uploads});m=ZZ.streams[r];m[k]=n;var i=e("#AJS");i.show();i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)});m.displayUpload(m.uploads[n]);e("#AJSMain > div").addClass(u);e("#AJSImagePreview").removeClass(u);m.event("open",m,{original:m[0],uploads:m.uploads,length:m.uploads.length});X(m.s.readonly)}function X(t){var n=t?"addClass":"removeClass";e("#AJSChange,#AJSEdit,#AJSRemove")[n](u)}function V(e){if(m.s.readonly){e=false}if(c){if(e){r.body.ondragover=J;r.body.ondrop=K}else{r.body.ondragover=null;r.body.ondrop=null}}if(l){var t=j("AJS");if(e){t.onpaste=Q}else{t.onpaste=null}}}function J(t){var n=t.dataTransfer;if(!B(n.types,"Files")){return}if(t.target.id==="AJSMainOverlay"){e("#AJSDropZone").addClass(u)}else{t.stopPropagation();t.preventDefault();n.dropEffect="copy";e("#AJSDropZone").removeClass(u)}}function K(t){t.stopPropagation();t.preventDefault();if(e(t.target).closest("#AJS").length){var n=t.dataTransfer,r=n.files;for(var i=0;i<r.length;i++){if(!r[i].type.match(m.s.accept)){r[i]=null}}if(!r.length&&d){var s=m.uploads.length+1;if(s>m.s.maxFiles){streamConfirm(O("Maximum files exceeded"),{Close:f},O("You have selected {0} files but are only permitted to upload {1}",s,m.s.maxFiles),{nocancel:!0});e("#AJSDropZone").addClass(u);return}V();var o=function(){V(!0)},a=n.getData("url");if(!a){a=n.getData("text/plain");if(!a){a=n.getData("text/uri-list");if(!a){return}}}e("#AJSLoading").removeClass(u);m.event("filesloading",null,{original:m[0],toload:m.toload,loaded:m.loaded,uploads:m.uploads,stream:m});e.ajax({url:m.s.uploadScript+"?external=true",type:"post",dataType:"json",data:{filesrc:a,uploaddir:m.s.uploadTo}}).done(function(t){if(t.result==="OK"){o();var n=m.uploads.length;t.data.index=n;m.uploads[n]=t.data;m.currentlength++;e("#AJSFile,#AJSFileLegacy").val(null);e("#AJSUploadSection").addClass(u);e("#AJSImagePreview").removeClass(u);m.toggleLR();m.event("filesloaded",null,{loaded:m.loaded,original:m[0],uploads:m.uploads,stream:m});m.changing=!1;m.toload=m.loaded=0;if(t.data.mimetype.match("image/*")){var r=new Image;r.onload=function(){this.imageloaded=!0;ZZ.images["AJSIMG_"+m.id+n]=r;m.displayUpload(null,!0)};r.onerror=function(){m.uploads.splice(n,1);streamConfirm(O("Error"),{Close:o},O("There was an error processing the external file you dropped"),{nocancel:!0})};r.src=t.data.src+"?cachekill="+(new Date).getTime()}else{m.displayUpload(null,!0)}}else{streamConfirm(O("Error"),{Close:o},O("There was an error processing the external file you dropped"),{nocancel:!0})}e("#AJSLoading").addClass(u)}).fail(function(){e("#AJSLoading").addClass(u);streamConfirm(O("Error"),{Close:o},O("There was an error processing the external file you dropped"),{nocancel:true})});e("#AJSDropZone").addClass(u);return}e("#AJSDropZone").addClass(u);m.addingmore=!1;m.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:r}})}}function Q(e){var t=e.clipboardData.items,n=t.length;for(var r=0;r<t.length;r++){if(!t[r].type.match(m.s.accept)){t[r]=null;n--}}if(!n){return}m.toload=n;m.loaded=0;var i=n+m.uploads.length;if(i>m.s.maxFiles){streamConfirm(O("Maximum files exceeded"),{Close:f},O("You have selected {0} files but are only permitted to upload {1}",i,m.s.maxFiles),{nocancel:!0});n=m.toload=m.s.maxFiles-m.uploads.length}for(var r=0;r<n;r++){var s=t[r];if(!s){continue}var o=s.getAsFile();if(o&&o.size){m.addingmore=!0;m.process(o,r)}else{streamConfirm(O("Error"),{Close:f},O("There was an error processing the file you pasted"),{nocancel:!0})}}}function G(){var t="AJSIMG_"+m.id+m[k],n=e("#"+t);if(n.is(":visible")){n.css({top:(500-n.height())/2})}var r=e("#AJS");r.css({marginLeft:-(r.width()/2),marginTop:-(r.height()/2)})}function Y(){var e="",t=m.uploads,n=parseFloat(m.s.iconPreviewHeight),r=parseFloat(m.s.iconPreviewWidth),i=0;for(var s in t){var o=t[s],u=o.mimetype.replace(/\/.*$/,""),a=u==="image",f;if(a){var l;if(o.croppedWidth<o.croppedHeight){l="height: 100%;width: auto;"}else{var c=o.croppedWidth/o.croppedHeight,p=r/c;l="width: 100%;height: auto;margin-top:"+(n-p)/2+"px;"}f=W.getHtml("img",null,null,null,{src:o.base64,style:l})}else{f=W.getSpan(null,null,D(u,o.mimetype),{style:"line-height:"+n+"px;font-size:"+(r-20)+"px;"})}f+=W.getDiv(o.name,null,"AJSFPName");e+=W.getDiv(f,"AJSFP_"+m.id+"_"+o.index,"AJSFP",{style:"width:"+r+"px;height:"+n+"px;"});i++}if(m.s.maxFiles&&t.length+1<=m.s.maxFiles&&m.uploads.length&&h){e+=W.getSpan(null,"AJSUploadBtn_"+m.id,"asicons-plus AJSBtn AJSFPBtn",{style:"height:"+n+"px;line-height:"+n+"px;","data-ajaxstreamid":m.c})}if(!i){e+=W.getSpan(O("Upload"),"AJSUploadBtn_"+m.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":m.c})}return e}var m=this;if(m.length>1){m.each(function(){e(this).ajaxStream(p)});return m}else if(!m.length){return m}var g=e("body"),T="change",N="attr",k="currentupload",L="changing",A="currentlength";m.c=n;m.currentupload=null;m.currentlength=0;m.changing=!1;m.toload=0;m.loaded=0;m.uploads=[];m.addingmore=!1;m.existingedited=!1;m.s=e.extend(e.extend({},v),p);if(typeof O!==undefined){function O(e){e===e;return m.s.translateFunction.apply(null,arguments)}}m.id=[m.c,"_",m[i]("id")].join("");m.filedata={};m.event=function(e,t){return m.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};m.legacyUpload=function(n){var r=m[L]===!1?m.uploads.length:m[L];m.filedata={base64:null,croppedWidth:null,croppedHeight:null,index:r,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null};t["AJSLegacy"]=ZZ.streams[m.id];e("#AJSLegacy").val(JSON.stringify({maxsize:m.s.maxFileSize,maxheight:m.s.maxHeight,maxwidth:m.s.maxWidth,uploaddir:m.s.uploadTo,islegacy:!0,id:m.id}));var i=e("#AJSFileLegacy"),s=i.clone();s.insertAfter(i);i[0].id=null;e("#AJSLegacyForm").prop({action:m.s.uploadScript+"?newupload=true"}).append(i);s.unbind("change",m.filechanged).change(m.filechanged);m.event("legacyuploadstart",n,{original:m[0],stream:m,uploads:m.uploads});j("AJSLegacyForm").submit();e("#AJSLoading").removeClass(u)};m.afterLegacyUpload=function(n){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove();e("#AJSLoading").addClass(u);if(n.moved){if(n.mimetype.match("image/*")){m.filedata.croppedWidth=m.filedata.resizedWidth=n.width;m.filedata.croppedHeight=m.filedata.resizedHeight=n.height}m.currentlength++;m.filedata.base64=n.location;m.filedata.src=n.location;m.filedata.name=n.name;m.filedata.size=n.size;m.filedata.mimetype=n.mimetype;m.filedata.src=n.location;m.event("legacyuploadfinish",m,{original:m[0],results:n,uploads:m.uploads});m.afterFileRead(m.filedata,m[L]!==!1);t["AJSLegacy"]=null}else{m.event("legacyuploadfail",null,{original:m[0],error:n.error,results:n,uploads:m.uploads,stream:m});streamConfirm(O("Error"),{Close:f},n.error,{nocancel:!0})}};m.filechanged=function(e){var t=e.target.files;if(!t&&e.target.value.match(/^.\:\\/)){m.legacyUpload(this);m.toload=1;return}else if(!t.length){m.changing=!1;return}m.toload=t.length;m.event("fileselected",this,{originalEvent:e.originalEvent,files:t,toload:m.toload,original:m[0],stream:m,jQueryEvent:e,uploads:m.uploads});if(h){for(var n=0;n<r;n++){if(!t[n]){m.toload--}}if(m.toload<=0){streamConfirm(O("Error"),{Close:f},O("There was an error during the upload: the file list is empty",i,m.s.maxFiles),{nocancel:!0})}if(m.changing===!1){var r=m.toload,i=r+m.uploads.length;if(i>m.s.maxFiles){streamConfirm(O("Maximum files exceeded"),{Close:f},O("You have selected {0} files but are only permitted to upload {1}",i,m.s.maxFiles),{nocancel:!0});r=m.toload=m.s.maxFiles-m.uploads.length}for(var n=0;n<r;n++){if(!t[n]){continue}m.process(t[n],n)}}else{m.event("filechanging",this,{originalEvent:e.originalEvent,file:t[0],current:m.uploads[m[L]],original:m[0],jQueryEvent:e,stream:m,uploads:m.uploads});m.process(t[0],m[L],!0,this)}}else{m.legacyUpload(this)}};m.process=function(n,r,i,o){e("#AJSLoading").removeClass(u);if(I("blob",n)||I("file",n)){var l=new FileReader,c=n.type.match("image/*");l.onload=function(e){var u=new Blob([e.target.result],{type:n.type}),f=(t.URL||t.webkitURL).createObjectURL(u),l=i?r:m[A],h={customFields:[],index:l,islegacy:!1,mimetype:n.type,name:n[a],newupload:!0,size:n.size,src:f};if(!i){m[A]++}if(c){var p=new Image;p.onload=function(){var e=this;e.imageloaded=true;h.width=h.resizedWidth=h.croppedWidth=e.width;h.height=h.resizedHeight=h.croppedHeight=e.height;h.base64=null;h.cropdata={};ZZ.images[s+"IMG_"+m.id+l]=e;m.afterFileRead(h,i,o)};p.onerror=function(){h.src=null;m.afterFileRead(h,i,o)};p.src=f}else{h.base64=e.target.result;m.afterFileRead(h,i,o)}};l.onerror=function(t){var n=t.currentTarget.error;e("#AJSLoading").addClass(u);streamConfirm(O("Error"),{Close:f},O("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+n.message,{nocancel:!0});console.error(n.name+": "+n.message)};c?l.readAsArrayBuffer(n):l.readAsDataURL(n)}else{streamConfirm(O("Error"),{Close:f},O("The selection is not a file"),{nocancel:!0})}};m.afterFileRead=function(e,t,n){var r=null;if(t){r=m.uploads[e.index];m.uploads[e.index]=e}else{m.uploads[e.index]?m.uploads[e.index]=e:m.uploads.push(e)}m.attemptProgression(n,e.index,r)};m.attemptProgression=function(t,n,r){m.loaded++;m.event("filesloading",t,{original:m[0],toload:m.toload,loaded:m.loaded,uploads:m.uploads,stream:m});if(m.loaded===m.toload){e("#AJSFile,#AJSFileLegacy").val(null);e("#AJSLoading").addClass(u);e("#AJSUploadSection").addClass(u);e("#AJSImagePreview").removeClass(u);m.toggleLR();var i=m[L]===!1;if(m[L]===!1){m.event("filechanged",t,{original:m[0],newfile:m.uploads[n],oldfile:r,uploads:m.uploads,stream:m})}m.event("filesloaded",t,{loaded:m.loaded,original:m[0],uploads:m.uploads,stream:m});m[L]=!1;m.toload=m.loaded=0;m.displayUpload(null,i)}};m.toggleLR=function(){if(m.uploads.length>1){e("#AJSLRContainer").removeClass(u)}else{e("#AJSLRContainer").addClass(u)}};m.displayUpload=function(t,n){if(m.uploads.length){if(!t){t=m.getCurr(n)}e("#AJSAdd")[m.currentlength+1>m.s.maxFiles?"addClass":"removeClass"](u);var r=t.mimetype.match("image/*")?t.src:null;m.toggleLR();if(r){m.drawImage(t,r);m.currentupload=t.index}else{streamConfirm(O("Corrupt upload"),{ok:m.deleteUpload},O("There is no source for this upload meaning that you cannot continue. Click 'ok' to delete"),{nocancel:true})}}else{m.resetToUpload()}};m.drawImage=function(t,n){var r="AJSIMG_"+m.id+t.index,i=t.mimetype.replace(/\/.*$/,""),s=i==="image",o=h&&d&&s,a=e("#"+r),f=e("#AJSEdit");if(a.length){a=M(a,r,s,o)}else{var l="";if(o){l='<canvas id="'+r+'"></canvas>'}else{if(t.mimetype.match("image/*")){l='<img id="'+r+'"/>'}else{l='<span id="'+r+'"><span></span></span>'}}e("#AJSLRContainer").before(l);a=e("#"+r)}if(o){f.removeClass(u);_(a[0],t,ZZ.images[r])}else{if(i==="image"){f.removeClass(u);a[0].src=n}else{f.addClass(u);a.attr({"class":"AJSMIMEIcons "+D(i,t.mimetype)});a.find("span").html(t.name)}}e('[id^="AJSIMG_"]').addClass(u);var c=a[0].tagName==="CANVAS"?a[0].height:a.height();if(!c){c=t.croppedHeight}a.removeClass(u).css({top:(500-c)/2});G()};m.getCropped64=function(t,n,r,i){if(d){var s=t.getContext("2d"),o=e("#AJSResImg"),a=i.x2-i.x,f=i.y2-i.y,l=n.width,c=n.height;a*=l/o.width();f*=c/o.height();var h=y(a,f,m.s.maxWidth,m.s.maxHeight),p=h.width,v=h.height;var g=p/a,b=v/f;n.croppedWidth=t.width=p;n.croppedHeight=t.height=v;var w=-i.x*(l/o.width())*g,E=-i.y*(c/o.height())*b;if(r.imageloaded){s.drawImage(r,w,E,l*g,c*b);n.base64=t.toDataURL("image/jpeg",m.s.quality)}else{e("#AJSLoading").removeClass(u);r.onload=function(){s.drawImage(r,w,E,l*g,c*b);n.base64=t.toDataURL("image/jpeg",m.s.quality);e("#AJSLoading").addClass(u)}}}};m.resetToUpload=function(){var t=e("#AJSRContainer");e("#AJSUploadSection").removeClass(u);e("#AJSImagePreview").addClass(u);e("#AJSChooseText").removeClass(u);e("#AJSLoading").addClass(u);m.uploads.length?t.removeClass(u):t.addClass(u)};m.getCurr=function(e){if(e){m[k]=m.uploads.length-1;return P(m.uploads)}else{if(m.addingmore){var t=P(m.uploads);m[k]=t.index;return t}else{if(m[k]||m[k]===0){return m.uploads[m[k]]}m[k]=0;return H(m.uploads)}}};m.changePrev=function(e){var t=e?-1:1;var n;if(m[k]+t<0){n=P(m.uploads);m[k]=m.uploads.length-1}else if(m[k]+t>m.uploads.length-1){n=H(m.uploads);m[k]=0}else{n=m.uploads[m[k]+t];m[k]+=t}m.displayUpload(n)};m.iconClick=function(){return};m.resizeIconClick=function(){j("AJSResImg").src=m.uploads[m[k]].src;e("#AJSRITrack,[id^=AJSCrop]").removeClass(u)};m.fillEditValues=function(e,t,n){if(t){var r=t.rect,i=r.width,s=r.height,o=b((t.x2-t.x)*(e.width/i).toFixed(20)),u=b((t.y2-t.y)*(e.height/s).toFixed(20));var a=y(o,u,m.s.maxWidth,m.s.maxHeight);o=a.width;u=a.height;j("AJSSAR").value=S(o/u);j("AJSSW").value=o;j("AJSSH").value=u}};m.showInfo=function(){var n=m.uploads[m[k]],i=n.cropdata,s=j("AJSResImg"),o=e("#AJSRInner"),a=e("#AJSRITrack");e("#AJSMain > div").addClass(u);e("#AJSMore").removeClass(u);s.src=n.src;var f=e(s);f.css({maxWidth:parseFloat(e(t).width())-20});o.css({width:"auto"});var l=s.getBoundingClientRect(),h=l.width,p=l.height,d=m.s.defaultCropWidthPer,v=m.s.defaultCropHeightPer;var g=i.x!==undefined?i.x2-i.x:h*(d>1?1:d),y=i.y!==undefined?i.y2-i.y:p*(v>1?1:v);a.streamBoundaries("updateOpts",{width:h,height:p,thumbWidth:g,thumbHeight:y,onFinish:function(e){e.rect=l;m.fillEditValues(n,e)}});o.width(h);console.log(Number((1-d)/2*100));var b=a.streamBoundaries("reposition",{x:i.x||i.x===0?i.x:Number((1-d)/2*100),y:i.y||i.y===0?i.y:Number((1-v)/2*100)}).positionData;w(b);b.rect=l;m.fillEditValues(n,b,{width:n.width,height:n.height});if(!e(".EIconActive").length){e(".AJSEIcon:first").addClass("EIconActive")}e(".EIconActive").click();var E=e("#AJS"),S=(parseFloat(o.height())-p)/2;e("#AJSRBG").css({top:-p,height:p});E.css({minWidth:h>340?h:340,marginLeft:-(E.width()/2)});f.css({marginTop:S}).attr({"data-top":S,"data-bottom":S+p});a.css({marginTop:S});G();if(c){r.body.ondragover=null;r.body.ondrop=null}V()};m.saveInfo=function(){var t=m.uploads[m[k]],n=e("#AJSRITrack").streamBoundaries("getPositionData"),r="AJSIMG_"+m.id+m[k],i=e("#"+r);if(!ZZ.images[r]){var s=new Image;s.onload=function(){this.imageloaded=true};s.src=t.src+"?cachekill="+(new Date).getTime();ZZ.images[r]=s}m.getCropped64(j(r),t,ZZ.images[r],n);var o={x:n.x,x2:n.x2,y:n.y,y2:n.y2};if(t.cropdata!==o){m.existingedited=!0}t.cropdata=o;e("#AJSMain > div").addClass(u);e("#AJSImagePreview").removeClass(u);e("#AJS").css({minWidth:"initial"});i.css({top:(500-i.height())/2});G();V(true)};m.deleteUpload=function(){var t=[],n=!1,r=!1;for(var i=0,s=m.uploads.length;i<s;i++){if(m.uploads[i]&&i!==m[k]){var o=m.uploads[i];o.index=t.length;t.push(o);if(r!==!1&&n!==!1){r=i}}else{n=i}}e("#AJSIMG_"+m.id+m[k]).remove();m.uploads=t;m.currentlength=m.uploads.length;m.currentupload=r!==false?r:0;e("#AJS_"+m[0].id).val(z(m.uploads));e("#AJSUploadSection").addClass(u);e("#AJSImagePreview").removeClass(u);m.toggleLR();m.displayUpload()};m.initBinding=function(){var n=h?e("#AJSFile"):e("#AJSFileLegacy");n.unbind("click").click(function(){var t=m.s.accept;if(t===".*"||is_array(t)&&B(t,".*")){t="*"}var n={accept:m.s.accept};if(m.s.maxFiles>1){n["multiple"]=!0}e(this)[N](n)});if(h){e("#AJSChooseText").unbind("click").click(function(){m.addingmore=!0;m.changing=!1;n.click()})}V(true);n.unbind(T)[T](m.filechanged);e("#AJS").unbind("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e("#AJSAdd").unbind("click").click(function(){if(m.uploads.length+1>m.s.maxFiles){}else{n.click();m.addingmore=!0}});e("#AJSChange").unbind("click").click(function(){m[L]=m[k];m.addingmore=!1;n.click()});e("#AJSL").unbind("click").click(function(){m.changePrev(!0)});e("#AJSR").unbind("click").click(function(){m.changePrev()});var i=j("AJSICancel"),s=j("AJSISave"),a=j("AJSSW"),f=j("AJSSH"),l=j("AJSSAR"),c=j("AJSEdit");if(c){c.onclick=m.showInfo}if(i){i.onclick=function(){e("#AJSMain > div").addClass(u);e("#AJSImagePreview").removeClass(u);var t=e("#"+"AJSIMG_"+m.id+m[k]);e("#AJS").css({minWidth:"initial"});t.css({top:(500-t.height())/2});G();V()}}if(s){s.onclick=m.saveInfo}e("#AJSRemove").unbind("click").click(function(){streamConfirm(O("Are you sure you want to remove this file?"),m.deleteUpload,O("This simply removes the file from the list of files to be uploaded, and nowhere else"))});e("#AJSClose,#AJSCloseText").unbind("click").click(function(){if(!m.s.readonly){e("#AJS_"+m[0].id).val(z(m.uploads))}e(o).hide();if(m.s.showPreviewOnForm){e("#AJSFormPrev_"+m.id).html(Y());e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R)}m.event("close",m,{original:m[0],uploads:m.uploads,length:m.uploads.length})});e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R);if(l){l.onkeypress=function(){var t,n=this.value,r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=m.uploads[m[k]];if(n&&n.match(/^(:?\s+)?\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var s=n.split(/[\/|\:]/);t=s[0]/s[1]}else if(n&&n.match(/^(:?\s+)?(:?\d+|\d+\.\d+)$/)){t=Number(n)}else{return}var o=j("AJSResImg").getBoundingClientRect(),u=i.width/o.width,a=i.height/o.height,f=r.x2-r.x,l=b(f/t),c=false,h=false;if(l+r.y>o.height){h=o.height-l;if(l>o.height){l=o.height;f=b(l*t);h=0;if(f+r.x>o.width){c=o.width-f}}}var p=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:f,thumbHeight:l,x:c,y:h}).positionData;j("AJSSW").value=b(f*u);j("AJSSH").value=b(l*a);w(p)}}if(a){a.onchange=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=m.uploads[m[k]],s=false;if(t&&t.match(/\%/)){t=n.width*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.width/n.width,u=i.height/n.height,a=t,f=r.y2-r.y,l=y(a,f*u,m.s.maxWidth,m.s.maxHeight);a=l.width/o;f=l.height/u;if(a+r.x>n.width){s=n.width-a}if(a>n.width){a=n.width;s=0;this.value=i.width}var c=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:a,thumbHeight:f,x:s}).positionData;w(c);this.value=b(l.width);j("AJSSH").value=b(l.height);j("AJSSAR").value=S(a/f)}}if(f){f.onchange=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=m.uploads[m[k]],s=false;if(t&&t.match(/\%/)){t=n.height*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.width/n.width,u=i.height/n.height,a=t,f=r.x2-r.x,l=y(f*o,a,m.s.maxWidth,m.s.maxHeight);f=l.width/o;a=l.height/u;if(a+r.y>n.height){a=n.height-a}if(a>n.height){a=n.height;s=0;this.value=i.resizedHeight}var c=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:f,thumbHeight:a,y:s}).positionData;w(c);this.value=b(l.height);j("AJSSW").value=b(l.width);j("AJSSAR").value=S(f/a)}}e(".AJSEIcon").unbind("click",m.iconClick).click(m.iconClick);e(".AJSEIcon[data-for=AJSWHAR]").unbind("click",m.resizeIconClick).click(m.resizeIconClick);e(window).unbind("resize",G).resize(G)};m.redraw=function(){e("#AJSFormPrev_"+m.id).html(Y());e("[id^=AJSUploadBtn_]").unbind("click",F).click(F);e(".AJSFP").unbind("click",R).click(R)};m.draw=function(){m.addClass(u);m.attr({"data-ajaxstreamid":m.c});if(q(e("#AJS_"+m[0].id))){var t=e("#AJS_"+m[0].id).val();m.uploads=t.length?U(t,!0):[];m.currentlength=m.uploads.length;for(var n=0;n<m.currentlength;n++){var r=m.uploads[n];if(!r.cropdata){r.cropdata={}}if(r.mimetype.match("image/*")){var i=new Image;i.onload=function(){this.imageloaded=true};i.src=r.src+"?cachekill="+(new Date).getTime();ZZ.images[s+"IMG_"+m.id+n]=i}}}else{e(W.getInput("AJS_"+m[0].id,null,null,"hidden")).insertAfter(m[0])}if(m.s.showPreviewOnForm){e(W.getDiv(Y(),"AJSFormPrev_"+m.id,"AJSFormPrev",{style:"height:"+m.s.iconPreviewHeight})).insertAfter(m[0])}else{e(W.getSpan(O("Upload"),"AJSUploadBtn_"+m.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":m.c})).insertAfter(m[0])}if(!q(e(o))){g.append(W.getDiv(x(m.s.pathPrefix),s));if(h){e("#AJSImagePreview").after(C())}else{E()}e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,scale9Grid:m.s.scale9Grid,onUpdate:function(e){w(e)}})}m.initBinding();m.event("init",m,{original:m[0],uploads:m.uploads})}();ZZ.streams[m.id]=m;n++;return m},setUploadData:function(e,t){var n=this;if(I("string",e)){e=U(e)}n.uploads=e?e:[];n.currentlength=n.uploads.length;n.toload=n.loaded=n.currentupload=0;if(t){n.redraw()}}};e.fn.ajaxStream=function(t){var n=g(this);if(m[t]){return m[t].apply(n,Array.prototype.slice.call(arguments,1))}else if(Object.prototype.toString.call(t)==="[object Object]"||!t){return m.init.apply(n,arguments)}else{e.error(["The method ",t," does not exist"].join(""))}};if(typeof D!=="function"){function D(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga",images:{},license:"MIT",streams:{},setDefaults:function(t){v=e.extend(v,t)},submit:function(){},version:.02};W=new W})(jQuery,this,0,document)