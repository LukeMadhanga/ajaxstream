!function(e,a,t,i,n){function o(e){var a=e.data("ajaxstreamid");return a?ZZ.streams[a+"_"+e[0].id]:e}function r(e,a,t,i,o){var r=1*e,s=1*a;return o&&(t=t>o.width?o.width:t,i=i>o.height?o.height:i),r>s?r>t&&(s=l(s*=t/r),r=t):s>i&&(r=l(r*=i/s),s=i),{width:n.round(r),height:n.round(s)}}function l(e){return n.round(e)}function s(a){var t=a.x2-a.x;e("#AJSCropT").css({width:t,height:a.y,left:a.x,top:0}),e("#AJSCropR").css({width:a.trackWidth-a.x2,height:a.trackHeight,right:0,top:0}),e("#AJSCropB").css({width:t,height:a.trackHeight-a.y2,left:a.x,bottom:0}),e("#AJSCropL").css({width:a.x,height:a.trackHeight,left:0,top:0})}function d(e,a,t){if(!window.atob||!window.Uint8Array)return null;a=a||"",t=t||512;for(var i=atob(e.replace(/^data:[a-z09\/-]+;base64,/,"")),n=[],o=0;o<i.length;o+=t){for(var r=i.slice(o,o+t),l=new Array(r.length),s=0;s<r.length;s++)l[s]=r.charCodeAt(s);var d=new Uint8Array(l);n[n.length]=d}return new Blob(n,{type:a})}function c(){if(!D(e("#AJSLegacy"))){var a={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(Z.getHtml("form",Z.getInput("AJSLegacy",null,null,"hidden")+Z.getInput(null,"submit",null,"submit"),"AJSLegacyForm",P,a)+Z.getHtml("iframe",null,"AJSIFrame",P,{name:"AJSIFrame"}))}}function u(e){var a,t,i,o,r,l,s,d=1e-15,c=e;for(s=n.floor(c),t=1,r=0,a=s,o=1;c-s>d*o*o;)c=1/(c-s),s=n.floor(c),i=t,t=a,l=r,r=o,a=i+s*t,o=l+s*r;return a+":"+o}function h(e){var a=p()+J();return Z.getDiv(null,"AJSMainOverlay")+Z.getDiv(a+Z.getHtml("img",null,"AJSLoading",P,{src:e+"/files/loader.gif",title:C("Files are loading")}),"AJSMain")}function p(){var e=g()+Z.getDiv(Z.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+Z.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return Z.getDiv(e,"AJSImagePreview",P)}function g(){return Z.getDiv(Z.getDiv(null,"AJSActionsOverlay")+Z.getDiv((B?Z.getSpan(null,"AJSAdd","asicons-plus",{title:C("Add another file")}):"")+(B?Z.getSpan(null,"AJSChange","asicons-docs",{title:C("Change file")}):"")+(U?Z.getSpan(null,"AJSEdit","asicons-pencil",{title:C("Edit")}):"")+Z.getSpan(null,"AJSRemove","asicons-trash",{title:C("Remove file")})+Z.getSpan(null,"AJSClose","asicons-checkmark",{title:C("Close window")})),"AJSPreviewActions")}function m(){var e="";return e+=Z.getDiv(Z.getDiv(Z.getDiv(Z.getHtml("img",null,"AJSResImg")+Z.getDiv(Z.getDiv(null,"AJSCropT")+Z.getDiv(null,"AJSCropR")+Z.getDiv(null,"AJSCropB")+Z.getDiv(null,"AJSCropL"),"AJSRBG")+Z.getDiv(Z.getDiv(),"AJSRITrack"),"AJSRInner")+Z.getDiv(Z.getDiv(Z.getDiv(Z.getHtml("img",null,"AJSRCImg")),"AJSRCVp"),"AJSRC",P)+Z.getDiv(v()+f(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo"),Z.getDiv(e+Z.getDiv(Z.getSpan(null,"AJSISave","asicons-checkmark")+Z.getSpan(null,"AJSICancel","asicons-cross"),"AJSIBtns"),"AJSMore",P)}function v(){return Z.getDiv(Z.getSpan(null,null,"AJSEIcon asicons-transform",{"data-for":"AJSWHAR",title:C("Crop Image")})+Z.getSpan(null,null,"AJSEIcon asicons-flip-to-front",{"data-for":"AJSRCan",title:C("Resize canvas")}),"AJSEditIcons")}function f(){return A()+S()}function S(){return Z.getDiv(Z.getDiv(Z.getSpan(C("CANVAS WIDTH"))+Z.getInput("AJSCW"),null,"AJSSInfo")+Z.getDiv(Z.getSpan(C("CANVAS HEIGHT"))+Z.getInput("AJSCH"),null,"AJSSInfo")+Z.getDiv(Z.getSpan(C("ZOOM"))+Z.getDiv(Z.getDiv(),"AJSCZ"),null,"AJSSInfo"),"AJSRCan","AJSEDivs AJSHidden")}function A(){return Z.getDiv(Z.getDiv(Z.getSpan(C("WIDTH"))+Z.getInput("AJSSW",null,null,"text",{readonly:""}),null,"AJSSInfo")+Z.getDiv(Z.getSpan(C("HEIGHT"))+Z.getInput("AJSSH",null,null,"text",{readonly:""}),null,"AJSSInfo")+Z.getDiv(Z.getSpan(C("ASPECT RATIO"))+Z.getInput("AJSSAR")+Z.getSpan(null,"AJSLockAR","AJSLock asicons-lock-open2"),null,"AJSSInfo"),"AJSWHAR","AJSEDivs")}function J(){var e=E?"<strong>"+w()+"</strong>":"",a=_?(e?" "+C("or")+" ":"")+"<strong>"+C("drop")+"</strong>":"",t=Z.getSpan(C("Choose file")+(B?"":" "+Z.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+Z.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross")+(e||a?Z.getDiv(C("You can also")+" "+e+a+" "+C("the file"),"AJSUMore"):""),i=Z.getDiv(Z.getInput("AJSFile",null,P,"file")+Z.getDiv(t,"AJSChooseFile"),"AJSChooseSection");return Z.getDiv(i,"AJSUploadSection")+(_?Z.getDiv(Z.getHtml("a",C("DROP")),"AJSDropZone",P):"")}function w(){var e="(ctrl + v)";return navigator.platform.match(/Mac/i)&&(e="(cmd + v)"),C("paste")+" "+e}function C(e){return e}function y(e){return e.slice(-1)[0]}function x(e){if(e[0])return e[0];for(var a in e)if(e.hasOwnProperty(a))return e[a]}function I(e,a){for(var t=0;t<e.length;t++)if(e[t]===a)return!0;return!1}function H(e){return i.getElementById(e)}function b(e){return k("Object",e)}function R(e){return k("Array",e)}function k(e,a){if(void 0===a)return!1;var t=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(a)==="[object "+t+"]"}function D(e){return e.length>0}function L(e){var a=[];for(var t in e)e.hasOwnProperty(t)&&a.push(e[t]);return a}function F(e,a){var t;if(!e)return!1;try{t=JSON.parse(e)}catch(i){t=JSON.parse("'"+e+"'")}return t?a?L(t):t:!1}function W(e){var a=e;if(k("Array",a)){a={};for(var t=0,i=e.length;i>t;t++)e[t]&&(a[t]=e[t])}return JSON.stringify(a)}function Z(){function e(e,a){if(b(a))for(var t in a)if(a.hasOwnProperty(t)){var i=a[t];"boolean"==typeof i&&(i=i?1:0),e.setAttribute(t,i)}}var a=this;this.getLink=function(e,t,i,n,o,r){return b(r)||(r={}),o&&(r.rel="nofollow"),r.href=t,a.getHtml("a",e,i,n,r)},this.getHtml=function(a,t,n,o,r){var l=i.createElement(a);return t&&(l.innerHTML=t),n&&(l.id=n),o&&(l.className=o),e(l,r),l.outerHTML},this.getInput=function(e,t,i,n,o){return b(o)||(o={}),(t||0===t)&&(o.value=t),e&&!o.name&&(o.name=e),o.type=n?n:"text",a.getHtml("input",null,e,i,o)},this.getSpan=function(e,t,i,n){return a.getHtml("span",e,t,i,n)},this.getDiv=function(e,t,i,n){return a.getHtml("div",e,t,i,n)}}var P="AJSHidden",T=function(){},E="onpaste"in i,_="draggable"in i.createElement("span"),B=!!(a.Blob||a.File||a.FileList||a.FileReader),M=i.createElement("canvas"),U=!(!M.getContext||!M.getContext("2d")),j={VP_MAX_HEIGHT:420},O={accept:[".*"],allowFilters:!0,maxFileSize:2097152,maxFiles:1,iconPreviewHeight:200,iconPreviewWidth:200,maxHeight:1024,maxWidth:1024,onbeforeopen:T,onclose:T,onfilechanged:T,onfilechanging:T,onfileselected:T,onfilesloaded:T,onfilesloading:T,oninit:T,onlegacyuploadfail:T,onlegacyuploadfinish:T,onlegacyuploadstart:T,onopen:T,onsingleuploadfail:T,onsingleuploadfinish:T,onsingleuploadstart:T,onuploadfail:T,onuploadfinish:T,onuploadprogress:T,onuploadstart:T,pathPrefix:"",quality:1,readonly:!1,scale9Grid:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var a=1;a<arguments.length;a++){var t=new RegExp("\\{"+(a-1)+"\\}","g");e=e.replace(t,arguments[a])}return e},uploadScript:"/upload.php",uploadTo:"uploads"},G={init:function(o){function p(e){return Q.s.translateFunction.apply(null,arguments)}function g(a,t,n,o){var r;if(I(["CANVAS","IMG"],a[0].tagName)&&!n)r='<span id="'+t+'"><span></span></span>';else if("SPAN"===a[0].tagName&&n)r=i.createElement(o?"canvas":"img"),r.id=t;else if("IMG"===a[0].tagName&&o)r=i.createElement("canvas"),r.id=t;else{if("CANVAS"!==a[0].tagName||o)return a;r=i.createElement("img"),r.id=t}return a.after(r),a.remove(),e("#"+t)}function v(e,a,t){a.newsrc&&(t=new Image,t.src=a.newsrc),t.width||t.height?f(e,a,t):t.onload=function(){f(e,a,t),Y()}}function f(e,a,t){var i=r(t.width,t.height,Q.s.maxWidth,Q.s.maxHeight),n=e.getContext("2d");a.croppedWidth=a.resizedWidth=e.width=i.width,a.croppedHeight=a.resizedHeight=e.height=i.height,Q.multipass(e,n,t),(a.newupload||Q.edited)&&(a.newsrc=e.toDataURL(a.mimetype,Q.s.quality))}function S(a,t,n,o,r,l){if(e("#AJSLoading").removeClass(P),l&&o.canvasZoom){var s=o.canvasZoom,d=i.createElement("canvas"),c=d.getContext("2d");d.width=o.croppedWidth,d.height=o.croppedHeight,c.drawImage(n,r.x,r.y,r.outwidth,r.outheight),a.width=o.canvasWidth,a.height=o.canvasHeight,t.drawImage(d,s.x,s.y,s.width,s.height)}else t.drawImage(n,r.x,r.y,r.outwidth,r.outheight);o.newsrc=a.toDataURL(o.mimetype,Q.s.quality),e("#AJSLoading").addClass(P)}function A(e,a){switch(a){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function J(e,a){var t=e.canvasWidth,i=e.canvasHeight,n=i?i:a.height,o=t?t:a.width,r=a.height,l=a.width,s=1;return n>j.VP_MAX_HEIGHT&&(s=n/j.VP_MAX_HEIGHT,n=j.VP_MAX_HEIGHT,o/=s,r/=s,l/=s),{height:n,thumbHeight:r,thumbWidth:l,width:o,scale:s}}function w(){var a=e(this),t=a[0].id.replace("AJSUploadBtn_","");Q.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:Q.uploads}),Q=ZZ.streams[t],ZZ.currentstream=Q;var i=e("#AJS");i.show(),i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)}),Q.uploads.length?Q.displayUpload():Q.resetToUpload(),Q.event("open",Q,{original:Q[0],uploads:Q.uploads,length:Q.uploads.length}),b(Q.s.readonly),a.hasClass("AJSFPBtn")&&e("#AJSFile").click()}function C(){var a=e(this)[0].id,t=a.replace(/.*\_(\d+)$/,"$1");a=a.replace(/\_\d+$/,"");var i=a.replace("AJSFP_","");Q.event("beforeopen",this,{elemid:i.replace(/^\d+_(.*)$/,"$1"),index:i.replace(/^(\d+)_.*/,"$1"),uploads:Q.uploads}),Q=ZZ.streams[i],ZZ.currentstream=Q,Q.currentupload=t;var n=e("#AJS");n.show(),n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)}),Q.displayUpload(Q.uploads[t]),e("#AJSMain > div").addClass(P),e("#AJSImagePreview").removeClass(P),Q.event("open",Q,{original:Q[0],uploads:Q.uploads,length:Q.uploads.length}),b(Q.s.readonly)}function b(a){var t=a?"addClass":"removeClass",i=Q.uploads[Q.currentupload];e("#AJSChange,#AJSRemove,#AJSEdit")[t](P),!a&&i&&(i.mimetype.match("image/*")&&"image/gif"!==i.mimetype&&U?e("#AJSEdit").removeClass(P):e("#AJSEdit").addClass(P))}function L(a){var t=j.VP_MAX_HEIGHT,i=a>t?t:a;e("#AJSRCVp").css({top:(t-i)/2})}function M(a){a.lastMove||e("#AJSCZ").streamBoundaries("reposition");var t=V(),i=Q.uploads[Q.currentupload],n=a.px||0===a.px?1*a.px:1,o=t.minWidth+t.width*n,r=t.minHeight+t.height*n,l=e("#AJSRCVp").streamBoundaries("updateOpts",{thumbHeight:r,thumbWidth:o}).streamBoundaries("reposition").positionData;i.edited=!0,i.canvasZoom={height:r*t.scale,width:o*t.scale,scalePercent:n,x:l.x*t.scale,y:l.y*t.scale}}function G(){var a=e("#AJSRCVp").streamBoundaries("getPositionData"),t=Q.uploads[Q.currentupload],i=V();t.canvasZoom||(t.canvasZoom={width:t.canvasWidth?t.canvasWidth:t.croppedWidth,height:t.canvasHeight?t.canvasHeight:t.croppedHeight,scalePercent:1}),t.canvasZoom.x=a.x*i.scale,t.canvasZoom.y=a.y*i.scale}function V(){var a,t,i=Q.uploads[Q.currentupload],n=i.croppedWidth,o=i.croppedHeight,l=i.canvasWidth?i.canvasWidth:n,s=i.canvasHeight?i.canvasHeight:o,d=n/o,c=1;if(n>o?(t=s,a=s*d,l>a&&(a=l,t=l/d)):(a=l,t=l/d,s>t&&(t=s,a=s*d)),s>j.VP_MAX_HEIGHT){var u=e("#AJSRITrack").streamBoundaries("getPositionData"),h=e("#AJSResImg"),p=h.is(":visible"),g=p?h.width():h.data("width"),m=p?h.height():h.data("height"),v=u.x2-u.x,f=u.y2-u.y,S=i.width,A=i.height;v*=S/g,f*=A/m;var w=r(v,f,Q.s.maxWidth,Q.s.maxHeight),C=J(i,w),y=t/j.VP_MAX_HEIGHT;t=j.VP_MAX_HEIGHT,a/=y,o=C.thumbHeight,n=C.thumbWidth,t>o&&(o=w.height,n=w.width),l>a&&(a=l/y,t=a/d),s>t&&(t=s/y,a=t*d),c=C.scale}return{width:n-a,height:o-t,minWidth:a,minHeight:t,scale:c}}function z(e){if(Q.s.readonly&&(e=!1),_&&(e?(i.body.ondragover=N,i.body.ondrop=$):(i.body.ondragover=null,i.body.ondrop=null)),E){var a=H("AJS");a.onpaste=e?X:null}}function N(a){var t=a.dataTransfer;(I(t.types,"Files")||I(t.types,"text/uri-list"))&&(e(a.target).closest(".AJSBtn,.AJSInlineDrop").parent().length?(e(".AJSInlineDrop").removeClass(P),e(".AJSBtn").addClass(P)):(e(".AJSInlineDrop").addClass(P),e(".AJSBtn").removeClass(P)),"AJSMainOverlay"===a.target.id?e("#AJSDropZone").addClass(P):(a.stopPropagation(),a.preventDefault(),t.dropEffect="copy",e("#AJSDropZone").removeClass(P)))}function $(a){a.stopPropagation(),a.preventDefault(),e(".AJSInlineDrop").css({display:"none"});var t=e(a.target);if(t.closest("#AJS,.AJSInlineDrop").length){if(e("#AJSLoading").removeClass(P),t.closest(".AJSInlineDrop").length){var i=t.parent().find(".AJSBtn");i.click().removeClass(P)}for(var n=a.dataTransfer,o=n.files,r=0;r<o.length;r++)o[r].type.match(Q.s.accept)||(o[r]=null);if(!o.length&&U){var l=Q.uploads.length+1;if(l>Q.s.maxFiles)return streamConfirm(p("Maximum files exceeded"),{Close:T},p("You have selected {0} files but are only permitted to upload {1}",l,Q.s.maxFiles),{nocancel:!0}),e("#AJSDropZone").addClass(P),void e("#AJSLoading").addClass(P);z();var s=function(){z(!0)},d=n.getData("url");return d||(d=n.getData("text/plain"),d||(d=n.getData("text/uri-list")))?(Q.event("filesloading",null,{original:Q[0],toload:Q.toload,loaded:Q.loaded,uploads:Q.uploads,stream:Q}),e.ajax({url:Q.s.uploadScript+"?external=true",type:"post",dataType:"json",data:{filesrc:d,uploaddir:Q.s.uploadTo}}).done(function(a){if("OK"===a.result){s();var t=Q.uploads.length;if(a.data.index=t,Q.uploads[t]=a.data,Q.currentlength++,e("#AJSFile,#AJSFileLegacy").val(null),e("#AJSUploadSection").addClass(P),e("#AJSImagePreview").removeClass(P),Q.toggleLR(),Q.event("filesloaded",null,{loaded:Q.loaded,original:Q[0],uploads:Q.uploads,stream:Q}),Q.changing=!1,Q.toload=Q.loaded=0,a.data.mimetype.match("image/*")){var i=new Image;i.onload=function(){this.imageloaded=!0,ZZ.images["AJSIMG_"+Q.id+t]=i,Q.displayUpload(null,!0)},i.onerror=function(){Q.uploads.splice(t,1),streamConfirm(p("Error"),{Close:s},p("There was an error processing the external file you dropped"),{nocancel:!0})},i.src=a.data.src+"?cachekill="+(new Date).getTime()}else Q.displayUpload(null,!0)}else streamConfirm(p("Error"),{Close:s},p("There was an error processing the external file you dropped"),{nocancel:!0})}).fail(function(){e("#AJSLoading").addClass(P),streamConfirm(p("Error"),{Close:s},p("There was an error processing the external file you dropped"),{nocancel:!0})}),void e("#AJSDropZone").addClass(P)):void e("#AJSLoading").addClass(P)}e("#AJSDropZone").addClass(P),Q.addingmore=!0,Q.filechanged.call(null,{eventType:"drop",originalEvent:a,target:{files:o}})}}function X(e){for(var a=e.clipboardData.items,t=a.length,i=0;i<a.length;i++)a[i].type.match(Q.s.accept)||(a[i]=null,t--);if(t){Q.toload=t,Q.loaded=0;var n=t+Q.uploads.length;n>Q.s.maxFiles&&(streamConfirm(p("Maximum files exceeded"),{Close:T},p("You have selected {0} files but are only permitted to upload {1}",n,Q.s.maxFiles),{nocancel:!0}),t=Q.toload=Q.s.maxFiles-Q.uploads.length);for(var i=0;t>i;i++){var o=a[i];if(o){var r=o.getAsFile();r&&r.size?(Q.addingmore=!0,Q.process(r,i)):streamConfirm(p("Error"),{Close:T},p("There was an error processing the file you pasted"),{nocancel:!0})}}}}function Y(){var a="AJSIMG_"+Q.id+Q.currentupload,t=e("#"+a);t.is(":visible")&&t.css({top:(500-t.height())/2});var i=e("#AJS");i.css({marginLeft:-(i.width()/2),marginTop:-(i.height()/2)})}function q(){var e="",a=Q.uploads,t=parseFloat(Q.s.iconPreviewHeight),i=parseFloat(Q.s.iconPreviewWidth),n=0;for(var o in a){var r,l=a[o],s=l.mimetype.replace(/\/.*$/,""),d="image"===s;if(d){var c,u=l.canvasWidth?l.canvasWidth:l.croppedWidth,h=l.canvasHeight?l.canvasHeight:l.croppedHeight;if(h>u)c="height: 100%;width: auto;";else{var g=u/h,h=i/g;c="width: 100%;height: auto;margin-top:"+(t-h)/2+"px;"}r=Z.getHtml("img",null,null,null,{src:l.newsrc,style:c})}else r=Z.getSpan(null,null,A(s,l.mimetype),{style:"line-height:"+t+"px;font-size:"+(i-20)+"px;"});r+=Z.getDiv(l.name,null,"AJSFPName"),e+=Z.getDiv(r,"AJSFP_"+Q.id+"_"+l.index,"AJSFP",{style:"width:"+i+"px;height:"+t+"px;",tabindex:0}),n++}return Q.s.maxFiles&&a.length+1<=Q.s.maxFiles&&Q.uploads.length&&B&&(e+=Z.getSpan(null,"AJSUploadBtn_"+Q.id,"asicons-plus AJSBtn AJSFPBtn",{"data-ajaxstreamid":Q.c,tabindex:0})),n||(e+=Z.getSpan(p("Upload"),"AJSUploadBtn_"+Q.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":Q.c,tabindex:0})+Z.getSpan(p("Drop"),"AJSDropZone_"+Q.id,"AJSInlineDrop "+P)),e}var Q=this;if(Q.length>1)return Q.each(function(){e(this).ajaxStream(o)}),Q;if(!Q.length||Q.c)return Q;var K=e("body");return Q.c=++t,Q.currentupload=null,Q.currentlength=0,Q.changing=!1,Q.toload=0,Q.loaded=0,Q.uploads=[],Q.addingmore=!1,Q.s=e.extend(e.extend({},O),o),Q.id=[Q.c,"_",Q.prop("id")].join(""),Q.filedata={},Q.event=function(e,a){return Q.s["on"+e].apply(a,Array.prototype.slice.call(arguments,2))},Q.legacyUpload=function(t){var i=Q.changing===!1?Q.uploads.length:Q.changing;Q.filedata={aspectRatioLocked:!1,base64:null,canvasWidth:null,canvasHeight:null,canvasZoom:null,croppedWidth:null,croppedHeight:null,index:i,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null},a.AJSLegacy=ZZ.streams[Q.id],e("#AJSLegacy").val(JSON.stringify({maxsize:Q.s.maxFileSize,maxheight:Q.s.maxHeight,maxwidth:Q.s.maxWidth,uploaddir:Q.s.uploadTo,islegacy:!0,id:Q.id}));var n=e("#AJSFileLegacy"),o=n.clone();o.insertAfter(n),n[0].id=null,e("#AJSLegacyForm").prop({action:Q.s.uploadScript+"?newupload=true"}).append(n),o.unbind("change",Q.filechanged).change(Q.filechanged),Q.event("legacyuploadstart",t,{original:Q[0],stream:Q,uploads:Q.uploads}),H("AJSLegacyForm").submit(),e("#AJSLoading").removeClass(P)},Q.afterLegacyUpload=function(t){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove(),e("#AJSLoading").addClass(P),t.moved?(t.mimetype.match("image/*")&&(Q.filedata.croppedWidth=Q.filedata.resizedWidth=Q.filedata.width=t.width,Q.filedata.croppedHeight=Q.filedata.resizedHeight=Q.filedata.height=t.height),Q.currentlength++,Q.filedata.newsrc=t.location,Q.filedata.src=t.location,Q.filedata.name=t.name,Q.filedata.size=t.size,Q.filedata.mimetype=t.mimetype,Q.filedata.src=t.location,Q.event("legacyuploadfinish",Q,{original:Q[0],results:t,uploads:Q.uploads}),Q.afterFileRead(Q.filedata,Q.changing!==!1),a.AJSLegacy=null):(Q.event("legacyuploadfail",null,{original:Q[0],error:t.error,results:t,uploads:Q.uploads,stream:Q}),streamConfirm(p("Error"),{Close:T},t.error,{nocancel:!0}))},Q.filechanged=function(e){var a=e.target.files;if(!a&&e.target.value.match(/^.\:\\/))return Q.legacyUpload(this),void(Q.toload=1);if(!a.length)return void(Q.changing=!1);var t=Q.toload=a.length;if(Q.event("fileselected",this,{originalEvent:e.originalEvent,files:a,toload:Q.toload,original:Q[0],stream:Q,jQueryEvent:e,uploads:Q.uploads}),B){for(var i=0;t>i;i++)a[i]||Q.toload--;if(Q.toload<=0&&streamConfirm(p("Error"),{Close:T},p("There was an error during the upload: the file list is empty"),{nocancel:!0}),Q.changing===!1){t=Q.toload;var n=t+Q.uploads.length;n>Q.s.maxFiles&&(streamConfirm(p("Maximum files exceeded"),{Close:T},p("You have selected {0} files but are only permitted to upload {1}",n,Q.s.maxFiles),{nocancel:!0}),t=Q.toload=Q.s.maxFiles-Q.uploads.length);for(var i=0;t>i;i++)a[i]&&Q.process(a[i],i)}else Q.event("filechanging",this,{originalEvent:e.originalEvent,file:a[0],current:Q.uploads[Q.changing],original:Q[0],jQueryEvent:e,stream:Q,uploads:Q.uploads}),Q.process(a[0],Q.changing,!0,this)}else Q.legacyUpload(this)},Q.process=function(t,n,o,l){if(e("#AJSLoading").removeClass(P),k("blob",t)||k("file",t)){var s=new FileReader,d=t.type.match("image/*")&&"image/gif"!==t.type;s.onload=function(e){var s=new Blob([e.target.result],{type:t.type}),c=(a.URL||a.webkitURL).createObjectURL(s),u=o?n:null,h={aspectRatioLocked:!1,edited:!1,index:u,islegacy:!1,mimetype:t.type,name:t.name,newupload:!0,size:t.size,src:c};if(o||Q.currentlength++,d){var p=new Image,g=i.createElement("canvas"),m=g.getContext("2d");p.onload=function(){var e=this,a=r(p.width,p.height,Q.s.maxWidth,Q.s.maxHeight);e.imageloaded=!0,g.width=h.width=h.resizedWidth=h.croppedWidth=a.width,g.height=h.height=h.resizedHeight=h.croppedHeight=a.height,h.canvasWidth=h.canvasHeight=h.canvasZoom=null,h.cropdata={},h.image=e,Q.multipass(g,m,p),h.newsrc=g.toDataURL(h.mimetype,1),Q.afterFileRead(h,o,l)},p.onerror=function(){h.src=null,Q.afterFileRead(h,o,l)},p.src=c}else h.newsrc=e.target.result,Q.afterFileRead(h,o,l)},s.onerror=function(a){var t=a.currentTarget.error;e("#AJSLoading").addClass(P),streamConfirm(p("Error"),{Close:T},p("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+t.message,{nocancel:!0}),console.error(t.name+": "+t.message)},d?s.readAsArrayBuffer(t):s.readAsDataURL(t)}else streamConfirm(p("Error"),{Close:T},p("The selection is not a file"),{nocancel:!0})},Q.afterFileRead=function(e,a,t){var i,n=null;a?(i=e.index,n=Q.uploads[i],Q.uploads[i]=e):(i=Q.uploads.length,e.index=i,Q.uploads[i]=e),ZZ.images["AJSIMG_"+Q.id+i]=e.image,delete e.image,Q.attemptProgression(t,e.index,n)},Q.attemptProgression=function(a,t,i){if(Q.loaded++,Q.event("filesloading",a,{original:Q[0],toload:Q.toload,loaded:Q.loaded,uploads:Q.uploads,stream:Q}),Q.loaded===Q.toload){e("#AJSFile,#AJSFileLegacy").val(null),e("#AJSLoading").addClass(P),e("#AJSUploadSection").addClass(P),e("#AJSImagePreview").removeClass(P),Q.toggleLR();var n=Q.changing===!1;Q.changing===!1&&Q.event("filechanged",a,{original:Q[0],newfile:Q.uploads[t],oldfile:i,uploads:Q.uploads,stream:Q}),Q.event("filesloaded",a,{loaded:Q.loaded,original:Q[0],uploads:Q.uploads,stream:Q}),Q.changing=!1,Q.toload=Q.loaded=0,Q.displayUpload(null,n)}},Q.toggleLR=function(){Q.uploads.length>1?e("#AJSLRContainer").removeClass(P):e("#AJSLRContainer").addClass(P)},Q.displayUpload=function(a,t){if(Q.uploads.length){a||(a=Q.getCurr(t)),e("#AJSAdd")[Q.currentlength+1>Q.s.maxFiles?"addClass":"removeClass"](P);var i=a.mimetype.match("image/*"),n=i?"image/gif"===a.mimetype?a.newsrc:a.src:null;Q.toggleLR(),n||!i&&!n?(Q.drawImage(a,n),Q.currentupload=a.index):streamConfirm(p("Corrupt upload"),{ok:Q.deleteUpload},p("There is no source for this upload meaning that you cannot continue. Click 'ok' to delete"),{nocancel:!0})}else Q.resetToUpload()},Q.drawImage=function(a,t){var i="AJSIMG_"+Q.id+a.index,n=a.mimetype.replace(/\/.*$/,""),o="image"===n,r=B&&U&&o&&"image/gif"!==a.mimetype,l=e("#"+i),s=e("#AJSEdit");if(s.addClass(P),l.length)l=g(l,i,o,r);else{var d="";d=r?'<canvas id="'+i+'"></canvas>':a.mimetype.match("image/*")?'<img id="'+i+'"/>':'<span id="'+i+'"><span></span></span>',e("#AJSLRContainer").before(d),l=e("#"+i)}r?(s.removeClass(P),v(l[0],a,ZZ.images[i])):"image"===n?(l[0].src=t,a.width&&a.height||(l[0].onload=function(){a.width=this.width,a.height=this.height,a.canvasWidth=a.canvasHeight=null})):(l.attr({"class":"AJSMIMEIcons "+A(n,a.mimetype)}),l.find("span").html(a.name)),e('[id^="AJSIMG_"]').addClass(P);var c="CANVAS"===l[0].tagName?l[0].height:l.height();c||(c=a.croppedHeight),l.removeClass(P).css({top:c>500?0:(500-c)/2}),e("#AJSLoading").addClass(P),Y()},Q.setCropped64=function(a,t,i,n,o){if(U){var l=a.getContext("2d"),s=e("#AJSResImg"),d=s.is(":visible"),c=d?s.width():s.data("width"),u=d?s.height():s.data("height"),h=n.x2-n.x,p=n.y2-n.y,g=t.width,m=t.height;h*=g/c,p*=m/u;var v=r(h,p,Q.s.maxWidth,Q.s.maxHeight),f=v.width,A=v.height,J=f/h,w=A/p,C=-n.x*(g/c)*J,y=-n.y*(m/u)*w,x=g*J,I=m*w;t.croppedWidth=a.width=f,t.croppedHeight=a.height=A,i.imageloaded?S(a,l,i,t,{x:C,y:y,outwidth:x,outheight:I},o):(e("#AJSLoading").removeClass(P),i.onload=function(){i.imageloaded=!0,S(a,l,i,t,{x:C,y:y,outwidth:x,outheight:I},o),e("#AJSLoading").addClass(P)})}},Q.multipass=function(e,a,t,o,r,l,s){var d=l?l:e.width,c=s?s:e.height,u=void 0===o?0:n.floor(o),h=void 0===r?0:n.floor(r);if(t.width/d>2||t.height/d>2){var p=i.createElement("canvas"),g=p.getContext("2d");p.width=.5*t.width,p.height=.5*t.height,g.drawImage(t,u,h,p.width,p.height),g.drawImage(p,0,0,.5*p.width,.5*p.height),a.drawImage(p,0,0,.5*p.width,.5*p.height,.75*u,.75*h,d,c)}else a.drawImage(t,u,h,d,c)},Q.resetToUpload=function(){var a=e("#AJSRContainer");e("#AJSUploadSection").removeClass(P),e("#AJSImagePreview").addClass(P),e("#AJSChooseText").removeClass(P),e("#AJSLoading").addClass(P),Q.uploads.length?a.removeClass(P):a.addClass(P)},Q.getCurr=function(e){if(e)return Q.currentupload=Q.uploads.length-1,Q.uploads[Q.currentupload];if(Q.addingmore){var a=y(Q.uploads);return Q.currentupload=a.index,a}return Q.currentupload||0===Q.currentupload?Q.uploads[Q.currentupload]:(Q.currentupload=0,x(Q.uploads))},Q.changePrev=function(e){var a,t=e?-1:1;Q.currentupload+t<0?(a=y(Q.uploads),Q.currentupload=Q.uploads.length-1):Q.currentupload+t>Q.uploads.length-1?(a=x(Q.uploads),Q.currentupload=0):(a=Q.uploads[Q.currentupload+t],Q.currentupload+=t),Q.displayUpload(a)},Q.iconClick=function(){Q=ZZ.currentstream;var a=e(this),t=e(".EIconActive");if(t.data("for")===a.data("for"))return!1;e("#AJSLoading").removeClass(P);var n=e("#AJSRInner"),o=e("#AJSRC");switch(e(".AJSEDivs").addClass(P),e("#"+a.data("for")).removeClass(P),a.data("for")){case"AJSRCan":var l=e("#AJSRITrack").streamBoundaries("getPositionData"),s=Q.uploads[Q.currentupload],d=s.canvasZoom,c=d?d.scalePercent:!1,u=s.canvasWidth,h=s.canvasHeight,p=e("#AJSResImg"),g=p.width(),m=p.height(),v=u&&h&&null===d,f=l.x2-l.x,S=l.y2-l.y,A=s.width,w=s.height;f*=A/g,S*=w/m;var C=r(f,S,Q.s.maxWidth,Q.s.maxHeight),y=J(s,C);if(p.attr({"data-width":g,"data-height":m}),Q.setCropped64(i.createElement("canvas"),s,ZZ.images["AJSIMG_"+Q.id+Q.currentupload],l),n.addClass(P),o.removeClass(P),H("AJSRCImg").src=s.newsrc,H("AJSCW").value=u?u:s.croppedWidth,H("AJSCH").value=h?h:s.croppedHeight,e("#AJSRCVp").streamBoundaries("updateOpts",{height:y.height,thumbHeight:y.thumbHeight,thumbWidth:y.thumbWidth,width:y.width}),c||0===c||v){c=v?1:c;var x=e("#AJSCZ").streamBoundaries("reposition",{x:100*c+"%"});M.call(x,x.positionData)}L(h?h:C.height);break;case"AJSWHAR":o.addClass(P),n.removeClass(P)}t.removeClass("EIconActive"),a.addClass("EIconActive"),e("#AJSLoading").addClass(P)},Q.fillEditValues=function(e,a){if(a){var t=Q.getScaledDimensions(a,e);H("AJSSAR").value=u(t.aspectRatio),H("AJSSW").value=t.width,H("AJSSH").value=t.height}},Q.getScaledDimensions=function(e,a){var t=e.rect,i=t.width,n=t.height,o=l((e.x2-e.x)*(a.width/i)),s=l((e.y2-e.y)*(a.height/n)),d=Q.s.maxWidth,c=Q.s.maxHeight,u=r(o,s,d,c);return o=u.width,s=u.height,{width:o,height:s,aspectRatio:o/s}},Q.showInfo=function(){e(".AJSEIcon:first").click(),e("#AJSLoading").removeClass(P);var t=Q.uploads[Q.currentupload],n=t.cropdata,o=e("#AJSResImg"),r=e("#AJSRInner"),l=e("#AJSRITrack"),d=ZZ.images["AJSIMG_"+Q.id+Q.currentupload],c=Z.getHtml("img",null,"AJSResImg",null,{src:d.src,"data-top":o.attr("data-top"),"data-bottom":o.attr("data-bottom"),"data-width":o.attr("data-width"),"data-height":o.attr("data-height"),style:o.attr("style")}),u=e("#AJSLockAR");e("#AJSMain > div").addClass(P),e("#AJSMore").removeClass(P),o.remove(),r.prepend(c),o=e("#AJSResImg"),r.hide(),o[0].onload=function(){e("#AJSLoading").addClass(P),r.show(),o.css({maxWidth:parseFloat(e(a).width())-20}),r.css({width:"auto"});var d=o[0].getBoundingClientRect(),c=d.width,h=d.height,p=void 0!==n.x?n.x2-n.x:c,g=void 0!==n.y?n.y2-n.y:h;l.streamBoundaries("updateOpts",{width:c,height:h,thumbWidth:p,thumbHeight:g,onFinish:function(e){e.rect=d,Q.fillEditValues(t,e),s(e),Q.uploads[Q.currentupload].canvasZoom=null}}),r.width(c);var m=l.streamBoundaries("reposition",{x:n.x||0===n.x?n.x:0,y:n.y||0===n.y?n.y:0}).positionData;s(m),m.rect=d,Q.fillEditValues(t,m),t.aspectRatioLocked?u.removeClass("asicons-lock-open2").addClass("asicons-lock2"):u.removeClass("asicons-lock2").addClass("asicons-lock-open2"),e(".AJSEIcon").removeClass("EIconActive").first().click();var v=e("#AJS"),f=(parseFloat(r.height())-h)/2;e("#AJSRBG").css({top:-h,height:h}),v.css({minWidth:c>340?c:340,marginLeft:-(v.width()/2)}),o.css({marginTop:f}).attr({"data-top":f,"data-bottom":f+h}),l.css({marginTop:f}),Y(),_&&(i.body.ondragover=null,i.body.ondrop=null),z()},o[0].src=d.src},Q.saveInfo=function(){var a=Q.uploads[Q.currentupload],t=e("#AJSRITrack").streamBoundaries("getPositionData"),i="AJSIMG_"+Q.id+Q.currentupload,n=e("#"+i);if(!ZZ.images[i]){var o=new Image;o.onload=function(){this.imageloaded=!0},o.src=a.src+"?cachekill="+(new Date).getTime(),ZZ.images[i]=o}Q.setCropped64(H(i),a,ZZ.images[i],t,!0);var r={x:t.x,x2:t.x2,y:t.y,y2:t.y2};a.cropdata!==r&&(a.edited=!0,Q.edited=!0),a.cropdata=r,e("#AJSMain > div").addClass(P),e("#AJSImagePreview").removeClass(P),e("#AJS").css({minWidth:"initial"}),n.css({top:(500-n.height())/2}),Y(),z(!0),e.streamBoundaries.unsetMouseMove()},Q.deleteUpload=function(){for(var a=[],t=!1,i=!1,n=0,o=Q.uploads.length;o>n;n++)if(Q.uploads[n]&&n!==Q.currentupload){var r=Q.uploads[n];r.index=a.length,a.push(r),i!==!1&&t!==!1&&(i=n)}else t=n;e("#AJSIMG_"+Q.id+Q.currentupload).remove(),Q.uploads=a,Q.currentlength=Q.uploads.length,Q.currentupload=i!==!1?i:0,e("#AJS_"+Q[0].id).val(W(Q.uploads)),e("#AJSUploadSection").addClass(P),e("#AJSImagePreview").removeClass(P),Q.toggleLR(),Q.displayUpload()},Q.initBinding=function(){var t=e(B?"#AJSFile":"#AJSFileLegacy");t.unbind("click").click(function(){var a=Q.s.accept;(".*"===a||R(a)&&I(a,".*"))&&(a="*");var t={accept:a};Q.s.maxFiles>1&&(t.multiple=!0),e(this).attr(t)}),B&&e("#AJSChooseText").unbind("click").click(function(){Q.addingmore=!0,Q.changing=!1,t.click()}),z(!0),t.unbind("change").change(Q.filechanged),e("#AJSImagePreview").unbind("dbclick").dblclick(function(){a.getSelection?a.getSelection().removeAllRanges():i.selection&&i.selection.empty()}),e("#AJSAdd").unbind("click").click(function(){Q.uploads.length+1<=Q.s.maxFiles&&(t.click(),Q.addingmore=!0)}),e("#AJSChange").unbind("click").click(function(){Q.changing=Q.currentupload,Q.addingmore=!1,t.click()}),e("#AJSL").unbind("click").click(function(){Q.changePrev(!0)}),e("#AJSR").unbind("click").click(function(){Q.changePrev()});var n=H("AJSICancel"),o=H("AJSISave"),d=H("AJSCW"),c=H("AJSCH"),u=H("AJSSAR"),h=H("AJSEdit");h&&(h.onclick=Q.showInfo),n&&(n.onclick=function(){e("#AJSMain > div").addClass(P),e("#AJSImagePreview").removeClass(P);var a=e("#AJSIMG_"+Q.id+Q.currentupload);e("#AJS").css({minWidth:"initial"}),a.css({top:(500-a.height())/2}),Y(),z()}),o&&(o.onclick=Q.saveInfo),e("#AJSRemove").unbind("click").click(function(){streamConfirm(p("Are you sure you want to remove this file?"),Q.deleteUpload,p("This removes the file from the list of files to be uploaded, and not from your computer"))}),e("#AJSClose,#AJSCloseText").unbind("click").click(function(){Q.s.readonly||e("#AJS_"+Q[0].id).val(W(Q.uploads)),e("#AJS").hide(),Q.s.showPreviewOnForm&&(e("#AJSFormPrev_"+Q.id).html(q()),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",C).click(C)),Q.event("close",Q,{original:Q[0],uploads:Q.uploads,length:Q.uploads.length})}),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",C).click(C),u&&(u.onchange=function(){e("#AJSLockAR").removeClass("asicons-lock-open2").addClass("asicons-lock2");var a,t=this.value,i=e("#AJSRITrack").streamBoundaries("getPositionData"),n=Q.uploads[Q.currentupload];
if(n.aspectRatioLocked=!0,t&&t.match(/^(:?\s+)?\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var o=t.split(/[\/|\:]/);a=o[0]/o[1]}else{if(!t||!t.match(/^(:?\s+)?(:?\d+|\d+\.\d+)$/))return;a=1*t}var r=H("AJSResImg").getBoundingClientRect(),d=n.width/r.width,c=n.height/r.height,u=i.x2-i.x,h=l(u/a),p=!1,g=!1;h+i.y>r.height&&(g=r.height-h,h>r.height&&(h=r.height,u=l(h*a),g=0,u+i.x>r.width&&(p=r.width-u)));var m=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:u,thumbHeight:h,x:p,y:g}).positionData;H("AJSSW").value=l(u*d),H("AJSSH").value=l(h*c),s(m)}),d&&(d.onchange=function(){var a=1*this.value,t=a>Q.maxWidth?Q.maxWidth:a,i=H("AJSCH"),n=1*i.value,o=Q.uploads[Q.currentupload],l=r(t,n,Q.s.maxWidth,Q.s.maxHeight,o);this.value=o.canvasWidth=l.width,i.value=o.canvasHeight=l.height;var s=J(o,l),d=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:s.height,thumbHeight:s.thumbHeight,thumbWidth:s.thumbWidth,width:s.width}),L(l.height),e("#AJSRCVp").streamBoundaries("reposition"),M.call(d,d.positionData)}),c&&(c.onchange=function(){var a=1*this.value,t=a>Q.s.maxHeight?Q.s.maxHeight:a,i=H("AJSCW"),n=1*i.value,o=Q.uploads[Q.currentupload],l=r(n,t,Q.s.maxWidth,Q.s.maxHeight,o);this.value=o.canvasHeight=l.height,i.value=o.canvasWidth=l.width;var s=J(o,l),d=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:s.height,thumbHeight:s.thumbHeight,thumbWidth:s.thumbWidth,width:s.width}),L(l.height),e("#AJSRCVp").streamBoundaries("reposition"),M.call(d,d.positionData)}),e("#AJSLockAR").click(function(){var a=e(this),t=a.hasClass("asicons-lock-open2");t?a.removeClass("asicons-lock-open2").addClass("asicons-lock2"):a.removeClass("asicons-lock2").addClass("asicons-lock-open2"),Q.uploads[Q.currentupload].aspectRatioLocked=t}),e(".AJSEIcon").unbind("click",Q.iconClick).click(Q.iconClick),e(window).unbind("resize",Y).resize(Y)},Q.redraw=function(){e("#AJSFormPrev_"+Q.id).html(q()),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",C).click(C)},Q.draw=function(){Q.addClass(P),Q.attr({"data-ajaxstreamid":Q.c});var a=!1;if(D(e("#AJS_"+Q[0].id))){var t=e("#AJS_"+Q[0].id).val();Q.uploads=t.length?F(t,!0):[],Q.currentlength=Q.uploads.length;for(var i=0;i<Q.currentlength;i++){var n=Q.uploads[i];if(n.cropdata||(n.cropdata={}),!n.src){var o=d(n.newsrc,n.mimetype);o?n.src=URL.createObjectURL(o):(Q.uploads.splice(i,1),console.warn("Removed file: "+n.name),a||(streamConfirm(p("There are bad files")),a=!0))}if(n.mimetype){if(n.mimetype.match("image/*")){var r=new Image;r.onload=function(){this.imageloaded=!0},r.ajsindex=i,r.ajsname=n.name,r.onerror=function(){Q.uploads=Q.uploads.splice(this.ajsindex,1),console.warn("Removed file: "+this.ajsname),a||(streamConfirm(p("There are bad files")),a=!0),e("#ajaxstream_"+Q[0].id).val(JSON.stringify(Q.uploads)),e("#AJSFP_"+Q.id+"_"+this.ajsindex).remove(),Q.currentlength=Q.uploads.length,delete ZZ.images["AJSIMG_"+Q.id+this.ajsindex]},r.src=n.src.match(/^http(:?s)?\:/)?n.src+"?cachekill="+(new Date).getTime():n.src,ZZ.images["AJSIMG_"+Q.id+i]=r}}else n.mimetype="application/octet-stream"}}else Q.after(Z.getInput("AJS_"+Q[0].id,null,null,"hidden"));Q.after(Q.s.showPreviewOnForm?Z.getDiv(q(),"AJSFormPrev_"+Q.id,"AJSFormPrev",{style:"height:"+Q.s.iconPreviewHeight}):Z.getSpan(p("Upload"),"AJSUploadBtn_"+Q.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":Q.c})),D(e("#AJS"))||(K.append(Z.getDiv(h(Q.s.pathPrefix),"AJS")),B?e("#AJSImagePreview").after(m()):c(),e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,scale9Grid:Q.s.scale9Grid,onBeforeUpdate:function(){Q=ZZ.currentstream,this.s.lockAspectRatio=Q.uploads[Q.currentupload].aspectRatioLocked},onUpdate:function(e){s(e)}}),e("#AJSRCVp").streamBoundaries({crosshair:!1,height:"100%",isViewport:!0,orientation:"2d",onFinish:G,thumbBorder:"none",width:"100%"}),e("#AJSCZ").streamBoundaries({bg:"#999",crosshair:!1,height:8,onFinish:M,onUpdate:M,thumbBg:"#444",thumbBorder:"none",thumbBorderRadius:3,thumbHeight:8,thumbWidth:"15%",trackBorderRadius:3,width:"100%",x:"85%"})),Q.initBinding(),Q.event("init",Q,{original:Q[0],uploads:Q.uploads})}(),ZZ.streams[Q.id]=Q,Q},setUploadData:function(a,t){var i=this,n=!1;k("string",a)&&(a=F(a)),i.uploads=a?L(a):[];for(var o=0;o<i.uploads.length;o++)if(i.uploads[o].mimetype.match("image/*")){var r=new Image,l=i.uploads[o],s=l.src;r.onload=function(){this.imageloaded=!0},r.ajsindex=o,r.ajsname=l.name,r.onerror=function(){i.uploads=i.uploads.splice(this.ajsindex,1),console.warn("Removed file: "+this.ajsname),n||(streamConfirm(C("There are bad files")),n=!0),e("#AJS_"+i[0].id).val(JSON.stringify(i.uploads)),e("#AJSFP_"+i.id+"_"+this.ajsindex).remove(),i.currentlength=i.uploads.length,delete ZZ.images["AJSIMG_"+i.id+this.ajsindex]},r.src=s.match(/^http(:?s)?\:/)?s+"?cachekill="+(new Date).getTime():s,ZZ.images["AJSIMG_"+i.id+o]=r}i.currentlength=i.uploads.length,i.toload=i.loaded=i.currentupload=0,t&&i.redraw()}};e.fn.ajaxStream=function(a){var t=o(this);return G[a]?G[a].apply(t,Array.prototype.slice.call(arguments,1)):"[object Object]"!==Object.prototype.toString.call(a)&&a?void e.error(["The method ",a," does not exist"].join("")):G.init.apply(t,arguments)},window.ZZ=e.ajaxStream={author:"Luke Madhanga",currentstream:null,images:{},license:"MIT",streams:{},setDefaults:function(a){O=e.extend(O,a)},version:"2.0.12"},Z=new Z}(jQuery,this,0,document,Math);