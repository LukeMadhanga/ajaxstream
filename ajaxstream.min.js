(function(e,t,n,r){function g(){if(!A(e(u+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:o+"IFrame"};e("body").append(D[p]("form",D.getInput(o+"Legacy",null,null,"hidden")+D.getInput(o+"FileLegacy",null,null,"file"),o+"LegacyForm",f,t)+D[p]("iframe",null,o+"IFrame",f,{name:o+"IFrame"}))}}function y(){var e=b()+x();return D[c](e,o+"Main")}function b(){var e=w()+D[c](D[h](null,o+"L",o+"LR asicons-arrow-left")+D[h](null,o+"R",o+"LR asicons-arrow-right"),o+"LRContainer");return D[c](e,o+"ImagePreview",f)}function w(){return D[c](D[c](null,o+"ActionsOverlay")+D[c](D[h](null,o+"Add","asicons-plus",{title:T("Add another file")})+D[h](null,o+"Change","asicons-upload",{title:T("Change file")})+D[h](null,o+"Edit","asicons-pencil",{title:T("Edit")})+D[h](null,o+"Remove","asicons-trash",{title:T("Remove file")})+D[h](null,o+"Close","asicons-cross",{title:T("Close window")})),o+"PreviewActions")}function E(){var e="",t={style:"width:100%;"};e+=D[c](D[h]()+D[c](S(),o+"CF"),o+"Info",null,t);return D[c](e+D[h](T("Save"),o+"ISave"),o+"More",f)}function S(){var e="",t=ZZ.customFields,n=ZZ.const;for(var r=0;r<t[i];r++){var s=t[r],u;switch(s.type){case n["CF_TEXT"]:default:u="text"}e+=D[c](D[c](D[h](s[d]),null,o+"CFName")+D[c](D.getInput(null,s.value,null,u,{placeholder:s[d],"data-ajsfor":s[d]}),null,o+"CFField"))}return e}function x(){var e=D[h](T("Choose file"),o+"ChooseText",o+"Btn")+D[p]("img",null,o+"Loading",f,{src:"files/loader.gif",title:T("Files are loading")});var t=D[c](D.getInput(o+"File",null,f,"file")+D[c](e,o+"ChooseFile"),o+"ChooseSection");return D[c](t,o+"UploadSection")+D[c](D[p]("a",T("DROP")),o+"DropZone",f)}function N(e){return e.slice(-1)[0]}function C(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function k(e){return r.getElementById(e)}function L(e){return Object.prototype.toString.call(e)==="[object Object]"}function A(e){return e[i]>0}function O(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function M(e,t){var n=JSON.parse(e);return n?t?O(n):n:!1}function _(e){var t=e;if(Object.prototype.toString.call(t)==="[object Array]"){t={};for(var n=0,r=e[i];n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function D(){function t(e,t){if(L(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!L(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e[p]("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}return t(u,o).outerHTML};this.getInput=function(t,n,r,i,s){if(!L(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s[d]){s[d]=t}s.type=i?i:"text";return e[p]("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e[p]("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e[p]("div",t,n,r,i)}}var i="length",s="prop",o="AJS",u="#AJS",a=".AJS",f="AJSHidden",l="replace",c="getDiv",h="getSpan",p="getHtml",d="name",v=function(){},m={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:v,onfilechanged:v,onfileselected:v,onfilesloaded:v,onfilesloading:v,oninit:v,onlegacyuploadfail:v,onlegacyuploadfinish:v,onlegacyuploadstart:v,onsingleuploadfail:v,onsingleuploadfinish:v,onsingleuploadstart:v,onuploadfail:v,onuploadfinish:v,onuploadprogress:v,onuploadstart:v,quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[i];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e[l](n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,verbose:!1};e.fn.ajaxStream=function(p){function W(e,t,n){var r=n.width,i=n.height;if(r>i){if(r>v.s.maxWidth){i=Math.round(i*=v.s.maxWidth/r);r=v.s.maxWidth}}else{if(i>v.s.maxHeight){r=Math.round(r*=v.s.maxHeight/i);i=v.s.maxHeight}}t.resizedWidth=e.width=r;t.resizedHeight=e.height=i;var s=e.getContext("2d");s.drawImage(n,0,0,r,i);t.base64=e.toDataURL("image/jpeg",v.s.quality)}var v=this;if(v[i]>1){v.each(function(){e(this).ajaxStream(p)});return v}else if(!v[i]){return v}var b=e("body"),w=!!(t.Blob||t.File||t.FileList||t.FileReader),S=r.createElement("canvas"),x=!!(S.getContext&&S.getContext("2d")),T="parent",L="addClass",O="removeClass",P="append",H="click",B="unbind",j="change",F="attr",I="uploads",q="currentupload",R="changing",U="currentlength";v.c=n;v[q]=null;v[U]=0;v[R]=!1;v.toload=0;v.loaded=0;v[I]=[];v.addingmore=!1;v.s=e.extend(e.extend({},m),p);if(typeof z!=="undefined"){function z(e){e===e;return v.s.translateFunction.apply(null,arguments)}}v.id=[v.c,"_",v[s]("id")].join("");v.filedata={};v.event=function(e,t){return v.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};v.legacyUpload=function(n){var r=n.files[0],o=v[R]===!1?v[I][i]:v[R];v.filedata={customFields:[],name:r[d],mimetype:r.type,size:r.size,newupload:!0,index:o,islegacy:!0};t["AJSLegacy"]=ZZ.streams[v.id];e(u+"Legacy").val(JSON.stringify({maxsize:v.s.maxFileSize,maxheight:v.s.maxHeight,maxwidth:v.s.maxWidth,uploaddir:v.s.uploadTo,islegacy:!0,id:v.id}));e(u+"LegacyForm")[s]({action:v.s.uploadScript});v.event("legacyuploadstart",n,{original:v,file:r});e(u+"LegacyForm").submit()};v.afterLegacyUpload=function(e){if(e.moved){v.filedata.src=e.location;v.event("legacyuploadfinish",null,{original:v,results:e});v.afterFileRead(v.filedata,v[R]!==!1);t["AJSLegacy"]=null}else{v.event("legacyuploadfail",null,{original:v,error:e.error,results:e});alert(e.error)}};v.filechanged=function(t){var n=t.target.files;if(!n[i]){v[R]=!1;return}v.toload=n[i];v.event("fileselected",this,{originalEvent:t,files:n,toload:v.toload,original:v});if(w){e(u+"ChooseText")[L](f);e(u+"Loading")[O](f);if(v[R]===!1){var r=n[i];var s=r+v[I][i];if(s>v.s.maxFiles){console.warn(z("You have selected {0} files but are only permitted to upload {1}",s,v.s.maxFiles));r=v.toload=v.s.maxFiles-v[I][i]}for(var o=0;o<r;o++){v.process(n[o],o)}}else{v.event("filechanging",this,{originalEvent:t,file:n[0],current:v[I][v[R]],original:v});v.process(n[0],v[R],!0,this)}}else{v.legacyUpload(this)}};v.process=function(e,n,r,i,s){function a(s,u){var a=u||new Blob([s.target.result],{type:e.type}),f=(t.URL||t.webkitURL).createObjectURL(a),l=r?n:v[U],c={customFields:[],index:l,islegacy:!1,mimetype:e.type,name:e[d],newupload:!0,size:e.size,src:f};if(!r){v[U]++}if(e.type.match("image/*")){var h=new Image;h.onload=function(){var e=this;c.width=c.resizedWidth=e.width;c.height=c.resizedHeight=e.height;c.base64=null;ZZ.images[o+"IMG_"+v.id+l]=this;v.afterFileRead(c,r,i)};h.src=f}else{v.afterFileRead(c,r,i)}}if(s){a(null,s)}else{var u=new FileReader;u.onload=a;u.readAsArrayBuffer(e)}};v.afterFileRead=function(e,t,n){var r=null;if(t){r=v[I][e.index];v[I][e.index]=e}else{v[I][e.index]?v[I][e.index]=e:v[I].push(e)}v.attemptProgression(n,e.index,r)};v.attemptProgression=function(t,n,r){v.loaded++;v.event("filesloading",t,{original:v,toload:v.toload,loaded:v.loaded});if(v.loaded===v.toload){e(u+"UploadSection")[L](f);e(u+"ImagePreview")[O](f);v.toggleLR();var i=v[R]===!1;if(v[R]===!1){v.event("filechanged",t,{original:v,"new":v[I][n],old:r})}v.event("filesloaded",t,{loaded:v.loaded,original:v,uploads:v[I]});v[R]=!1;v.toload=v.loaded=0;v.displayUpload(null,i)}};v.toggleLR=function(){if(v[I][i]>1){e(u+"LRContainer")[O](f)}else{e(u+"LRContainer")[L](f)}};v.displayUpload=function(t,n){if(v[I][i]){if(!t){t=v.getCurr(n)}e(u+"Add")[v[U]+1>v.s.maxFiles?L:O](o+"Disabled");var r=t.mimetype.match("image/*")?t.src:v.getIconPath(t.mimetype);v.toggleLR();v.drawImage(t,r)}else{v.resetToUpload()}};v.drawImage=function(t,n){var r=o+"IMG_"+v.id+t.index,s=w&&x&&t.mimetype.match("image/*"),a=e("#"+r);if(!a[i]){e(u+"LRContainer").before((s?'<canvas id="?"></canvas>':'<img id="?" />')[l](/\?/,r));a=e("#"+r)}if(s){W(a[0],t,ZZ.images[r])}else{a[F]({src:n})}e((s?"canvas":"img")+'[id^="AJSIMG_"]')[L](f);a[O](f)};v.getIconPath=function(e){switch(e){default:return""}};v.resetToUpload=function(){var t=e(u+"RContainer");e(u+"UploadSection")[O](f);e(u+"ImagePreview")[L](f);e(u+"ChooseText")[O](f);e(u+"Loading")[L](f);v[I][i]?t[O](f):t[L](f)};v.getCurr=function(e){if(e){v[q]=v[I][i]-1;return N(v[I])}else{if(v.addingmore){var t=N(v[I]);v[q]=t.index;return t}else{if(v[q]||v[q]===0){return v[I][v[q]]}v[q]=0;return C(v[I])}}};v.changePrev=function(e){var t=e?-1:1;var n;if(v[q]+t<0){n=N(v.uploads);v[q]=v[I][i]-1}else if(v[q]+t>v[I][i]-1){n=C(v[I]);v[q]=0}else{n=v[I][v[q]+t];v[q]+=t}v.displayUpload(n)};v.showInfo=function(){var t=v[I][v[q]],n=t.customFields;e(u+"Main > div")[L](f);e(u+"More")[O](f);e(u+"Info > span").html(t[d][l](/([\_|\.])/g,"&shy;$1&shy;"));if(n[i]){for(var r=0;r<n[i];r++){var s=n[r];e('[data-ajsfor="'+s.field+'"]').val(s.value)}}e(a+"CFField:first > input").focus()};v.saveInfo=function(){var t=v[I][v[q]],n=ZZ.customFields,r=[];if(n[i]){for(var s=0;s<n[i];s++){var o=n[s];r.push({field:o[d],value:e('[data-ajsfor="'+o[d]+'"]').val()});e('[data-ajsfor="'+o[d]+'"]').val("")}t.customFields=r}e(u+"Main > div")[L](f);e(u+"ImagePreview")[O](f)};v.initBinding=function(){var n=w?e(u+"File"):e(u+"FileLegacy");var a=k(o);n[B](H)[H](function(){var t={accept:v.s.accept};if(v.s.maxFiles>1){t["multiple"]=!0}e(this)[F](t)});e(u+"ChooseText")[B](H)[H](function(){v.addingmore=!0;v[R]=!1;n[H]()});if("onpaste"in a){a.onpaste=function(e){var t=(e.clipboardData||e.originalEvent.clipboardData).items,n=t[0].getAsFile(),r=p.accept?".*":p.accept;if(n&&n.type.match(r)&&v[U]<v.s.maxFiles){v.toload=1;v.loaded=0;var i=(new Date).toString()[l](/\ /g,"_")[l](/(\+|\:|\(|\))/g,"");v.process({name:"AjaxStream-Paste-At-"+i+"."+n.type[l](/.+\/(.*)/,"$1"),type:n.type,size:n.size},v[q]+1,false,null,t[0].getAsFile())}}}if("draggable"in r.createElement("span")){r.body.ondragover=function(t){if(e(t.target).closest("#AJS")[i]){t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy";e(u+"DropZone")[O](f)}else{e(u+"DropZone")[L](f)}};r.body.ondrop=function(t){t.stopPropagation();t.preventDefault();if(e(t.target).closest("#AJS")[i]){e(u+"DropZone")[L](f);v.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:t.dataTransfer.files}})}}}n[B](j)[j](v.filechanged);e(u+"")[B]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e(u+"Add")[B](H)[H](function(){if(v[I][i]+1>v.s.maxFiles){}else{n[H]();v.addingmore=!0}});e(u+"Change")[B](H)[H](function(){v[R]=v[q];v.addingmore=!1;n[H]()});e(u+"L")[B](H)[H](function(){v.changePrev(!0)});e(u+"R")[B](H)[H](function(){v.changePrev()});e(u+"Edit")[B](H)[H](v.showInfo);e(u+"ISave")[B](H)[H](v.saveInfo);e(u+"Remove")[B](H)[H](function(){if(confirm(z("Are you sure you want to delete this file?"))){var t=[];for(var n=0,r=v[I][i];n<r;n++){if(v[I][n]&&n!==v[q]){t.push(v[I][n])}}e("#AJSIMG_"+v.id+v[q]).remove();v[I]=t;v[U]=v[I][i];e(u+"_"+v.id).val(_(v[I]));e(u+"UploadSection")[L](f);e(u+"ImagePreview")[O](f);v.toggleLR();v.displayUpload()}});e(u+"Close")[B](H)[H](function(){e(u+"_"+v.id).val(_(v[I]));e(u).hide()});e("[id^=AJSUploadBtn_]")[B](H)[H](function(){var t=e(this)[s]("id")[l](o+"UploadBtn_","");v=ZZ.streams[t];v[I][i]?v.displayUpload():v.resetToUpload();e(u+"").show();if(!v[I][i]){n[H]();v.addingmore=!0}})};v.draw=function(){var t=v[T]();v[L](f);if(A(e(u+"_"+v.id))){var n=e(u+"_"+v.id).val();v[I]=n[i]?M(n,!0):[]}else{t[P](D.getInput(o+"_"+v.id,null,null,"hidden"))}if(v.s.showPreviewOnForm){}else{t[P](D[h](z("Upload"),o+"UploadBtn_"+v.id,o+"Btn",{"data-mandatory":!0}))}if(!A(e(u+""))){b[P](D[c](y(v.s),o));if(!w){g()}e(u+"ImagePreview").after(E())}v.initBinding();v.event("init",v,{original:v[0]})}();ZZ.streams[v.id]=v;n++;return v};if(typeof T!=="function"){function T(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga","const":{CF_TEXT:1},customFields:[],images:{},license:"MIT",streams:{},setDefaults:function(t){m=e.extend(m,t)},submit:function(){},version:.02};D=new D})(jQuery,this,0,document)