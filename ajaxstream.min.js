(function(e,t,n,r){function b(e){var t=e.data("ajaxstreamid");return t||t===0?ZZ.streams[t+"_"+e[0].id]:e}function w(e,t,n,r){if(e>t){if(e>n){t=Math.round(t*=n/e);e=n}}else{if(t>r){e=Math.round(e*=r/t);t=r}}return{width:e,height:t}}function E(t){var n=t.x2-t.x;e("#AJSCropT").css({width:n,height:t.y,left:t.x,top:0});e("#AJSCropR").css({width:t.trackWidth-t.x2,height:t.trackHeight,right:0,top:0});e("#AJSCropB").css({width:n,height:t.trackHeight-t.y2,left:t.x,bottom:0});e("#AJSCropL").css({width:t.x,height:t.trackHeight,left:0,top:0})}function S(){if(!q(e("#AJSLegacy"))){var t={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(W.getHtml("form",W.getInput("AJSLegacy",null,null,"hidden")+W.getInput(null,"submit",null,"submit"),"AJSLegacyForm",a,t)+W.getHtml("iframe",null,"AJSIFrame",a,{name:"AJSIFrame"}))}}function x(e){var t=1e-15,n,r,i,s,o,u,a,f=e;a=Math.floor(f);r=1;o=0;n=a;s=1;while(f-a>t*s*s){f=1/(f-a);a=Math.floor(f);i=r;r=n;u=o;o=s;n=i+a*r;s=u+a*o}return(n>21?(n/Math.pow(10,(""+n+"").length-1)).toPrecision(2):n)+":"+(s>21?(s/Math.pow(10,(""+s+"").length-1)).toPrecision(2):s)}function T(e){var t=N()+_();return W.getDiv(null,"AJSMainOverlay")+W.getDiv(t+W.getHtml("img",null,"AJSLoading",a,{src:e+"/files/loader.gif",title:P("Files are loading")}),"AJSMain")}function N(){var e=C()+W.getDiv(W.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+W.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return W.getDiv(e,"AJSImagePreview",a)}function C(){return W.getDiv(W.getDiv(null,"AJSActionsOverlay")+W.getDiv((d?W.getSpan(null,"AJSAdd","asicons-plus",{title:P("Add another file")}):"")+(d?W.getSpan(null,"AJSChange","asicons-docs",{title:P("Change file")}):"")+(m?W.getSpan(null,"AJSEdit","asicons-pencil",{title:P("Edit")}):"")+W.getSpan(null,"AJSRemove","asicons-trash",{title:P("Remove file")})+W.getSpan(null,"AJSClose","asicons-checkmark",{title:P("Close window")})),"AJSPreviewActions")}function k(){var e="";e+=W.getDiv(W.getDiv(W.getDiv(W.getHtml("img",null,"AJSResImg")+W.getDiv(W.getDiv(null,"AJSCropT")+W.getDiv(null,"AJSCropR")+W.getDiv(null,"AJSCropB")+W.getDiv(null,"AJSCropL"),"AJSRBG")+W.getDiv(W.getDiv(),"AJSRITrack"),"AJSRInner")+W.getDiv(L()+A(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo");return W.getDiv(e+W.getDiv(W.getSpan(null,"AJSISave","AJSBtnD asicons-checkmark")+W.getSpan(null,"AJSICancel","AJSBtnD asicons-cross"),"AJSIBtns"),"AJSMore",a)}function L(){return""}function A(){return M()}function O(){return W.getDiv(W.getDiv(W.getSpan(P("CANVAS WIDTH"))+W.getInput("AJSCW"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("CANVAS HEIGHT"))+W.getInput("AJSCH"),null,"AJSSInfo"),"AJSRCan","AJSEdivs AJSHidden")}function M(){return W.getDiv(W.getDiv(W.getSpan(P("WIDTH"))+W.getInput("AJSSW"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("HEIGHT"))+W.getInput("AJSSH"),null,"AJSSInfo")+W.getDiv(W.getSpan(P("ASPECT RATIO"))+W.getInput("AJSSAR"),null,"AJSSInfo"),"AJSWHAR","AJSEdivs")}function _(){var e=h?"<strong>"+D()+"</strong>":"",t=p?(e?" "+P("or")+" ":"")+"<strong>"+P("drop")+"</strong>":"",n=W.getSpan(P("Choose file")+(d?"":" "+W.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+W.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross")+(e||t?W.getDiv(P("You can also")+" "+e+t+" "+P("the file"),"AJSUMore"):"");var r=W.getDiv(W.getInput("AJSFile",null,a,"file")+W.getDiv(n,"AJSChooseFile"),"AJSChooseSection");return W.getDiv(r,"AJSUploadSection")+(p?W.getDiv(W.getHtml("a",P("DROP")),"AJSDropZone",a):"")}function D(){var e="(ctrl + v)";if(navigator.platform.match(/Mac/i)){e="(cmd + v)"}return P("paste")+" "+e}function H(e){return e.slice(-1)[0]}function B(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function j(e){return r.getElementById(e)}function F(e){return I("Object",e)}function I(e,t){if(t===undefined){return false}var n=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(t)==="[object "+n+"]"}function q(e){return e.length>0}function R(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function U(e,t){var n;if(!e){return!1}try{n=JSON.parse(e)}catch(r){n=JSON.parse("'"+e+"'")}return n?t?R(n):n:!1}function z(e){var t=e;if(I("Array",t)){t={};for(var n=0,r=e.length;n<r;n++){if(e[n]){t[n]=e[n]}}}return JSON.stringify(t)}function W(){function t(e,t){if(F(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(typeof r==="boolean"){r=r?1:0}e.setAttribute(n,r)}}}}var e=this;this.getLink=function(t,n,r,i,s,o){if(!F(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,i,s,o){var u=r.createElement(e);if(n){u.innerHTML=n}if(i){u.id=i}if(s){u.className=s}t(u,o);return u.outerHTML};this.getInput=function(t,n,r,i,s){if(!F(s)){s={}}if(n||n===0){s.value=n}if(t&&!s[l]){s[l]=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var i="length",s="prop",o="AJS",u="#AJS",a="AJSHidden",f="replace",l="name",c=function(){},h="onpaste"in r,p="draggable"in r.createElement("span"),d=!!(t.Blob||t.File||t.FileList||t.FileReader),v=r.createElement("canvas"),m=!!(v.getContext&&v.getContext("2d")),g={accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onbeforeopen:c,onclose:c,onfilechanging:c,onfilechanged:c,onfileselected:c,onfilesloaded:c,onfilesloading:c,oninit:c,onlegacyuploadfail:c,onlegacyuploadfinish:c,onlegacyuploadstart:c,onopen:c,onsingleuploadfail:c,onsingleuploadfinish:c,onsingleuploadstart:c,onuploadfail:c,onuploadfinish:c,onuploadprogress:c,onuploadstart:c,pathPrefix:"",quality:1,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments.length;t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e.replace(n,arguments[t])}return e},uploadScript:"/upload.php?newupload=true",uploadTo:"uploads",uploadWithForm:!1,verbose:!1},y={init:function(i){function M(t,n,i,s){var o;if(t[0].tagName==="CANVAS"&&!i){o='<span id="'+n+'"><span></span></span>'}else if(t[0].tagName==="SPAN"&&i){o=r.createElement(s?"canvas":"img");o.id=n}else{return t}t.after(o);t.remove();return e("#"+n)}function _(e,t,n){if(t.base64){n=new Image;n.src=t.base64}var r=n.width,i=n.height,s=w(r,i,f.s.maxWidth,f.s.maxHeight);r=s.width;i=s.height;t.croppedWidth=t.resizedWidth=e.width=r;t.croppedHeight=t.resizedHeight=e.height=i;var o=e.getContext("2d");o.drawImage(n,0,0,r,i);if(t.newupload||f.existingedited){t.base64=e.toDataURL("image/jpeg",f.s.quality)}}function D(e,t){switch(t){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function P(){var t=e(this)[0].id.replace("AJSUploadBtn_","");f.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:f.uploads});f=ZZ.streams[t];var n=e("#AJS");n.show();n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)});f.uploads.length?f.displayUpload():f.resetToUpload();f.event("open",f,{original:f[0],uploads:f.uploads,length:f.uploads.length})}function F(){var t=e(this)[0].id,n=t.replace(/.*\_(\d+)$/,"$1");t=t.replace(/\_\d+$/,"");var r=t.replace("AJSFP_","");f.event("beforeopen",this,{elemid:r.replace(/^\d+_(.*)$/,"$1"),index:r.replace(/^(\d+)_.*/,"$1"),uploads:f.uploads});f=ZZ.streams[r];f[C]=n;var i=e("#AJS");i.show();i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)});f.displayUpload(f.uploads[n]);e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a)}function R(e){if(p){if(e){r.body.ondragover=X;r.body.ondrop=V}else{r.body.ondragover=null;r.body.ondrop=null}}if(h){var t=j("AJS");if(e){t.onpaste=J}else{t.onpaste=null}}}function X(t){var n=t.dataTransfer;if(n.items&&n.items[0].kind!=="file"||n.types[3]!=="Files"){return}if(t.target.id==="AJSMainOverlay"){e("#AJSDropZone").addClass(a)}else{t.stopPropagation();t.preventDefault();n.dropEffect="copy";e("#AJSDropZone").removeClass(a)}}function V(t){t.stopPropagation();t.preventDefault();if(e(t.target).closest("#AJS").length){var n=t.dataTransfer.files;for(var r=0;r<n.length;r++){if(!n[r].type.match(f.s.accept)){n[r]=null}}e("#AJSDropZone").addClass(a);f.addingmore=!0;f.filechanged.call(null,{eventType:"drop",originalEvent:t,target:{files:n}})}}function J(e){var t=e.clipboardData.items,n=t.length;for(var r=0;r<t.length;r++){if(!t[r].type.match(f.s.accept)){t[r]=null;n--}}if(!n){return}f.toload=n;f.loaded=0;var i=n+f.uploads.length;if(i>f.s.maxFiles){streamConfirm(O("Maximum files exceeded"),{Close:c},O("You have selected {0} files but are only permitted to upload {1}",i,f.s.maxFiles),{nocancel:!0});n=f.toload=f.s.maxFiles-f.uploads.length}for(var r=0;r<n;r++){var s=t[r];if(!s){continue}var o=s.getAsFile();if(o&&o.size){f.addingmore=!0;f.process(o,r)}else{streamConfirm(O("Error"),{Close:c},O("There was an error processing the file you pasted"),{nocancel:!0})}}}function K(){var t="AJSIMG_"+f.id+f[C],n=e("#"+t);if(n.is(":visible")){n.css({top:(500-n.height())/2})}var r=e("#AJS");r.css({marginLeft:-(r.width()/2),marginTop:-(r.height()/2)})}function Q(){var e="",t=f.uploads,n=parseFloat(f.s.iconPreviewHeight),r=parseFloat(f.s.iconPreviewWidth),i=0;for(var s in t){var o=t[s],u=o.mimetype.replace(/\/.*$/,""),a=u==="image",l;if(a){var c;if(o.croppedWidth<o.croppedHeight){c="height: 100%;width: auto;"}else{var h=o.croppedWidth/o.croppedHeight,p=r/h;c="width: 100%;height: auto;margin-top:"+(n-p)/2+"px;"}l=W.getHtml("img",null,null,null,{src:o.base64,style:c})}else{l=W.getSpan(null,null,D(u,o.mimetype),{style:"line-height:"+n+"px;font-size:"+(r-20)+"px;"})}l+=W.getDiv(o.name,null,"AJSFPName");e+=W.getDiv(l,"AJSFP_"+f.id+"_"+o.index,"AJSFP",{style:"width:"+r+"px;height:"+n+"px;"});i++}if(f.s.maxFiles&&t.length+1<=f.s.maxFiles&&f.uploads.length&&d){e+=W.getSpan(null,"AJSUploadBtn_"+f.id,"asicons-plus AJSBtn AJSFPBtn",{style:"height:"+n+"px;line-height:"+n+"px;","data-ajaxstreamid":f.c})}if(!i){e+=W.getSpan(O("Upload"),"AJSUploadBtn_"+f.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":f.c})}return e}var f=this;if(f.length>1){f.each(function(){e(this).ajaxStream(i)});return f}else if(!f.length){return f}var v=e("body"),y="change",b="attr",N="uploads",C="currentupload",L="changing",A="currentlength";f.c=n;f.currentupload=null;f.currentlength=0;f.changing=!1;f.toload=0;f.loaded=0;f.uploads=[];f.addingmore=!1;f.existingedited=!1;f.s=e.extend(e.extend({},g),i);if(typeof O!==undefined){function O(e){e===e;return f.s.translateFunction.apply(null,arguments)}}f.id=[f.c,"_",f[s]("id")].join("");f.filedata={};f.event=function(e,t){return f.s["on"+e].apply(t,Array.prototype.slice.call(arguments,2))};f.legacyUpload=function(n){var r=f[L]===!1?f.uploads.length:f[L];f.filedata={base64:null,croppedWidth:null,croppedHeight:null,index:r,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null};t["AJSLegacy"]=ZZ.streams[f.id];e("#AJSLegacy").val(JSON.stringify({maxsize:f.s.maxFileSize,maxheight:f.s.maxHeight,maxwidth:f.s.maxWidth,uploaddir:f.s.uploadTo,islegacy:!0,id:f.id}));var i=e("#AJSFileLegacy"),s=i.clone();s.insertAfter(i);i[0].id=null;e("#AJSLegacyForm").prop({action:f.s.uploadScript}).append(i);s.unbind("change",f.filechanged).change(f.filechanged);f.event("legacyuploadstart",n,{original:f[0]});j("AJSLegacyForm").submit();e("#AJSLoading").removeClass(a)};f.afterLegacyUpload=function(n){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove();e("#AJSLoading").addClass(a);if(n.moved){if(n.mimetype.match("image/*")){f.filedata.croppedWidth=f.filedata.resizedWidth=n.width;f.filedata.croppedHeight=f.filedata.resizedHeight=n.height}f.currentlength++;f.filedata.base64=n.location;f.filedata.src=n.location;f.filedata.name=n.name;f.filedata.size=n.size;f.filedata.mimetype=n.mimetype;f.filedata.src=n.location;f.event("legacyuploadfinish",f,{original:f[0],results:n,uploads:f.uploads});f.afterFileRead(f.filedata,f[L]!==!1);t["AJSLegacy"]=null}else{f.event("legacyuploadfail",null,{original:f,error:n.error,results:n,uploads:f.uploads});streamConfirm(O("Error"),{Close:c},n.error,{nocancel:!0})}};f.filechanged=function(e){var t=e.target.files;if(!t&&e.target.value.match(/^.\:\\/)){f.legacyUpload(this);f.toload=1;return}else if(!t.length){f.changing=!1;return}f.toload=t.length;f.event("fileselected",this,{originalEvent:e,files:t,toload:f.toload,original:f,uploads:f.uploads});if(d){for(var n=0;n<r;n++){if(!t[n]){f.toload--}}if(f.toload<=0){streamConfirm(O("Error"),{Close:c},O("There was an error during the upload: the file list is empty",i,f.s.maxFiles),{nocancel:!0})}if(f.changing===!1){var r=f.toload,i=r+f.uploads.length;if(i>f.s.maxFiles){streamConfirm(O("Maximum files exceeded"),{Close:c},O("You have selected {0} files but are only permitted to upload {1}",i,f.s.maxFiles),{nocancel:!0});r=f.toload=f.s.maxFiles-f.uploads.length}for(var n=0;n<r;n++){if(!t[n]){continue}f.process(t[n],n)}}else{f.event("filechanging",this,{originalEvent:e,file:t[0],current:f.uploads[f[L]],original:f,uploads:f.uploads});f.process(t[0],f[L],!0,this)}}else{f.legacyUpload(this)}};f.process=function(n,r,i,s){e("#AJSLoading").removeClass(a);if(I("blob",n)||I("file",n)){var u=new FileReader,h=n.type.match("image/*");u.onload=function(e){var u=new Blob([e.target.result],{type:n.type}),a=(t.URL||t.webkitURL).createObjectURL(u),c=i?r:f[A],p={customFields:[],index:c,islegacy:!1,mimetype:n.type,name:n[l],newupload:!0,size:n.size,src:a};if(!i){f[A]++}if(h){var d=new Image;d.onload=function(){var e=this;p.width=p.resizedWidth=p.croppedWidth=e.width;p.height=p.resizedHeight=p.croppedHeight=e.height;p.base64=null;p.cropdata={};ZZ.images[o+"IMG_"+f.id+c]=this;f.afterFileRead(p,i,s)};d.src=a}else{p.base64=e.target.result;f.afterFileRead(p,i,s)}};u.onerror=function(t){var n=t.currentTarget.error;e("#AJSLoading").addClass(a);streamConfirm(O("Error"),{Close:c},O("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+n.message,{nocancel:!0});console.error(n.name+": "+n.message)};h?u.readAsArrayBuffer(n):u.readAsDataURL(n)}else{streamConfirm(O("Error"),{Close:c},O("The selection is not a file"),{nocancel:!0})}};f.afterFileRead=function(e,t,n){var r=null;if(t){r=f.uploads[e.index];f.uploads[e.index]=e}else{f.uploads[e.index]?f.uploads[e.index]=e:f.uploads.push(e)}f.attemptProgression(n,e.index,r)};f.attemptProgression=function(t,n,r){f.loaded++;f.event("filesloading",t,{original:f,toload:f.toload,loaded:f.loaded,uploads:f.uploads});if(f.loaded===f.toload){e("#AJSLoading").addClass(a);e("#AJSUploadSection").addClass(a);e("#AJSImagePreview").removeClass(a);f.toggleLR();var i=f[L]===!1;if(f[L]===!1){f.event("filechanged",t,{original:f,newfile:f.uploads[n],oldfile:r,uploads:f.uploads})}f.event("filesloaded",t,{loaded:f.loaded,original:f,uploads:f.uploads});f[L]=!1;f.toload=f.loaded=0;f.displayUpload(null,i)}};f.toggleLR=function(){if(f.uploads.length>1){e("#AJSLRContainer").removeClass(a)}else{e("#AJSLRContainer").addClass(a)}};f.displayUpload=function(t,n){if(f.uploads.length){if(!t){t=f.getCurr(n)}e("#AJSAdd")[f.currentlength+1>f.s.maxFiles?"addClass":"removeClass"](a);var r=t.mimetype.match("image/*")?t.src:null;f.toggleLR();f.drawImage(t,r);f.currentupload=t.index}else{f.resetToUpload()}};f.drawImage=function(t,n){var r="AJSIMG_"+f.id+t.index,i=t.mimetype.replace(/\/.*$/,""),s=i==="image",o=d&&m&&s,u=e("#"+r),l=e("#AJSEdit");if(u.length){u=M(u,r,s,o)}else{var c="";if(o){c='<canvas id="'+r+'"></canvas>'}else{if(t.mimetype.match("image/*")){c='<img id="'+r+'"/>'}else{c='<span id="'+r+'"><span></span></span>'}}e("#AJSLRContainer").before(c);u=e("#"+r)}if(o){l.removeClass(a);_(u[0],t,ZZ.images[r])}else{if(i==="image"){l.removeClass(a);u[0].src=n}else{l.addClass(a);u.attr({"class":"AJSMIMEIcons "+D(i,t.mimetype)});u.find("span").html(t.name)}}e('[id^="AJSIMG_"]').addClass(a);var h=u[0].tagName==="CANVAS"?u[0].height:u.height();if(!h){h=t.croppedHeight}u.removeClass(a).css({top:(500-h)/2})};f.getCropped64=function(t,n,r,i){if(m){var s=t.getContext("2d"),o=e("#AJSResImg"),u=i.x2-i.x,a=i.y2-i.y,l=n.width,c=n.height;u*=l/o.width();a*=c/o.height();var h=w(u,a,f.s.maxWidth,f.s.maxHeight),p=h.width,d=h.height;var v=p/u,g=d/a;n.croppedWidth=t.width=p;n.croppedHeight=t.height=d;var y=-i.x*(l/o.width())*v;var b=-i.y*(c/o.height())*g;s.drawImage(r,y,b,l*v,c*g);n.base64=t.toDataURL("image/jpeg",f.s.quality)}};f.resetToUpload=function(){var t=e("#AJSRContainer");e("#AJSUploadSection").removeClass(a);e("#AJSImagePreview").addClass(a);e("#AJSChooseText").removeClass(a);e("#AJSLoading").addClass(a);f.uploads.length?t.removeClass(a):t.addClass(a)};f.getCurr=function(e){if(e){f[C]=f.uploads.length-1;return H(f.uploads)}else{if(f.addingmore){var t=H(f.uploads);f[C]=t.index;return t}else{if(f[C]||f[C]===0){return f.uploads[f[C]]}f[C]=0;return B(f.uploads)}}};f.changePrev=function(e){var t=e?-1:1;var n;if(f[C]+t<0){n=H(f.uploads);f[C]=f.uploads.length-1}else if(f[C]+t>f.uploads.length-1){n=B(f.uploads);f[C]=0}else{n=f.uploads[f[C]+t];f[C]+=t}f.displayUpload(n)};f.iconClick=function(){return};f.resizeIconClick=function(){j("AJSResImg").src=f.uploads[f[C]].src;e("#AJSRITrack,[id^=AJSCrop]").removeClass(a)};f.fillEditValues=function(e,t,n){if(t){var r=t.rect,i=r.width,s=r.height,o=Math.round((t.x2-t.x)*(e.width/i).toFixed(20)),u=Math.round((t.y2-t.y)*(e.height/s).toFixed(20));var a=w(o,u,f.s.maxWidth,f.s.maxHeight);o=a.width;u=a.height;j("AJSSAR").value=x(o/u);j("AJSSW").value=o;j("AJSSH").value=u}};f.showInfo=function(){var n=f.uploads[f[C]],i=n.cropdata,s=j("AJSResImg"),o=e("#AJSRInner"),u=e("#AJSRITrack");e("#AJSMain > div").addClass(a);e("#AJSMore").removeClass(a);s.src=n.src;var l=e(s);l.css({maxWidth:parseFloat(e(t).width())-20});o.css({width:"auto"});var c=s.getBoundingClientRect(),h=c.width,d=c.height;var v=i.x!==undefined?i.x2-i.x:h*.8,m=i.y!==undefined?i.y2-i.y:d*.8;u.streamBoundaries("updateOpts",{width:h,height:d,thumbWidth:v,thumbHeight:m,onFinish:function(e){e.rect=c;f.fillEditValues(n,e)}});var g=u.streamBoundaries("reposition",{x:i.x||i.x===0?i.x:"10%",y:i.y||i.y===0?i.y:"10%"}).positionData;E(g);g.rect=c;f.fillEditValues(n,g,{width:n.width,height:n.height});o.width(h);if(!e(".EIconActive").length){e(".AJSEIcon:first").addClass("EIconActive")}e(".EIconActive").click();var y=e("#AJS"),b=(parseFloat(o.height())-d)/2;e("#AJSRBG").css({top:-d,height:d});y.css({minWidth:h>340?h:340,marginLeft:-(y.width()/2)});l.css({marginTop:b}).attr({"data-top":b,"data-bottom":b+d});u.css({marginTop:b});K();if(p){r.body.ondragover=null;r.body.ondrop=null}R()};f.saveInfo=function(){var t=f.uploads[f[C]],n=e("#AJSRITrack").streamBoundaries("getPositionData"),r="AJSIMG_"+f.id+f[C],i=e("#"+r);if(!ZZ.images[r]){var s=new Image;s.src=t.src+"?cachekill="+(new Data).getTime();ZZ.images[r]=s}f.getCropped64(j(r),t,ZZ.images[r],n);var o={x:n.x,x2:n.x2,y:n.y,y2:n.y2};if(t.cropdata!==o){f.existingedited=!0}t.cropdata=o;e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a);e("#AJS").css({minWidth:"initial"});i.css({top:(500-i.height())/2});K();R(true)};f.initBinding=function(){var n=d?e("#AJSFile"):e("#AJSFileLegacy");n.unbind("click").click(function(){var t={accept:f.s.accept};if(f.s.maxFiles>1){t["multiple"]=!0}e(this)[b](t)});if(d){e("#AJSChooseText").unbind("click").click(function(){f.addingmore=!0;f.changing=!1;n.click()})}R(true);n.unbind(y)[y](f.filechanged);e("#AJS").unbind("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(r.selection){r.selection.empty()}});e("#AJSAdd").unbind("click").click(function(){if(f.uploads.length+1>f.s.maxFiles){}else{n.click();f.addingmore=!0}});e("#AJSChange").unbind("click").click(function(){f[L]=f[C];f.addingmore=!1;n.click()});e("#AJSL").unbind("click").click(function(){f.changePrev(!0)});e("#AJSR").unbind("click").click(function(){f.changePrev()});var i=j("AJSICancel"),s=j("AJSISave"),o=j("AJSSW"),l=j("AJSSH"),c=j("AJSSAR"),h=j("AJSEdit");if(h){h.onclick=f.showInfo}if(i){i.onclick=function(){e("#AJSMain > div").addClass(a);e("#AJSImagePreview").removeClass(a);var t=e("#"+"AJSIMG_"+f.id+f[C]);e("#AJS").css({minWidth:"initial"});t.css({top:(500-t.height())/2});K();R()}}if(s){s.onclick=f.saveInfo}e("#AJSRemove").unbind("click").click(function(){streamConfirm(O("Are you sure you want to remove this file?"),function(){var t=[],n=!1,r=!1;for(var i=0,s=f.uploads.length;i<s;i++){if(f.uploads[i]&&i!==f[C]){var o=f.uploads[i];o.index=t.length;t.push(o);if(r!==!1&&n!==!1){r=i}}else{n=i}}e("#AJSIMG_"+f.id+f[C]).remove();f.uploads=t;f.currentlength=f.uploads.length;f.currentupload=r!==false?r:0;e("#AJS_"+f[0].id).val(z(f.uploads));e("#AJSUploadSection").addClass(a);e("#AJSImagePreview").removeClass(a);f.toggleLR();f.displayUpload()},O("This simply removes the file from the list of files to be uploaded, and nowhere else"))});e("#AJSClose,#AJSCloseText").unbind("click").click(function(){e("#AJS_"+f[0].id).val(z(f.uploads));e(u).hide();if(f.s.showPreviewOnForm){e("#AJSFormPrev_"+f.id).html(Q());e("[id^=AJSUploadBtn_]").unbind("click",P).click(P);e(".AJSFP").unbind("click",F).click(F)}f.event("close",f,{original:f[0],uploads:f.uploads,length:f.uploads.length})});e("[id^=AJSUploadBtn_]").unbind("click",P).click(P);e(".AJSFP").unbind("click",F).click(F);if(c){c.onkeypress=function(){var t,n=this.value,r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=f.uploads[f[C]];if(n&&n.match(/^(:?\s+)?\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var s=n.split(/[\/|\:]/);t=s[0]/s[1]}else if(n&&n.match(/^(:?\s+)?(:?\d+|\d+\.\d+)$/)){t=Number(n)}else{return}var o=j("AJSResImg").getBoundingClientRect(),u=i.width/o.width,a=i.height/o.height,l=r.x2-r.x,c=Math.round(l/t),h=false,p=false;if(c+r.y>o.height){p=o.height-c;if(c>o.height){c=o.height;l=Math.round(c*t);p=0;if(l+r.x>o.width){h=o.width-l}}}var d=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:l,thumbHeight:c,x:h,y:p}).positionData;j("AJSSW").value=Math.round(l*u);j("AJSSH").value=Math.round(c*a);E(d)}}if(o){o.onkeypress=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=f.uploads[f[C]],s=false;if(t&&t.match(/\%/)){t=n.width*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.width/n.width,u=Math.round(t/o),a=r.y2-r.y,l=w(u,a,f.s.maxWidth,f.s.maxHeight);u=l.width;a=l.height;if(u+r.x>n.width){s=n.width-u}if(u>n.width){u=n.width;s=0;this.value=i.width}var c=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:u,thumbHeight:a,x:s}).positionData;E(c);this.value=u;j("AJSSH").value=a;j("AJSSAR").value=x(u/a)}}if(l){l.onkeypress=function(){var t=this.value,n=j("AJSResImg").getBoundingClientRect(),r=e("#AJSRITrack").streamBoundaries("getPositionData"),i=f.uploads[f[C]],s=false;if(t&&t.match(/\%/)){t=n.height*(t.replace("%","")/100)}else{t=Number(t)}if(!t){return}var o=i.resizedHeight/n.height,u=Math.round(t/o),a=r.x2-r.x,l=w(a,u,f.s.maxWidth,f.s.maxHeight);a=l.width;u=l.height;if(u+r.y>n.height){u=n.height-u}if(u>n.height){u=n.height;s=0;this.value=i.resizedHeight}var c=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:a,thumbHeight:u,y:s}).positionData;E(c);this.value=u;j("AJSSW").value=a;j("AJSSAR").value=x(a/u)}}e(".AJSEIcon").unbind("click",f.iconClick).click(f.iconClick);e(".AJSEIcon[data-for=AJSWHAR]").unbind("click",f.resizeIconClick).click(f.resizeIconClick);e(window).unbind("resize",K).resize(K)};f.redraw=function(){e("#AJSFormPrev_"+f.id).html(Q());e("[id^=AJSUploadBtn_]").unbind("click",P).click(P);e(".AJSFP").unbind("click",F).click(F)};f.draw=function(){var t=f.parent();f.addClass(a);f.attr({"data-ajaxstreamid":f.c});if(q(e("#AJS_"+f[0].id))){var n=e("#AJS_"+f[0].id).val();f.uploads=n.length?U(n,!0):[];f.currentlength=f.uploads.length;for(var r=0;r<f.currentlength;r++){var i=f.uploads[r];if(!i.cropdata){i.cropdata={}}if(i.mimetype.match("image/*")){var s=new Image;s.src=i.src+"?cachekill="+(new Data).getTime();ZZ.images[o+"IMG_"+f.id+r]=s}}}else{t.append(W.getInput("AJS_"+f[0].id,null,null,"hidden"))}if(f.s.showPreviewOnForm){t.append(W.getDiv(Q(),"AJSFormPrev_"+f.id,"AJSFormPrev",{style:"height:"+f.s.iconPreviewHeight}))}else{t.append(W.getSpan(O("Upload"),"AJSUploadBtn_"+f.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":f.c}))}if(!q(e(u))){v.append(W.getDiv(T(f.s.pathPrefix),o));if(d){e("#AJSImagePreview").after(k())}else{S()}e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,onUpdate:function(e){E(e)}})}f.initBinding();f.event("init",f,{original:f[0],uploads:f.uploads})}();ZZ.streams[f.id]=f;n++;return f},setUploadData:function(e,t){var n=this;if(I("string",e)){e=U(e)}n.uploads=e?e:[];n.currentlength=n.uploads.length;n.toload=n.loaded=n.currentupload=0;if(t){n.redraw()}}};e.fn.ajaxStream=function(t){var n=b(this);if(y[t]){return y[t].apply(n,Array.prototype.slice.call(arguments,1))}else if(Object.prototype.toString.call(t)==="[object Object]"||!t){return y.init.apply(n,arguments)}else{e.error(["The method ",t," does not exist"].join(""))}};if(typeof P!=="function"){function P(e){return e}}window.ZZ=e.ajaxStream={author:"Luke Madhanga",images:{},license:"MIT",streams:{},setDefaults:function(t){g=e.extend(g,t)},submit:function(){},version:.02};W=new W})(jQuery,this,0,document)