!function(e,a,t,i,n){function o(e,a,t,i,o){var r=1*e,l=1*a;return o&&(t=t>o.width?o.width:t,i=i>o.height?o.height:i),r>l?r>t&&(l=s(l*=t/r),r=t):l>i&&(r=s(r*=i/l),l=i),{width:n.round(r),height:n.round(l)}}function s(e){return n.round(e)}function r(a){var t=a.x2-a.x;e("#AJSCropT").css({width:t,height:a.y,left:a.x,top:0}),e("#AJSCropR").css({width:a.trackWidth-a.x2,height:a.trackHeight,right:0,top:0}),e("#AJSCropB").css({width:t,height:a.trackHeight-a.y2,left:a.x,bottom:0}),e("#AJSCropL").css({width:a.x,height:a.trackHeight,left:0,top:0})}function l(e,a,t){if(!window.atob||!window.Uint8Array)return null;a=a||"",t=t||512;for(var i=atob(e.replace(/^data:[a-z09\/-]+;base64,/,"")),n=[],o=0;o<i.length;o+=t){for(var s=i.slice(o,o+t),r=new Array(s.length),l=0;l<s.length;l++)r[l]=s.charCodeAt(l);var d=new Uint8Array(r);n[n.length]=d}return new Blob(n,{type:a})}function d(){if(!k(e("#AJSLegacy"))){var a={method:"post",enctype:"multipart/form-data",target:"AJSIFrame",name:"AJSLegacyForm",action:"/upload.php"};e("body").append(j.getHtml("form",j.getInput("AJSLegacy",null,null,"hidden")+j.getInput(null,"submit",null,"submit"),"AJSLegacyForm",W,a)+j.getHtml("iframe",null,"AJSIFrame",W,{name:"AJSIFrame"}))}}function c(e){var a,t,i,o,s,r,l,d=1e-15,c=e;for(l=n.floor(c),t=1,s=0,a=l,o=1;c-l>d*o*o;)c=1/(c-l),l=n.floor(c),i=t,t=a,r=s,s=o,a=i+l*t,o=r+l*s;return a+":"+o}function u(e){var a=h()+A();return j.getDiv(null,"AJSMainOverlay")+j.getDiv(a+j.getHtml("img",null,"AJSLoading",W,{src:e+"/files/loader.gif",title:w("Files are loading")}),"AJSMain")}function h(){var e=p()+j.getDiv(j.getSpan(null,"AJSL","AJSLR asicons-arrow-left")+j.getSpan(null,"AJSR","AJSLR asicons-arrow-right"),"AJSLRContainer");return j.getDiv(e,"AJSImagePreview",W)}function p(){return j.getDiv(j.getDiv(null,"AJSActionsOverlay")+j.getDiv((E?j.getSpan(null,"AJSAdd","asicons-plus",{title:w("Add another file")}):"")+(E?j.getSpan(null,"AJSChange","asicons-docs",{title:w("Change file")}):"")+(_?j.getSpan(null,"AJSEdit","asicons-pencil",{title:w("Edit")}):"")+j.getSpan(null,"AJSRemove","asicons-trash",{title:w("Remove file")})+j.getSpan(null,"AJSClose","asicons-checkmark",{title:w("Close window")})),"AJSPreviewActions")}function g(){var e="";return e+=j.getDiv(j.getDiv(j.getDiv(j.getHtml("img",null,"AJSResImg")+j.getDiv(j.getDiv(null,"AJSCropT")+j.getDiv(null,"AJSCropR")+j.getDiv(null,"AJSCropB")+j.getDiv(null,"AJSCropL"),"AJSRBG")+j.getDiv(j.getDiv(),"AJSRITrack"),"AJSRInner")+j.getDiv(j.getDiv(j.getDiv(j.getHtml("img",null,"AJSRCImg")),"AJSRCVp"),"AJSRC",W)+j.getDiv(m()+v(),"AJSScaleInfo"),"AJSRIHolder"),"AJSInfo"),j.getDiv(e+j.getDiv(j.getSpan(null,"AJSISave","asicons-checkmark")+j.getSpan(null,"AJSICancel","asicons-cross"),"AJSIBtns"),"AJSMore",W)}function m(){return j.getDiv(j.getSpan(null,null,"AJSEIcon asicons-transform",{"data-for":"AJSWHAR",title:w("Crop Image")})+j.getSpan(null,null,"AJSEIcon asicons-flip-to-front",{"data-for":"AJSRCan",title:w("Resize canvas")}),"AJSEditIcons")}function v(){return S()+f()}function f(){return j.getDiv(j.getDiv(j.getSpan(w("CANVAS WIDTH"))+j.getInput("AJSCW"),null,"AJSSInfo")+j.getDiv(j.getSpan(w("CANVAS HEIGHT"))+j.getInput("AJSCH"),null,"AJSSInfo")+j.getDiv(j.getSpan(w("ZOOM"))+j.getDiv(j.getDiv(),"AJSCZ"),null,"AJSSInfo"),"AJSRCan","AJSEDivs AJSHidden")}function S(){return j.getDiv(j.getDiv(j.getSpan(w("WIDTH"))+j.getInput("AJSSW",null,null,"text",{readonly:""}),null,"AJSSInfo")+j.getDiv(j.getSpan(w("HEIGHT"))+j.getInput("AJSSH",null,null,"text",{readonly:""}),null,"AJSSInfo")+j.getDiv(j.getSpan(w("ASPECT RATIO"))+j.getInput("AJSSAR")+j.getSpan(null,"AJSLockAR","AJSLock asicons-lock-open2"),null,"AJSSInfo"),"AJSWHAR","AJSEDivs")}function A(){var e=T?"<strong>"+J()+"</strong>":"",a=Z?(e?" "+w("or")+" ":"")+"<strong>"+w("drop")+"</strong>":"",t=j.getSpan(w("Choose file")+(E?"":" "+j.getInput("AJSFileLegacy",null,null,"file")),"AJSChooseText","AJSBtnD")+j.getSpan(null,"AJSCloseText","AJSBtnD asicons-cross")+(e||a?j.getDiv(w("You can also")+" "+e+a+" "+w("the file"),"AJSUMore"):""),i=j.getDiv(j.getInput("AJSFile",null,W,"file")+j.getDiv(t,"AJSChooseFile"),"AJSChooseSection");return j.getDiv(i,"AJSUploadSection")+(Z?j.getDiv(j.getHtml("a",w("DROP")),"AJSDropZone",W):"")}function J(){var e="(ctrl + v)";return navigator.platform.match(/Mac/i)&&(e="(cmd + v)"),w("paste")+" "+e}function w(e){return e}function C(e){return e.slice(-1)[0]}function x(e){if(e[0])return e[0];for(var a in e)if(e.hasOwnProperty(a))return e[a]}function y(e,a){for(var t=0;t<e.length;t++)if(e[t]===a)return!0;return!1}function I(e){return i.getElementById(e)}function b(e){return R("Object",e)}function H(e){return R("Array",e)}function R(e,a){if(void 0===a)return!1;var t=e.substr(0,1).toUpperCase()+e.substr(1).toLowerCase();return Object.prototype.toString.call(a)==="[object "+t+"]"}function k(e){return e.length>0}function D(e){var a=[];for(var t in e)e.hasOwnProperty(t)&&a.push(e[t]);return a}function L(e,a){var t;if(!e)return!1;try{t=JSON.parse(e)}catch(i){t=JSON.parse("'"+e+"'")}return t?a?D(t):t:!1}function F(e){var a=e;if(R("Array",a)){a={};for(var t=0,i=e.length;i>t;t++)e[t]&&(a[t]=e[t])}return JSON.stringify(a)}function j(){function e(e,a){if(b(a))for(var t in a)if(a.hasOwnProperty(t)){var i=a[t];"boolean"==typeof i&&(i=i?1:0),e.setAttribute(t,i)}}var a=this;this.getLink=function(e,t,i,n,o,s){return b(s)||(s={}),o&&(s.rel="nofollow"),s.href=t,a.getHtml("a",e,i,n,s)},this.getHtml=function(a,t,n,o,s){var r=i.createElement(a);return t&&(r.innerHTML=t),n&&(r.id=n),o&&(r.className=o),e(r,s),r.outerHTML},this.getInput=function(e,t,i,n,o){return b(o)||(o={}),(t||0===t)&&(o.value=t),e&&!o.name&&(o.name=e),o.type=n?n:"text",a.getHtml("input",null,e,i,o)},this.getSpan=function(e,t,i,n){return a.getHtml("span",e,t,i,n)},this.getDiv=function(e,t,i,n){return a.getHtml("div",e,t,i,n)}}var W="AJSHidden",P=function(){},T="onpaste"in i,Z="draggable"in i.createElement("span"),E=!!(a.Blob||a.File||a.FileList||a.FileReader),B=i.createElement("canvas"),_=!(!B.getContext||!B.getContext("2d")),M={VP_MAX_HEIGHT:420},U={accept:[".*"],allowFilters:!0,maxFileSize:2097152,maxFiles:1,iconPreviewHeight:200,iconPreviewWidth:200,maxHeight:1024,maxWidth:1024,onbeforeopen:P,onclose:P,onfilechanged:P,onfilechanging:P,onfileselected:P,onfilesloaded:P,onfilesloading:P,oninit:P,onlegacyuploadfail:P,onlegacyuploadfinish:P,onlegacyuploadstart:P,onopen:P,onsetuploaddata:P,onsingleuploadfail:P,onsingleuploadfinish:P,onsingleuploadstart:P,onuploadfail:P,onuploadfinish:P,onuploadprogress:P,onuploadstart:P,pathPrefix:"",quality:1,readonly:!1,scale9Grid:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var a=1;a<arguments.length;a++){var t=new RegExp("\\{"+(a-1)+"\\}","g");e=e.replace(t,arguments[a])}return e},uploadScript:"/upload.php",uploadTo:"uploads"},O={init:function(h){function p(e){return ea.s.translateFunction.apply(null,arguments)}function m(a,t,n,o){var s;if(y(["CANVAS","IMG"],a[0].tagName)&&!n)s='<span id="'+t+'"><span></span></span>';else if("SPAN"===a[0].tagName&&n)s=i.createElement(o?"canvas":"img"),s.id=t;else if("IMG"===a[0].tagName&&o)s=i.createElement("canvas"),s.id=t;else{if("CANVAS"!==a[0].tagName||o)return a;s=i.createElement("img"),s.id=t}return a.after(s),a.remove(),e("#"+t)}function v(e,a,t){a.newsrc&&(t=new Image,t.src=a.newsrc),t.width||t.height?f(e,a,t):t.onload=function(){f(e,a,t),q()}}function f(e,a,t){var i=o(t.width,t.height,ea.s.maxWidth,ea.s.maxHeight),n=e.getContext("2d");a.croppedWidth=a.resizedWidth=e.width=i.width,a.croppedHeight=a.resizedHeight=e.height=i.height,ea.multipass(e,n,t),(a.newupload||ea.edited)&&(a.newsrc=e.toDataURL(a.mimetype,ea.s.quality))}function S(a,t,n,o,s,r){if(e("#AJSLoading").removeClass(W),r&&o.canvasZoom){var l=o.canvasZoom,d=i.createElement("canvas"),c=d.getContext("2d");d.width=o.croppedWidth,d.height=o.croppedHeight,c.drawImage(n,s.x,s.y,s.outwidth,s.outheight),a.width=o.canvasWidth,a.height=o.canvasHeight,t.drawImage(d,l.x,l.y,l.width,l.height)}else t.drawImage(n,s.x,s.y,s.outwidth,s.outheight);o.newsrc=a.toDataURL(o.mimetype,ea.s.quality),e("#AJSLoading").addClass(W)}function A(e,a){switch(a){case"application/zip":case"application/gzip":return"asicons-file-zip";case"text/css":return"asicons-file-css";case"text/javascript":case"application/javascript":case"text/php":case"text/x-php":case"application/php":case"application/x-php":case"text/xml":case"text/html":return"asicons-code";case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":return"asicons-file-powerpoint";case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":case"application/msword":return"asicons-file-word";case"application/vnd.ms-excel":case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"asicons-file-excel";case"application/pdf":case"application/x-pdf":case"application/vnd.pdf":return"asicons-file-pdf";case"application/vnd.oasis.opendocument.spreadsheet":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.oasis.opendocument.text":return"asicons-file-openoffice"}switch(e){case"application":case"application-x":return"asicons-desktop";case"audio":return"asicons-microphone";case"model":return"asicons-tools";case"pdf":return"asicons-file-pdf";case"text":return"asicons-file-text-o";case"video":return"asicons-video";default:return"asicons-help"}}function J(e,a){var t=e.canvasWidth,i=e.canvasHeight,n=i?i:a.height,o=t?t:a.width,s=a.height,r=a.width,l=1;return n>M.VP_MAX_HEIGHT&&(l=n/M.VP_MAX_HEIGHT,n=M.VP_MAX_HEIGHT,o/=l,s/=l,r/=l),{height:n,thumbHeight:s,thumbWidth:r,width:o,scale:l}}function w(){var a=e(this),t=a[0].id.replace("AJSUploadBtn_","");ea.event("beforeopen",this,{elemid:t.replace(/^\d+_(.*)$/,"$1"),index:t.replace(/^(\d+)_.*/,"$1"),uploads:ea.uploads}),K=ZZ.streams[t],ZZ.currentstream=K;var i=e("#AJS");i.show(),i.css({marginTop:-(i.height()/2),marginLeft:-(i.width()/2)}),ea.uploads.length?ea.displayUpload():ea.resetToUpload(),ea.event("open",K,{original:K[0],uploads:ea.uploads,length:ea.uploads.length}),D(ea.s.readonly),a.hasClass("AJSFPBtn")&&e("#AJSFile").click()}function b(){var a=e(this)[0].id,t=a.replace(/.*\_(\d+)$/,"$1");a=a.replace(/\_\d+$/,"");var i=a.replace("AJSFP_","");ea.event("beforeopen",this,{elemid:i.replace(/^\d+_(.*)$/,"$1"),index:i.replace(/^(\d+)_.*/,"$1"),uploads:ea.uploads}),K=ZZ.streams[i],ZZ.currentstream=K,ea.currentupload=t;var n=e("#AJS");n.show(),n.css({marginTop:-(n.height()/2),marginLeft:-(n.width()/2)}),ea.displayUpload(ea.uploads[t]),e("#AJSMain > div").addClass(W),e("#AJSImagePreview").removeClass(W),ea.event("open",K,{original:K[0],uploads:ea.uploads,length:ea.uploads.length}),D(ea.s.readonly)}function D(a){var t=a?"addClass":"removeClass",i=ea.uploads[ea.currentupload];e("#AJSChange,#AJSRemove,#AJSEdit")[t](W),!a&&i&&(i.mimetype.match("image/*")&&"image/gif"!==i.mimetype&&_?e("#AJSEdit").removeClass(W):e("#AJSEdit").addClass(W))}function B(a){var t=M.VP_MAX_HEIGHT,i=a>t?t:a;e("#AJSRCVp").css({top:(t-i)/2})}function O(a){a.lastMove||e("#AJSCZ").streamBoundaries("reposition");var t=V(),i=ea.uploads[ea.currentupload],n=a.px||0===a.px?1*a.px:1,o=t.minWidth+t.width*n,s=t.minHeight+t.height*n,r=e("#AJSRCVp").streamBoundaries("updateOpts",{thumbHeight:s,thumbWidth:o}).streamBoundaries("reposition").positionData;i.edited=!0,i.canvasZoom={height:s*t.scale,width:o*t.scale,scalePercent:n,x:r.x*t.scale,y:r.y*t.scale}}function G(){var a=e("#AJSRCVp").streamBoundaries("getPositionData"),t=ea.uploads[ea.currentupload],i=V();t.canvasZoom||(t.canvasZoom={width:t.canvasWidth?t.canvasWidth:t.croppedWidth,height:t.canvasHeight?t.canvasHeight:t.croppedHeight,scalePercent:1}),t.canvasZoom.x=a.x*i.scale,t.canvasZoom.y=a.y*i.scale}function V(){var a,t,i=ea.uploads[ea.currentupload],n=i.croppedWidth,s=i.croppedHeight,r=i.canvasWidth?i.canvasWidth:n,l=i.canvasHeight?i.canvasHeight:s,d=n/s,c=1;if(n>s?(t=l,a=l*d,r>a&&(a=r,t=r/d)):(a=r,t=r/d,l>t&&(t=l,a=l*d)),l>M.VP_MAX_HEIGHT){var u=e("#AJSRITrack").streamBoundaries("getPositionData"),h=e("#AJSResImg"),p=h.is(":visible"),g=p?h.width():h.data("width"),m=p?h.height():h.data("height"),v=u.x2-u.x,f=u.y2-u.y,S=i.width,A=i.height;v*=S/g,f*=A/m;var w=o(v,f,ea.s.maxWidth,ea.s.maxHeight),C=J(i,w),x=t/M.VP_MAX_HEIGHT;t=M.VP_MAX_HEIGHT,a/=x,s=C.thumbHeight,n=C.thumbWidth,t>s&&(s=w.height,n=w.width),r>a&&(a=r/x,t=a/d),l>t&&(t=l/x,a=t*d),c=C.scale}return{width:n-a,height:s-t,minWidth:a,minHeight:t,scale:c}}function z(e){if(ea.s.readonly&&(e=!1),Z&&(e?(i.body.ondragover=N,i.body.ondrop=$):(i.body.ondragover=null,i.body.ondrop=null)),T){var a=I("AJS");a.onpaste=e?Y:null}}function N(a){var t=a.dataTransfer;(y(t.types,"Files")||y(t.types,"text/uri-list"))&&(e(a.target).closest(".AJSBtn,.AJSInlineDrop").parent().length?(e(".AJSInlineDrop").removeClass(W),e(".AJSBtn").addClass(W)):(e(".AJSInlineDrop").addClass(W),e(".AJSBtn").removeClass(W)),"AJSMainOverlay"===a.target.id?e("#AJSDropZone").addClass(W):(a.stopPropagation(),a.preventDefault(),t.dropEffect="copy",e("#AJSDropZone").removeClass(W)))}function $(a){a.stopPropagation(),a.preventDefault(),e(".AJSInlineDrop").css({display:"none"});var t=e(a.target);if(t.closest("#AJS,.AJSInlineDrop").length){if(e("#AJSLoading").removeClass(W),t.closest(".AJSInlineDrop").length){var i=t.parent().find(".AJSBtn");i.click().removeClass(W)}for(var n=a.dataTransfer,o=n.files,s=0;s<o.length;s++)o[s].type.match(ea.s.accept)||(o[s]=null);if(!o.length&&_){var r=ea.uploads.length+1;if(r>ea.s.maxFiles)return streamConfirm(p("Maximum files exceeded"),{Close:P},p("You have selected {0} files but are only permitted to upload {1}",r,ea.s.maxFiles),{nocancel:!0}),e("#AJSDropZone").addClass(W),void e("#AJSLoading").addClass(W);z();var l=n.getData("url");return l||(l=n.getData("text/plain"),l||(l=n.getData("text/uri-list")))?(ea.event("filesloading",null,{original:K[0],toload:ea.toload,loaded:ea.loaded,uploads:ea.uploads,stream:K}),X(l,p("There was an error processing the external file you dropped")),void e("#AJSDropZone").addClass(W)):void e("#AJSLoading").addClass(W)}e("#AJSDropZone").addClass(W),ea.addingmore=!0,ea.filechanged.call(null,{eventType:"drop",originalEvent:a,target:{files:o}})}}function X(a,t){var i=function(){z(!0)};e.ajax({url:ea.s.uploadScript+"?external=true",type:"post",dataType:"json",data:{filesrc:a,uploaddir:ea.s.uploadTo}}).done(function(a){if("OK"===a.result){i();var n=ea.uploads.length;if(a.data.index=n,ea.uploads[n]=a.data,ea.currentlength++,e("#AJSFile,#AJSFileLegacy").val(null),e("#AJSUploadSection").addClass(W),e("#AJSImagePreview").removeClass(W),ea.toggleLR(),ea.event("filesloaded",null,{loaded:ea.loaded,original:K[0],uploads:ea.uploads,stream:K}),ea.changing=!1,ea.toload=ea.loaded=0,a.data.mimetype.match("image/*")){var o=new Image;o.onload=function(){this.imageloaded=!0,ZZ.images["AJSIMG_"+ea.id+n]=o,ea.displayUpload(null,!0)},o.onerror=function(){ea.uploads.splice(n,1),t&&streamConfirm(p("Error"),{Close:i},t,{nocancel:!0})},o.src=a.data.src+"?cachekill="+(new Date).getTime()}else ea.displayUpload(null,!0)}else t&&streamConfirm(p("Error"),{Close:i},t,{nocancel:!0})}).fail(function(){e("#AJSLoading").addClass(W),t&&streamConfirm(p("Error"),{Close:i},t,{nocancel:!0})})}function Y(a){for(var t=a.clipboardData.items,i=t.length,n=null,o=!1,s=0;s<t.length;s++){var r=t[s];r.type.match(ea.s.accept)||(r.type.match(/^text\/html/)&&"getAsString"in r&&r.getAsString(function(a){n=e(a)[1].src,o&&n&&n.match(/^http(:?s)?\:\/\//)&&X(n)}),t[s]=null,i--)}if(!i)return void(o=!0);ea.toload=i,ea.loaded=0;var l=i+ea.uploads.length;l>ea.s.maxFiles&&(streamConfirm(p("Maximum files exceeded"),{Close:P},p("You have selected {0} files but are only permitted to upload {1}",l,ea.s.maxFiles),{nocancel:!0}),i=ea.toload=ea.s.maxFiles-ea.uploads.length);for(var s=0;i>s;s++){var r=t[s];if(r){var d=r.getAsFile();d&&d.size?(ea.addingmore=!0,ea.process(d,s)):(o=!0,o&&n&&n.match(/^http(:?s)?\:\/\//)?(o=!1,X(n,p("There was an error processing the file that you pasted"))):streamConfirm(p("Error"),{Close:P},p("There was an error processing the pasted file. The system will try to get the file another way"),{nocancel:!0}))}}}function q(){var a="AJSIMG_"+ea.id+ea.currentupload,t=e("#"+a);t.is(":visible")&&t.css({top:(500-t.height())/2});var i=e("#AJS");i.css({marginLeft:-(i.width()/2),marginTop:-(i.height()/2)})}function Q(){var e="",a=ea.uploads,t=parseFloat(ea.s.iconPreviewHeight),i=parseFloat(ea.s.iconPreviewWidth),n=0;for(var o in a){var s,r=a[o],l=r.mimetype.replace(/\/.*$/,""),d="image"===l;if(d){var c,u=r.canvasWidth?r.canvasWidth:r.croppedWidth,h=r.canvasHeight?r.canvasHeight:r.croppedHeight;if(h>u)c="height: 100%;width: auto;";else{var g=u/h,h=i/g;c="width: 100%;height: auto;margin-top:"+(t-h)/2+"px;"}s=j.getHtml("img",null,null,null,{src:r.newsrc,style:c})}else s=j.getSpan(null,null,A(l,r.mimetype),{style:"line-height:"+t+"px;font-size:"+(i-20)+"px;"});s+=j.getDiv(r.name,null,"AJSFPName"),e+=j.getDiv(s,"AJSFP_"+ea.id+"_"+r.index,"AJSFP",{style:"width:"+i+"px;height:"+t+"px;",tabindex:0}),n++}return ea.s.maxFiles&&a.length+1<=ea.s.maxFiles&&ea.uploads.length&&E&&(e+=j.getSpan(null,"AJSUploadBtn_"+ea.id,"asicons-plus AJSBtn AJSFPBtn",{"data-ajaxstreamid":ea.c,tabindex:0})),n||(e+=j.getSpan(p("Upload"),"AJSUploadBtn_"+ea.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":ea.c,tabindex:0})+j.getSpan(p("Drop"),"AJSDropZone_"+ea.id,"AJSInlineDrop "+W)),e}var K=this;if(K.length>1)return K.each(function(){e(this).ajaxStream(h)}),K;if(!K.length||K.data("ajs.ajaxstreamdata"))return K;var ea={addingmore:!1,c:++t,changing:!1,currentlength:0,currentupload:null,filedata:{},id:[t,"_",K[0].id].join(""),loaded:0,s:e.extend(e.extend({},U),h),toload:0,uploads:[]},aa=e("body");return ea.event=function(e,a){return ea.s["on"+e].apply(a,Array.prototype.slice.call(arguments,2))},ea.legacyUpload=function(t){var i=ea.changing===!1?ea.uploads.length:ea.changing;ea.filedata={aspectRatioLocked:!1,base64:null,canvasWidth:null,canvasHeight:null,canvasZoom:null,croppedWidth:null,croppedHeight:null,index:i,islegacy:!0,mimetype:null,name:null,newupload:!0,resizedWidth:null,resizedHeight:null,size:null},K.data("ajs.ajaxstreamdata",ea),a.AJSLegacy=ZZ.streams[ea.id],e("#AJSLegacy").val(JSON.stringify({maxsize:ea.s.maxFileSize,maxheight:ea.s.maxHeight,maxwidth:ea.s.maxWidth,uploaddir:ea.s.uploadTo,islegacy:!0,id:ea.id}));var n=e("#AJSFileLegacy"),o=n.clone();o.insertAfter(n),n[0].id=null,e("#AJSLegacyForm").prop({action:ea.s.uploadScript+"?newupload=true"}).append(n),o.unbind("change.ajsfilechanged").bind("change.ajsfilechanged",ea.filechanged),ea.event("legacyuploadstart",t,{original:K[0],stream:K,uploads:ea.uploads}),I("AJSLegacyForm").submit(),e("#AJSLoading").removeClass(W)},ea.afterLegacyUpload=function(t){e("input[name=AJSFileLegacy]","#AJSLegacyForm").remove(),e("#AJSLoading").addClass(W),t.moved?(t.mimetype.match("image/*")&&(ea.filedata.croppedWidth=ea.filedata.resizedWidth=ea.filedata.width=t.width,ea.filedata.croppedHeight=ea.filedata.resizedHeight=ea.filedata.height=t.height),ea.currentlength++,ea.filedata.newsrc=t.location,ea.filedata.src=t.location,ea.filedata.name=t.name,ea.filedata.size=t.size,ea.filedata.mimetype=t.mimetype,ea.filedata.src=t.location,ea.event("legacyuploadfinish",K,{original:K[0],results:t,uploads:ea.uploads}),ea.afterFileRead(ea.filedata,ea.changing!==!1),a.AJSLegacy=null,K.data("ajs.ajaxstreamdata",ea)):(ea.event("legacyuploadfail",null,{original:K[0],error:t.error,results:t,uploads:ea.uploads,stream:K}),streamConfirm(p("Error"),{Close:P},t.error,{nocancel:!0}))},ea.filechanged=function(e){var a=e.target.files;if(!a&&e.target.value.match(/^.\:\\/))return ea.legacyUpload(this),ea.toload=1,void K.data("ajs.ajaxstreamdata",ea);if(!a.length)return ea.changing=!1,void K.data("ajs.ajaxstreamdata",ea);var t=ea.toload=a.length;if(ea.event("fileselected",this,{originalEvent:e.originalEvent,files:a,toload:ea.toload,original:K[0],stream:K,jQueryEvent:e,uploads:ea.uploads}),E){for(var i=0;t>i;i++)a[i]||ea.toload--;if(ea.toload<=0&&streamConfirm(p("Error"),{Close:P},p("There was an error during the upload: the file list is empty"),{nocancel:!0}),K.data("ajs.ajaxstreamdata",ea),ea.changing===!1){t=ea.toload;var n=t+ea.uploads.length;n>ea.s.maxFiles&&(streamConfirm(p("Maximum files exceeded"),{Close:P},p("You have selected {0} files but are only permitted to upload {1}",n,ea.s.maxFiles),{nocancel:!0}),t=ea.toload=ea.s.maxFiles-ea.uploads.length);for(var i=0;t>i;i++)a[i]&&ea.process(a[i],i)}else ea.event("filechanging",this,{originalEvent:e.originalEvent,file:a[0],current:ea.uploads[ea.changing],original:K[0],jQueryEvent:e,stream:K,uploads:ea.uploads}),ea.process(a[0],ea.changing,!0,this)}else ea.legacyUpload(this)},ea.process=function(t,n,s,r){if(e("#AJSLoading").removeClass(W),R("blob",t)||R("file",t)){var l=new FileReader,d=t.type.match("image/*")&&"image/gif"!==t.type;l.onload=function(e){var l=new Blob([e.target.result],{type:t.type}),c=(a.URL||a.webkitURL).createObjectURL(l),u=s?n:null,h={aspectRatioLocked:!1,edited:!1,index:u,islegacy:!1,mimetype:t.type,name:t.name,newupload:!0,size:t.size,src:c};if(s||(ea.currentlength++,K.data("ajs.ajaxstreamdata",ea)),d){var p=new Image,g=i.createElement("canvas"),m=g.getContext("2d");p.onload=function(){var e=this,a=o(p.width,p.height,ea.s.maxWidth,ea.s.maxHeight);e.imageloaded=!0,g.width=h.width=h.resizedWidth=h.croppedWidth=a.width,g.height=h.height=h.resizedHeight=h.croppedHeight=a.height,h.canvasWidth=h.canvasHeight=h.canvasZoom=null,h.cropdata={},h.image=e,ea.multipass(g,m,p),h.newsrc=g.toDataURL(h.mimetype,1),ea.afterFileRead(h,s,r)},p.onerror=function(){h.src=null,ea.afterFileRead(h,s,r)},p.src=c}else h.newsrc=e.target.result,ea.afterFileRead(h,s,r)},l.onerror=function(a){var t=a.currentTarget.error;e("#AJSLoading").addClass(W),streamConfirm(p("Error"),{Close:P},p("There was an error processing the selected file.\n                        Make sure what you selected was indeed a file. Full details")+": "+t.message,{nocancel:!0}),console.error(t.name+": "+t.message)},d?l.readAsArrayBuffer(t):l.readAsDataURL(t)}else streamConfirm(p("Error"),{Close:P},p("The selection is not a file"),{nocancel:!0})},ea.afterFileRead=function(e,a,t){var i,n=null;a?(i=e.index,n=ea.uploads[i],ea.uploads[i]=e):(i=ea.uploads.length,e.index=i,ea.uploads[i]=e),ZZ.images["AJSIMG_"+ea.id+i]=e.image,delete e.image,ea.attemptProgression(t,e.index,n)},ea.attemptProgression=function(a,t,i){if(ea.loaded++,ea.event("filesloading",a,{original:K[0],toload:ea.toload,loaded:ea.loaded,uploads:ea.uploads,stream:K}),ea.loaded===ea.toload){e("#AJSFile,#AJSFileLegacy").val(null),e("#AJSLoading").addClass(W),e("#AJSUploadSection").addClass(W),e("#AJSImagePreview").removeClass(W),ea.toggleLR();var n=ea.changing===!1;ea.changing===!1&&ea.event("filechanged",a,{original:K[0],newfile:ea.uploads[t],oldfile:i,uploads:ea.uploads,stream:K}),ea.event("filesloaded",a,{loaded:ea.loaded,original:K[0],uploads:ea.uploads,stream:K}),ea.changing=!1,ea.toload=ea.loaded=0,ea.displayUpload(null,n)}K.data("ajs.ajaxstreamdata",ea)},ea.toggleLR=function(){ea.uploads.length>1?e("#AJSLRContainer").removeClass(W):e("#AJSLRContainer").addClass(W)},ea.displayUpload=function(a,t){if(ea.uploads.length){a||(a=ea.getCurr(t)),e("#AJSAdd")[ea.currentlength+1>ea.s.maxFiles?"addClass":"removeClass"](W);var i=a.mimetype.match("image/*"),n=i?"image/gif"===a.mimetype?a.newsrc:a.src:null;ea.toggleLR(),n||!i&&!n?(ea.drawImage(a,n),ea.currentupload=a.index,K.data("ajs.ajaxstreamdata",ea)):streamConfirm(p("Corrupt upload"),{ok:ea.deleteUpload},p("There is no source for this upload meaning that you cannot continue. Click 'ok' to delete"),{nocancel:!0})}else ea.resetToUpload()},ea.drawImage=function(a,t){var i="AJSIMG_"+ea.id+a.index,n=a.mimetype.replace(/\/.*$/,""),o="image"===n,s=E&&_&&o&&"image/gif"!==a.mimetype,r=e("#"+i),l=e("#AJSEdit");if(l.addClass(W),r.length)r=m(r,i,o,s);else{var d="";d=s?'<canvas id="'+i+'"></canvas>':a.mimetype.match("image/*")?'<img id="'+i+'"/>':'<span id="'+i+'"><span></span></span>',e("#AJSLRContainer").before(d),r=e("#"+i)}s?(l.removeClass(W),v(r[0],a,ZZ.images[i])):"image"===n?(r[0].src=t,a.width&&a.height||(r[0].onload=function(){a.width=this.width,a.height=this.height,a.canvasWidth=a.canvasHeight=null})):(r.attr({"class":"AJSMIMEIcons "+A(n,a.mimetype)}),r.find("span").html(a.name)),e('[id^="AJSIMG_"]').addClass(W);var c="CANVAS"===r[0].tagName?r[0].height:r.height();c||(c=a.croppedHeight),r.removeClass(W).css({top:c>500?0:(500-c)/2}),e("#AJSLoading").addClass(W),q()},ea.setCropped64=function(a,t,i,n,s){if(_){var r=a.getContext("2d"),l=e("#AJSResImg"),d=l.is(":visible"),c=d?l.width():l.data("width"),u=d?l.height():l.data("height"),h=n.x2-n.x,p=n.y2-n.y,g=t.width,m=t.height;h*=g/c,p*=m/u;var v=o(h,p,ea.s.maxWidth,ea.s.maxHeight),f=v.width,A=v.height,J=f/h,w=A/p,C=-n.x*(g/c)*J,x=-n.y*(m/u)*w,y=g*J,I=m*w;t.croppedWidth=a.width=f,t.croppedHeight=a.height=A,i.imageloaded?S(a,r,i,t,{x:C,y:x,outwidth:y,outheight:I},s):(e("#AJSLoading").removeClass(W),i.onload=function(){i.imageloaded=!0,S(a,r,i,t,{x:C,y:x,outwidth:y,outheight:I},s),e("#AJSLoading").addClass(W)}),K.data("ajs.ajaxstreamdata",ea)}},ea.multipass=function(e,a,t,o,s,r,l){var d=r?r:e.width,c=l?l:e.height,u=void 0===o?0:n.floor(o),h=void 0===s?0:n.floor(s);if(t.width/d>2||t.height/d>2){var p=i.createElement("canvas"),g=p.getContext("2d");p.width=.5*t.width,p.height=.5*t.height,g.drawImage(t,u,h,p.width,p.height),g.drawImage(p,0,0,.5*p.width,.5*p.height),a.drawImage(p,0,0,.5*p.width,.5*p.height,.75*u,.75*h,d,c)}else a.drawImage(t,u,h,d,c)},ea.resetToUpload=function(){var a=e("#AJSRContainer");e("#AJSUploadSection").removeClass(W),e("#AJSImagePreview").addClass(W),e("#AJSChooseText").removeClass(W),e("#AJSLoading").addClass(W),ea.uploads.length?a.removeClass(W):a.addClass(W)},ea.getCurr=function(e){if(e)return ea.currentupload=ea.uploads.length-1,ea.uploads[ea.currentupload];if(ea.addingmore){var a=C(ea.uploads);return ea.currentupload=a.index,a}return ea.currentupload||0===ea.currentupload?ea.uploads[ea.currentupload]:(ea.currentupload=0,x(ea.uploads))},ea.changePrev=function(e){var a,t=e?-1:1;ea.currentupload+t<0?(a=C(ea.uploads),ea.currentupload=ea.uploads.length-1):ea.currentupload+t>ea.uploads.length-1?(a=x(ea.uploads),ea.currentupload=0):(a=ea.uploads[ea.currentupload+t],ea.currentupload+=t),ea.displayUpload(a)},ea.iconClick=function(){var a=e(this),t=e(".EIconActive"),n=K.data("ajs.ajaxstreamdata");if(t.data("for")===a.data("for"))return!1;e("#AJSLoading").removeClass(W);var s=e("#AJSRInner"),r=e("#AJSRC");switch(e(".AJSEDivs").addClass(W),e("#"+a.data("for")).removeClass(W),a.data("for")){case"AJSRCan":var l=e("#AJSRITrack").streamBoundaries("getPositionData"),d=n.uploads[n.currentupload],c=d.canvasZoom,u=c?c.scalePercent:!1,h=d.canvasWidth,p=d.canvasHeight,g=e("#AJSResImg"),m=g.width(),v=g.height(),f=h&&p&&null===c,S=l.x2-l.x,A=l.y2-l.y,w=d.width,C=d.height;S*=w/m,A*=C/v;var x=o(S,A,n.s.maxWidth,n.s.maxHeight),y=J(d,x);if(g.attr({"data-width":m,"data-height":v}),n.setCropped64(i.createElement("canvas"),d,ZZ.images["AJSIMG_"+n.id+n.currentupload],l),s.addClass(W),r.removeClass(W),I("AJSRCImg").src=d.newsrc,I("AJSCW").value=h?h:d.croppedWidth,I("AJSCH").value=p?p:d.croppedHeight,e("#AJSRCVp").streamBoundaries("updateOpts",{height:y.height,thumbHeight:y.thumbHeight,thumbWidth:y.thumbWidth,width:y.width}),u||0===u||f){u=f?1:u;var b=e("#AJSCZ").streamBoundaries("reposition",{x:100*u+"%"});O.call(b,b.positionData)}B(p?p:x.height);break;case"AJSWHAR":r.addClass(W),s.removeClass(W)}t.removeClass("EIconActive"),a.addClass("EIconActive"),e("#AJSLoading").addClass(W)},ea.fillEditValues=function(e,a){if(a){var t=ea.getScaledDimensions(a,e);I("AJSSAR").value=c(t.aspectRatio),I("AJSSW").value=t.width,I("AJSSH").value=t.height}},ea.getScaledDimensions=function(e,a){var t=e.rect,i=t.width,n=t.height,r=s((e.x2-e.x)*(a.width/i)),l=s((e.y2-e.y)*(a.height/n)),d=ea.s.maxWidth,c=ea.s.maxHeight,u=o(r,l,d,c);return r=u.width,l=u.height,{width:r,height:l,aspectRatio:r/l}},ea.showInfo=function(){e(".AJSEIcon:first").click(),e("#AJSLoading").removeClass(W);var t=ea.uploads[ea.currentupload],n=t.cropdata,o=e("#AJSResImg"),s=e("#AJSRInner"),l=e("#AJSRITrack"),d=ZZ.images["AJSIMG_"+ea.id+ea.currentupload],c=j.getHtml("img",null,"AJSResImg",null,{src:d.src,"data-top":o.attr("data-top"),"data-bottom":o.attr("data-bottom"),"data-width":o.attr("data-width"),"data-height":o.attr("data-height"),style:o.attr("style")}),u=e("#AJSLockAR");e("#AJSMain > div").addClass(W),e("#AJSMore").removeClass(W),o.remove(),s.prepend(c),o=e("#AJSResImg"),s.hide(),o[0].onload=function(){e("#AJSLoading").addClass(W),s.show(),o.css({maxWidth:parseFloat(e(a).width())-20}),s.css({width:"auto"});var d=o[0].getBoundingClientRect(),c=d.width,h=d.height,p=void 0!==n.x?n.x2-n.x:c,g=void 0!==n.y?n.y2-n.y:h;l.streamBoundaries("updateOpts",{width:c,height:h,thumbWidth:p,thumbHeight:g,onFinish:function(e){e.rect=d,ea.fillEditValues(t,e),r(e),ea.uploads[ea.currentupload].canvasZoom=null}}),s.width(c);var m=l.streamBoundaries("reposition",{x:n.x||0===n.x?n.x:0,y:n.y||0===n.y?n.y:0}).positionData;r(m),m.rect=d,ea.fillEditValues(t,m),t.aspectRatioLocked?u.removeClass("asicons-lock-open2").addClass("asicons-lock2"):u.removeClass("asicons-lock2").addClass("asicons-lock-open2"),e(".AJSEIcon").removeClass("EIconActive").first().click();var v=e("#AJS"),f=(parseFloat(s.height())-h)/2;e("#AJSRBG").css({top:-h,height:h}),v.css({minWidth:c>340?c:340,marginLeft:-(v.width()/2)}),o.css({marginTop:f}).attr({"data-top":f,"data-bottom":f+h}),l.css({marginTop:f}),q(),Z&&(i.body.ondragover=null,i.body.ondrop=null),z()},o[0].src=d.src},ea.saveInfo=function(){var a=ea.uploads[ea.currentupload],t=e("#AJSRITrack").streamBoundaries("getPositionData"),i="AJSIMG_"+ea.id+ea.currentupload,n=e("#"+i);if(!ZZ.images[i]){var o=new Image;o.onload=function(){this.imageloaded=!0},o.src=a.src+"?cachekill="+(new Date).getTime(),ZZ.images[i]=o}ea.setCropped64(I(i),a,ZZ.images[i],t,!0);var s={x:t.x,x2:t.x2,y:t.y,y2:t.y2};a.cropdata!==s&&(a.edited=!0,ea.edited=!0),a.cropdata=s,e("#AJSMain > div").addClass(W),e("#AJSImagePreview").removeClass(W),e("#AJS").css({minWidth:"initial"}),n.css({top:(500-n.height())/2}),q(),z(!0),e.streamBoundaries.unsetMouseMove(),K.data("ajs.ajaxstreamdata",ea)},ea.deleteUpload=function(){for(var a=[],t=!1,i=!1,n=0,o=ea.uploads.length;o>n;n++)if(ea.uploads[n]&&n!==ea.currentupload){var s=ea.uploads[n];s.index=a.length,a.push(s),i!==!1&&t!==!1&&(i=n)}else t=n;e("#AJSIMG_"+ea.id+ea.currentupload).remove(),ea.uploads=a,ea.currentlength=ea.uploads.length,ea.currentupload=i!==!1?i:0,e("#AJS_"+K[0].id).val(F(ea.uploads)),e("#AJSUploadSection").addClass(W),e("#AJSImagePreview").removeClass(W),ea.toggleLR(),ea.displayUpload(),K.data("ajs.ajaxstreamdata",ea)},ea.initBinding=function(){var t=e(E?"#AJSFile":"#AJSFileLegacy");t.unbind("click").click(function(){var a=ea.s.accept;(".*"===a||H(a)&&y(a,".*"))&&(a="*");var t={accept:a};ea.s.maxFiles>1&&(t.multiple=!0),e(this).attr(t)}),E&&e("#AJSChooseText").unbind("click").click(function(){ea.addingmore=!0,ea.changing=!1,t.click()}),z(!0),t.unbind("change").change(ea.filechanged),e("#AJSImagePreview").unbind("dbclick").dblclick(function(){a.getSelection?a.getSelection().removeAllRanges():i.selection&&i.selection.empty()}),e("#AJSAdd").unbind("click").click(function(){ea.uploads.length+1<=ea.s.maxFiles&&(t.click(),ea.addingmore=!0)}),e("#AJSChange").unbind("click").click(function(){ea.changing=ea.currentupload,ea.addingmore=!1,t.click()}),e("#AJSL").unbind("click").click(function(){ea.changePrev(!0)}),e("#AJSR").unbind("click").click(function(){ea.changePrev()});var n=I("AJSICancel"),l=I("AJSISave"),d=I("AJSCW"),c=I("AJSCH"),u=I("AJSSAR"),h=I("AJSEdit");h&&(h.onclick=ea.showInfo),n&&(n.onclick=function(){e("#AJSMain > div").addClass(W),e("#AJSImagePreview").removeClass(W);var a=e("#AJSIMG_"+ea.id+ea.currentupload);e("#AJS").css({minWidth:"initial"}),a.css({top:(500-a.height())/2}),q(),z()
}),l&&(l.onclick=ea.saveInfo),e("#AJSRemove").unbind("click").click(function(){streamConfirm(p("Are you sure you want to remove this file?"),ea.deleteUpload,p("This removes the file from the list of files to be uploaded, and not from your computer"))}),e("#AJSClose,#AJSCloseText").unbind("click").click(function(){ea.s.readonly||e("#AJS_"+K[0].id).val(F(ea.uploads)),e("#AJS").hide(),ea.s.showPreviewOnForm&&(e("#AJSFormPrev_"+ea.id).html(Q()),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",b).click(b)),ea.event("close",K,{original:K[0],uploads:ea.uploads,length:ea.uploads.length}),K.data("ajs.ajaxstreamdata",ea)}),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",b).click(b),u&&(u.onchange=function(){e("#AJSLockAR").removeClass("asicons-lock-open2").addClass("asicons-lock2");var a,t=this.value,i=e("#AJSRITrack").streamBoundaries("getPositionData"),n=ea.uploads[ea.currentupload];if(n.aspectRatioLocked=!0,t&&t.match(/^(:?\s+)?\d+(:?\.\d+)?(:?\/|\:)\d+(:?\.\d+)?$/)){var o=t.split(/[\/|\:]/);a=o[0]/o[1]}else{if(!t||!t.match(/^(:?\s+)?(:?\d+|\d+\.\d+)$/))return;a=1*t}var l=I("AJSResImg").getBoundingClientRect(),d=n.width/l.width,c=n.height/l.height,u=i.x2-i.x,h=s(u/a),p=!1,g=!1;h+i.y>l.height&&(g=l.height-h,h>l.height&&(h=l.height,u=s(h*a),g=0,u+i.x>l.width&&(p=l.width-u)));var m=e("#AJSRITrack").streamBoundaries("updateOpts",{thumbWidth:u,thumbHeight:h,x:p,y:g}).positionData;I("AJSSW").value=s(u*d),I("AJSSH").value=s(h*c),r(m)}),d&&(d.onchange=function(){var a=1*this.value,t=a>ea.maxWidth?ea.maxWidth:a,i=I("AJSCH"),n=1*i.value,s=ea.uploads[ea.currentupload],r=o(t,n,ea.s.maxWidth,ea.s.maxHeight,s);this.value=s.canvasWidth=r.width,i.value=s.canvasHeight=r.height;var l=J(s,r),d=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:l.height,thumbHeight:l.thumbHeight,thumbWidth:l.thumbWidth,width:l.width}),B(r.height),e("#AJSRCVp").streamBoundaries("reposition"),O.call(d,d.positionData)}),c&&(c.onchange=function(){var a=1*this.value,t=a>ea.s.maxHeight?ea.s.maxHeight:a,i=I("AJSCW"),n=1*i.value,s=ea.uploads[ea.currentupload],r=o(n,t,ea.s.maxWidth,ea.s.maxHeight,s);this.value=s.canvasHeight=r.height,i.value=s.canvasWidth=r.width;var l=J(s,r),d=e("#AJSCZ").streamBoundaries();e("#AJSRCVp").streamBoundaries("updateOpts",{height:l.height,thumbHeight:l.thumbHeight,thumbWidth:l.thumbWidth,width:l.width}),B(r.height),e("#AJSRCVp").streamBoundaries("reposition"),O.call(d,d.positionData)}),e("#AJSLockAR").click(function(){var a=e(this),t=a.hasClass("asicons-lock-open2");t?a.removeClass("asicons-lock-open2").addClass("asicons-lock2"):a.removeClass("asicons-lock2").addClass("asicons-lock-open2"),ea.uploads[ea.currentupload].aspectRatioLocked=t}),e(".AJSEIcon").unbind("click",ea.iconClick).click(ea.iconClick),e(window).unbind("resize",q).resize(q)},ea.redraw=function(){e("#AJSFormPrev_"+ea.id).html(Q()),e("[id^=AJSUploadBtn_]").unbind("click",w).click(w),e(".AJSFP").unbind("click",b).click(b)},ea.draw=function(){K.addClass(W),K.attr({"data-ajaxstreamid":ea.c});var a=!1;if(k(e("#AJS_"+K[0].id))){var t=e("#AJS_"+K[0].id).val();ea.uploads=t.length?L(t,!0):[],ea.currentlength=ea.uploads.length;for(var i=0;i<ea.currentlength;i++){var n=ea.uploads[i];if(n.cropdata||(n.cropdata={}),!n.src){var o=l(n.newsrc,n.mimetype);o?n.src=URL.createObjectURL(o):(ea.uploads.splice(i,1),console.warn("Removed file: "+n.name),a||(streamConfirm(p("There are bad files")),a=!0))}if(n.mimetype){if(n.mimetype.match("image/*")){var s=new Image;s.onload=function(){this.imageloaded=!0},s.ajsindex=i,s.ajsname=n.name,s.onerror=function(){ea.uploads=ea.uploads.splice(this.ajsindex,1),console.warn("Removed file: "+this.ajsname),a||(streamConfirm(p("There are bad files")),a=!0),e("#ajaxstream_"+K[0].id).val(JSON.stringify(ea.uploads)),e("#AJSFP_"+ea.id+"_"+this.ajsindex).remove(),ea.currentlength=ea.uploads.length,delete ZZ.images["AJSIMG_"+ea.id+this.ajsindex]},s.src=n.src.match(/^http(:?s)?\:/)?n.src+"?cachekill="+(new Date).getTime():n.src,ZZ.images["AJSIMG_"+ea.id+i]=s}}else n.mimetype="application/octet-stream"}}else K.after(j.getInput("AJS_"+K[0].id,null,null,"hidden"));K.after(ea.s.showPreviewOnForm?j.getDiv(Q(),"AJSFormPrev_"+ea.id,"AJSFormPrev",{style:"height:"+ea.s.iconPreviewHeight}):j.getSpan(p("Upload"),"AJSUploadBtn_"+ea.id,"AJSBtn",{"data-mandatory":!0,"data-ajaxstreamid":ea.c})),k(e("#AJS"))||(aa.append(j.getDiv(u(ea.s.pathPrefix),"AJS")),E?e("#AJSImagePreview").after(g()):d(),e("#AJSRITrack").streamBoundaries({width:"100%",height:"100%",orientation:"2d",resizable:!0,bg:"none",thumbBg:"none",round:!1,scale9Grid:ea.s.scale9Grid,onBeforeUpdate:function(){K=ZZ.currentstream,this.s.lockAspectRatio=ea.uploads[ea.currentupload].aspectRatioLocked},onUpdate:function(e){r(e)}}),e("#AJSRCVp").streamBoundaries({crosshair:!1,height:"100%",isViewport:!0,orientation:"2d",onFinish:G,thumbBorder:"none",width:"100%"}),e("#AJSCZ").streamBoundaries({bg:"#999",crosshair:!1,height:8,onFinish:O,onUpdate:O,thumbBg:"#444",thumbBorder:"none",thumbBorderRadius:3,thumbHeight:8,thumbWidth:"15%",trackBorderRadius:3,width:"100%",x:"85%"})),ea.initBinding(),ea.event("init",K,{original:K[0],uploads:ea.uploads})}(),ZZ.streams[ea.id]=K,K.data("ajs.ajaxstreamdata",ea),K},setUploadData:function(a,t){var i=this,n=i.data("ajs.ajaxstreamdata"),o=!1;R("string",a)&&(a=L(a)),n.uploads=a?D(a):[];for(var s=0;s<n.uploads.length;s++)if(n.uploads[s].mimetype.match("image/*")){var r=new Image,l=n.uploads[s],d=l.src;r.onload=function(){this.imageloaded=!0},r.ajsindex=s,r.ajsname=l.name,r.onerror=function(){n.uploads=n.uploads.splice(this.ajsindex,1),console.warn("Removed file: "+this.ajsname),o||(streamConfirm(w("There are bad files")),o=!0),e("#AJS_"+n[0].id).val(JSON.stringify(n.uploads)),e("#AJSFP_"+n.id+"_"+this.ajsindex).remove(),n.currentlength=n.uploads.length,delete ZZ.images["AJSIMG_"+n.id+this.ajsindex]},r.src=d.match(/^http(:?s)?\:/)?d+"?cachekill="+(new Date).getTime():d,ZZ.images["AJSIMG_"+n.id+s]=r}n.currentlength=n.uploads.length,n.toload=n.loaded=n.currentupload=0,t&&n.redraw(),n.event("setuploaddata",i,{original:i[0],uploads:n.uploads}),i.data("ajs.ajaxstreamdata",n)}};window.ZZ=e.ajaxStream={author:"Luke Madhanga",currentstream:null,images:{},license:"MIT",streams:{},setDefaults:function(a){U=e.extend(U,a)},version:"3.0.0"},j=new j,e.fn.ajaxStream=function(a){return O[a]?O[a].apply(this,Array.prototype.slice.call(arguments,1)):"[object Object]"!==Object.prototype.toString.call(a)&&a?void e.error(["The method ",a," does not exist"].join("")):O.init.apply(this,arguments)}}(jQuery,this,0,document,Math);