(function(e,t,n){function a(t){var n=t[i]("tagName");return e(n).index(t)}function f(){if(!N(e(o+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:s+"IFrame"};e("body").append(D.getHtml("form",D.getInput(s+"Legacy",null,null,"hidden")+D.getInput(s+"FileLegacy",null,null,"file"),s+"LegacyForm",s+"Hidden",t)+D.getHtml("iframe",null,s+"IFrame",s+"Hidden",{name:s+"IFrame"}))}}function l(){var e=c();e+=p();e+=d();var t=D.getDiv(e,s+"Main");return t}function c(){var e=h()+D.getHtml("img",null,s+"UploadPreview")+D.getDiv(D.getSpan(null,s+"L",s+"LR asicons-arrow-left")+D.getSpan(null,s+"R",s+"LR asicons-arrow-right"),s+"LRContainer");return D.getDiv(e,s+"ImagePreview",s+"Hidden")}function h(){return D.getDiv(D.getDiv(null,s+"ActionsOverlay")+D.getDiv(D.getSpan(null,s+"Add","asicons-plus",{title:v("Add another file")})+D.getSpan(null,s+"Change","asicons-upload",{title:v("Change file")})+D.getSpan(null,s+"Edit","asicons-pencil",{title:v("Edit")})+D.getSpan(null,s+"Crop","asicons-resize-shrink",{title:v("Resize image")})+D.getSpan(null,s+"Remove","asicons-trash",{title:v("Remove file")})+D.getSpan(null,s+"Close","asicons-cross",{title:v("Close window")})),s+"PreviewActions")}function p(){var e="";return e}function d(){var e=D.getSpan(v("Choose file"),s+"ChooseText",s+"Btn")+D.getHtml("img",null,s+"Loading",s+"Hidden",{src:"files/loader.gif",title:v("Files are loading")});var t=D.getDiv(D.getInput(s+"File",null,s+"Hidden","file")+D.getDiv(e,s+"ChooseFile"),s+"ChooseSection");t+=D.getDiv(v("DROP"),s+"DropZone",s+"Hidden");return D.getDiv(t,s+"UploadSection")}function m(e){return e.slice(-1)[0]}function g(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function y(e){return document.getElementById(e)}function b(e){return Object.prototype.toString.call(e)==="[object Object]"}function w(e){return typeof e==="boolean"}function E(e,t){return{name:"AjaxStream::"+e,level:"Cannot continue",message:t,htmlMessage:t,toString:function(){return["Error: AjaxStream::",e," - ",t].join("")}}}function S(e){if(typeof e===undefined||!e||A(e)&&e[r]===0||b(e)&&O(e)===0){return!0}return!1}function x(e){e=e.toLowerCase();switch(e){case"canvas":var n=document.createElement("canvas");return!!(n.getContext&&n.getContext("2d"));case"filereader":return Boolean(t.FileReader);case"file":return Boolean(t.File);case"filelist":return Boolean(t.FileList);case"blob":return Boolean(t.Blob);case"fileapi":return!Boolean(t.Blob||t.File||t.FileList||t.FileReader);case"drag":return"draggable"in document.createElement("span");case"formdata":return typeof FormData==="function";case"xhrprogress":var r=new XMLHttpRequest;return!!(r&&"upload"in r&&"onprogress"in r.upload);case"multiupload":return"multiple"in document.createElement("input");default:throw T.exception("AjaxStream Error",['This function cannot be used to test the feature "',e,'"'].join(""))}}function N(e){return e[r]>0}function C(e){var t=[];for(var n in e){if(e.hasOwnProperty(n)){t.push(e[n])}}return t}function k(e,t){var n=JSON.parse(e);return n?t?C(n):n:!1}function L(e){var t=e;if(A(t)){t={};for(var n=0,i=e[r];n<i;n++){if(!S(e[n])){t[n]=e[n]}}}return JSON.stringify(t)}function A(e){return Object.prototype.toString.call(e)==="[object Array]"}function O(e){var t=0;for(var n in e){if(e.hasOwnProperty(n))t++}return Number(t)}function M(e){return typeof e==="function"}function _(e){return e[i]("id")}function D(){function t(e,t){if(b(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(w(r)){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!b(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,r,i,s){var o=document.createElement(e);if(n){o.innerHTML=n}if(r){o.id=r}if(i){o.className=i}return t(o,s).outerHTML};this.getInput=function(t,n,r,i,s){if(!b(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s.name){s.name=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var r="length",i="prop",s="AJS",o="#AJS",u=".AJS";e.fn.ajaxStream=function(i){var u=this;if(u[r]>1){u.each(function(){e(this).ajaxStream(i)});return u}var a=function(){},c=e("body"),h=x("fileapi"),p="parent",d="addClass",v="removeClass",b="append",w="click",E="unbind",S="change",T="attr",C="uploads";u.c=n;u.currentupload=null;u.currentlength=0;u.changing=!1;u.toload=0;u.loaded=0;u[C]=[];u.addingmore=!1;u.s=e.extend({accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:a,onfilechanged:a,onfileselected:a,onfilesloaded:a,onfilesloading:a,oninit:a,onlegacyuploadfail:a,onlegacyuploadfinish:a,onlegacyuploadstart:a,onsingleuploadfail:a,onsingleuploadfinish:a,onsingleuploadstart:a,onuploadfail:a,onuploadfinish:a,onuploadprogress:a,onuploadstart:a,resize:!0,showPreviewOnForm:!1,translateFunction:function(e){for(var t=1;t<arguments[r];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e.replace(n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,useViewport:!1,verbose:!1,viewportHeight:240,viewportWidth:240},i);if(typeof A!=="undefined"){function A(e){e===e;return u.s.translateFunction.apply(null,arguments)}}u.id=[u.c,"_",_(u)].join("");u.filedata={};u.legacyUpload=function(n){var i=n.files[0],s=u.changing===!1?u[C][r]:u.changing;u.filedata={name:i.name,mimetype:i.type,size:i.size,newupload:!0,customFields:{},index:s,islegacy:!0};t["AJSLegacy"]=e.ajaxStream.streams[u.id];e(o+"Legacy").val(JSON.stringify({maxsize:u.s.maxFileSize,maxheight:u.s.maxHeight,maxwidth:u.s.maxWidth,uploaddir:u.s.uploadTo,islegacy:!0,id:u.id}));e(o+"LegacyForm").prop({action:u.s.uploadScript});e(o+"LegacyForm").submit()};u.afterLegacyUpload=function(e){if(e.moved){u.filedata.src=e.location;u.afterFileRead(u.filedata,u.changing!==!1)}else{alert(e.error)}};u.filechanged=function(t){var n=t.target.files;if(!n[r]){u.changing=!1;return}u.toload=n[r];if(h){e(o+"ChooseText")[d](s+"Hidden");e(o+"Loading")[v](s+"Hidden");if(u.changing===!1){var i=n[r];var a=i+u[C][r];if(a>u.s.maxFiles){console.warn(A("You have selected {0} files but are only permitted to upload {1}",a,u.s.maxFiles));i=u.toload=u.s.maxFiles-u[C][r]}for(var f=0;f<i;f++){u.process(n[f],f)}}else{u.process(n[0],u.changing,true)}}else{u.legacyUpload(this)}};u.process=function(e,n,r,i){var s=new FileReader;s.readAsArrayBuffer(e);s.onload=function(s){var o=new Blob([s.target.result],{type:e.type});var a=(t.URL||t.webkitURL).createObjectURL(o);var f=r?n:u.currentlength;var l={name:e.name,src:a,mimetype:e.type,size:e.size,newupload:!0,customFields:{},index:f,islegacy:!1};if(!r){u.currentlength++}if(e.type.match("image/*")){var c=new Image;c.onload=function(){var e=this;l.width=e.width;l.height=e.height;l.viewport={left:undefined,right:undefined,width:undefined,src:undefined};u.afterFileRead(l,r,i)};c.src=a}else{u.afterFileRead(l,r,i)}}};u.afterFileRead=function(e,t,n){if(t){u[C][e.index]=e}else{u[C][e.index]?u[C][e.index]=e:u[C].push(e)}u.attemptProgression(n)};u.attemptProgression=function(){u.loaded++;if(u.loaded===u.toload){var t=e(o+"LRContainer");e(o+"_"+u.id).val(L(u[C]));e(o+"UploadSection")[d](s+"Hidden");e(o+"ImagePreview")[v](s+"Hidden");if(u[C][r]>1){t[v](s+"Hidden")}else{t[d](s+"Hidden")}var n=u.changing===!1;u.changing=!1;u.toload=u.loaded=0;u.displayUpload(null,n)}};u.displayUpload=function(t,n){if(u[C][r]){if(!t){t=u.getCurr(n)}var i=t.src;var a=e(o+"Crop");if(t.mimetype.match("image/*")){a[v](s+"Hidden")}else{i=u.getIconPath(t.mimetype);a[d](s+"Hidden")}var f=y(s+"UploadPreview");f.src=i;e(o+"UploadPreview")[v](s+"Transparent")}else{u.resetToUpload()}};u.getIconPath=function(e){switch(e){default:return""}};u.resetToUpload=function(){var t=e(o+"RContainer");e(o+"UploadSection")[v](s+"Hidden");e(o+"ImagePreview")[d](s+"Hidden");e(o+"ChooseText")[v](s+"Hidden");e(o+"Loading")[d](s+"Hidden");u[C][r]?t[v](s+"Hidden"):t[d](s+"Hidden")};u.getCurr=function(e){if(e){u.currentupload=u[C][r]-1;return m(u[C])}else{if(u.addingmore){var t=m(u[C]);u.currentupload=t.index-1;return t}else{if(u.currentupload||u.currentupload===0){return u[C][u.currentupload]}u.currentupload=0;return g(u[C])}}};u.changePrev=function(e){var t=e?-1:1;var n;if(u.currentupload+t<0){n=m(u.uploads);u.currentupload=u[C][r]-1}else if(u.currentupload+t>u[C][r]-1){n=g(u[C]);u.currentupload=0}else{n=u[C][u.currentupload+t];u.currentupload+=t}u.displayUpload(n)};u.initBinding=function(){var n=h?e(o+"File"):e(o+"FileLegacy");e(o+"ChooseText")[E](w)[w](function(){var e={accept:u.s.accept};u.addingmore=!0;u.changing=!1;if(u.s.maxFiles>1){e["multiple"]=!0}n[T](e)[w]()});n[E](S)[S](u.filechanged);e(o+"")[E]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(document.selection){document.selection.empty()}});e(o+"Add")[E](w)[w](function(){if(u[C][r]+1>u.s.maxFiles){}else{n[w]();u.addingmore=!0}});e(o+"Change")[E](w)[w](function(){u.changing=u.currentupload;u.addingmore=!1;console.log(e._data(n[0],"events"));n[w]()});e(o+"L")[E](w)[w](function(){u.changePrev(!0)});e(o+"R")[E](w)[w](function(){u.changePrev()});e(o+"Remove")[E](w)[w](function(){if(confirm(A("Are you sure you want to delete this file?"))){var t=[],n=e(o+"LRContainer");for(var i=0,a=u[C][r];i<a;i++){if(u[C][i]&&i!==u.currentupload){t.push(u[C][i])}}u[C]=t;u.currentlength=u[C][r];e(o+"_"+u.id).val(L(u[C]));e(o+"UploadSection")[d](s+"Hidden");e(o+"ImagePreview")[v](s+"Hidden");if(u[C][r]>1){n[v](s+"Hidden")}else{n[d](s+"Hidden")}u.displayUpload()}});e(o+"Close")[E](w)[w](function(){e(o).hide()});e("[id^=AJSUploadBtn_]")[E](w)[w](function(){var t=e(this).prop("id").replace(s+"UploadBtn_","");u=e.ajaxStream.streams[t];var i=e(o+"_"+u.id).val();u[C]=i[r]?k(i,!0):[];u[C][r]?u.displayUpload():u.resetToUpload();e(o+"").show();console.log(e._data(n[0],"events"));if(!u[C][r]){n[w]();u.addingmore=!0}})};u.draw=function(){var t=u[p]();u[d](s+"Hidden");if(N(e(o+"_"+u.id))){u.loadExisting()}else{t[b](D.getInput(s+"_"+u.id,null,null,"hidden"))}if(u.s.showPreviewOnForm){}else{t[b](D.getSpan(A("Upload"),s+"UploadBtn_"+u.id,s+"Btn",{"data-mandatory":!0}))}if(!N(e(o+""))){c[b](D.getDiv(l(),s));if(!h){f()}}u.initBinding()}();e.ajaxStream.streams[u.id]=u;n++;return u};if(typeof v!=="function"){function v(e){return e}}e.ajaxStream={author:"Luke Madhanga",license:"MIT",streams:{},version:.02};D=new D})(jQuery,this,0)