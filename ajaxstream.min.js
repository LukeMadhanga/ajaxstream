(function(e,t,n){function a(t){var n=t[i]("tagName");return e(n).index(t)}function f(){if(!N(e(o+"Legacy"))){var t={method:"post",enctype:"multipart/form-data",target:s+"IFrame"};e("body").append(_.getHtml("form",_.getInput(s+"Legacy",null,null,"hidden"),s+"LegacyForm",s+"Hidden",t)+_.getHtml("iframe",null,s+"IFrame",s+"Hidden",{name:s+"IFrame"}))}}function l(){var e=c();e+=p();e+=d();var t=_.getDiv(e,s+"Main");return t}function c(){var e=h()+_.getHtml("img",null,s+"UploadPreview")+_.getDiv(_.getSpan(null,s+"L",s+"LR asicons-arrow-left")+_.getSpan(null,s+"R",s+"LR asicons-arrow-right"),s+"LRContainer");return _.getDiv(e,s+"ImagePreview",s+"Hidden")}function h(){return _.getDiv(_.getDiv(null,s+"ActionsOverlay")+_.getDiv(_.getSpan(null,s+"Add","asicons-plus",{title:v("Add another file")})+_.getSpan(null,s+"Change","asicons-upload",{title:v("Change file")})+_.getSpan(null,s+"Edit","asicons-pencil",{title:v("Edit")})+_.getSpan(null,s+"Crop","asicons-resize-shrink",{title:v("Resize image")})+_.getSpan(null,s+"Remove","asicons-trash",{title:v("Remove file")})+_.getSpan(null,s+"Close","asicons-cross",{title:v("Close window")})),s+"PreviewActions")}function p(){var e="";return e}function d(){var e=_.getSpan(v("Choose file"),s+"ChooseText",s+"Btn")+_.getHtml("img",null,s+"Loading",s+"Hidden",{src:"files/loader.gif",title:v("Files are loading")});var t=_.getDiv(_.getInput(s+"File",null,s+"Hidden","file")+_.getDiv(e,s+"ChooseFile"),s+"ChooseSection");t+=_.getDiv(v("DROP"),s+"DropZone",s+"Hidden");return _.getDiv(t,s+"UploadSection")}function m(e){return e.slice(-1)[0]}function g(e){if(e[0]){return e[0]}else{for(var t in e){if(e.hasOwnProperty(t)){return e[t]}}}}function y(e){return document.getElementById(e)}function b(e){return Object.prototype.toString.call(e)==="[object Object]"}function w(e){return typeof e==="boolean"}function E(e,t){return{name:"AjaxStream::"+e,level:"Cannot continue",message:t,htmlMessage:t,toString:function(){return["Error: AjaxStream::",e," - ",t].join("")}}}function S(e){if(typeof e===undefined||!e||L(e)&&e[r]===0||b(e)&&A(e)===0){return!0}return!1}function x(e){e=e.toLowerCase();switch(e){case"canvas":var n=document.createElement("canvas");return!!(n.getContext&&n.getContext("2d"));case"filereader":return Boolean(t.FileReader);case"file":return Boolean(t.File);case"filelist":return Boolean(t.FileList);case"blob":return Boolean(t.Blob);case"fileapi":return Boolean(t.Blob||t.File||t.FileList||t.FileReader);case"drag":return"draggable"in document.createElement("span");case"formdata":return typeof FormData==="function";case"xhrprogress":var r=new XMLHttpRequest;return!!(r&&"upload"in r&&"onprogress"in r.upload);case"multiupload":return"multiple"in document.createElement("input");default:throw T.exception("AjaxStream Error",['This function cannot be used to test the feature "',e,'"'].join(""))}}function N(e){return e[r]>0}function C(e,t){var n=JSON.parse(e);return n?t?object_to_array(n):n:!1}function k(e){var t=e;if(L(t)){t={};for(var n=0,i=e[r];n<i;n++){if(!S(e[n])){t[n]=e[n]}}}return JSON.stringify(t)}function L(e){return Object.prototype.toString.call(e)==="[object Array]"}function A(e){var t=0;for(var n in e){if(e.hasOwnProperty(n))t++}return Number(t)}function O(e){return typeof e==="function"}function M(e){return e[i]("id")}function _(){function t(e,t){if(b(t)){for(var n in t){if(t.hasOwnProperty(n)){var r=t[n];if(w(r)){r=r?1:0}e.setAttribute(n,r)}}}return e}var e=this;this.getLink=function(t,n,r,i,s,o){if(!b(o)){o={}}if(s){o.rel="nofollow"}o.href=n;return e.getHtml("a",t,r,i,o)};this.getHtml=function(e,n,r,i,s){var o=document.createElement(e);if(n){o.innerHTML=n}if(r){o.id=r}if(i){o.className=i}return t(o,s).outerHTML};this.getInput=function(t,n,r,i,s){if(!b(s)){s={}}if(n!==null&&n!==""){s.value=n}if(t&&!s.name){s.name=t}s.type=i?i:"text";return e.getHtml("input",null,t,r,s)};this.getSpan=function(t,n,r,i){return e.getHtml("span",t,n,r,i)};this.getDiv=function(t,n,r,i){return e.getHtml("div",t,n,r,i)}}var r="length",i="prop",s="AJS",o="#AJS",u=".AJS";e.fn.ajaxStream=function(i){var u=this;if(u[r]>1){u.each(function(){e(this).ajaxStream(i)});return u}var c=function(){},h=e("body"),p=x("fileapi"),d="parent",v="addClass",b="removeClass",w="append",E="click",S="unbind",T="change",L="attr",A="uploads";u.c=n;u.currentupload=null;u.currentlength;u.changing=!1;u.toload=0;u.loaded=0;u[A]=[];u.addingmore=!1;u.s=e.extend({accept:["*"],allowFilters:!0,fetchRequiredFiles:!1,maxFileSize:2097152,maxFiles:1,iconPreviewWidth:200,iconPreviewHeight:200,maxHeight:1024,maxWidth:1024,onfilechanging:c,onfilechanged:c,onfileselected:c,onfilesloaded:c,onfilesloading:c,oninit:c,onlegacyuploadfail:c,onlegacyuploadfinish:c,onlegacyuploadstart:c,onsingleuploadfail:c,onsingleuploadfinish:c,onsingleuploadstart:c,onuploadfail:c,onuploadfinish:c,onuploadprogress:c,onuploadstart:c,resize:!0,showPreviewOnForm:!0,translateFunction:function(e){for(var t=1;t<arguments[r];t++){var n=new RegExp("\\{"+(t-1)+"\\}","g");e=e.replace(n,arguments[t])}return e},uploadScript:"upload.php",uploadTo:"uploads",uploadWithForm:!1,useViewport:!1,verbose:!1,viewportHeight:240,viewportWidth:240},i);if(typeof O!=="undefined"){function O(e){e===e;return u.s.translateFunction.apply(null,arguments)}}u.id=[u.c,"_",M(u),"_",a(u)].join("");u.filechanged=function(t){var n=t.target.files;if(!n[r]){u.changing=!1;return}u.toload=n[r];if(p){e(o+"ChooseText")[v](s+"Hidden");e(o+"Loading")[b](s+"Hidden");if(u.changing===!1){var i=n[r];var a=i+u[A][r];if(a>u.s.maxFiles){console.warn(O("You have selected {0} files but are only permitted to upload {1}",a,u.s.maxFiles));i=u.toload=u.s.maxFiles-u[A][r]}for(var f=0;f<i;f++){u.process(n[f],f)}}else{}}else{}};u.process=function(e,n,r,i){var s=new FileReader;s.readAsArrayBuffer(e);s.onload=function(s){var o=new Blob([s.target.result],{type:e.type});var a=(t.URL||t.webkitURL).createObjectURL(o);var f=r?n:u.currentlength;var l={name:e.name,src:a,mimetype:e.type,size:e.size,newupload:!0,customFields:{},index:f,islegacy:!1};if(!r){u.currentlength++}if(e.type.match("image/*")){var c=new Image;c.onload=function(){var e=this;l.width=e.width;l.height=e.height;l.viewport={left:undefined,right:undefined,width:undefined,src:undefined};u.afterFileRead(l,r,i)};c.src=a}else{u.afterFileRead(l,r,i)}}};u.afterFileRead=function(e,t,n){if(t){u[A][e.index]=e}else{u[A][e.index]?u[A][e.index]=e:u[A].push(e)}u.attemptProgression(n)};u.attemptProgression=function(){u.loaded++;if(u.loaded===u.toload){var t=e(o+"LRContainer");e(o+"_"+u.id).val(k(u[A]));e(o+"UploadSection")[v](s+"Hidden");e(o+"ImagePreview")[b](s+"Hidden");if(u[A][r]>1){t[b](s+"Hidden")}else{t[v](s+"Hidden")}var n=u.changing===!1;u.changing=!1;u.displayUpload(null,n)}};u.displayUpload=function(t,n){if(u[A][r]){if(!t){t=u.getCurr(n)}var i=t.src;var a=e(o+"Crop");if(t.mimetype.match("image/*")){a.removeClass(s+"Hidden")}else{i=getIconImagePath(t.mimetype);a.addClass(s+"Hidden")}var f=y(s+"UploadPreview");f.src=i;e(o+"UploadPreview").removeClass(s+"Transparent")}else{resetToUpload()}};u.resetToUpload=function(){var t=e(o+"RContainer");e(o+"UploadSection")[b](s+"Hidden");e(o+"ImagePreview")[v](s+"Hidden");e(o+"ChooseText")[b](s+"Hidden");e(o+"Loading")[v](s+"Hidden");u[A][r]?t[b](s+"Hidden"):t[v](s+"Hidden")};u.getCurr=function(e){if(e){u.currentupload=u[A][r]-1;return m(u[A])}else{if(u.addingmore){var t=m(u[A]);u.currentupload=t.index-1;return t}else{if(u.currentupload||u.currentupload===0){return u[A][u.currentupload]}u.currentupload=0;return g(u[A])}}};u.changePrev=function(e){var t=e?-1:1;var n;if(u.currentupload+t<0){n=m(u.uploads);u.currentupload=u[A][r]-1}else if(u.currentupload+t>u[A][r]-1){n=g(u[A]);u.currentupload=0}else{n=u[A][u.currentupload+t];u.currentupload+=t}u.displayUpload(n)};u.initBinding=function(){var n=e(o+"File");e(o+"ChooseText")[S](E)[E](function(){var e={accept:u.s.accept};u.addingmore=!0;if(u.s.maxFiles>1){e["multiple"]=!0}n[L](e)[E]()});n[S](T)[T](u.filechanged);e(o+"")[S]("dbclick").dblclick(function(){if(t.getSelection){t.getSelection().removeAllRanges()}else if(document.selection){document.selection.empty()}});e(o+"Add")[S](E)[E](function(){if(u[A][r]+1>u.s.maxFiles){}else{n[E]();u.addingmore=!0}});e(o+"Change")[S](T)[T](function(){u.changing=u.currentupload;u.addingmore=!1;n[E]()});e(o+"L")[S](E)[E](function(){u.changePrev(!0)});e(o+"R")[S](E)[E](function(){u.changePrev()});e(o+"Remove")[S](E)[E](function(){if(confirm(O("Are you sure you want to delete this file?"))){var t=[],n=e(o+"LRContainer");for(var i=0,a=u[A][r];i<a;i++){if(u[A][i]&&i!==u.currentupload){t.push(u[A][i])}}u[A]=t;u.currentlength=u[A][r];e(o+"_"+u.id).val(k(u[A]));e(o+"UploadSection")[v](s+"Hidden");e(o+"ImagePreview")[b](s+"Hidden");if(u[A][r]>1){n[b](s+"Hidden")}else{n[v](s+"Hidden")}u.displayUpload()}});e(o+"Close")[S](E)[E](function(){e(o+"").hide()});e("[id^=AJSUploadBtn_]").unbind("click").click(function(){var t=e(this).prop("id").replace(s+"UploadBtn_","");u=streams[t];u.initBinding();var n=e(o+"_"+u.id).val();u[A]=n.length?C(n,!0):[];u[A][r]?u.displayUpload():u.resetToUpload();e(o+"").show();if(!u[A][r]){e(o+"File").click();u.addingmore=!0}})};u.draw=function(){var t=u[d]();u[v](s+"Hidden");if(N(e(o+"_"+u.id))){u.loadExisting()}else{t[w](_.getInput(s+"_"+u.id,null,null,"hidden"))}if(u.s.showPreviewOnForm){}else{t[w](_.getSpan(O("Upload"),s+"UploadBtn_"+u.id,s+"Btn",{"data-mandatory":!0}))}if(!N(e(o+""))){h[w](_.getDiv(l(),s));if(!p){f()}}u.initBinding()}();n++;return u};if(typeof v!=="function"){function v(e){return e}}e.ajaxStream={author:"Luke Madhanga",version:.02};_=new _})(jQuery,this,0)